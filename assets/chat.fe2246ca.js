var oe=Object.defineProperty,le=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var j=(u,e,a)=>e in u?oe(u,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[e]=a,H=(u,e)=>{for(var a in e||(e={}))ie.call(e,a)&&j(u,a,e[a]);if(G)for(var a of G(e))ce.call(e,a)&&j(u,a,e[a]);return u},J=(u,e)=>le(u,re(e));import{d as A,o as i,g as M,w as v,r as O,T as S,B as k,c as f,h as w,i as N,V as de,W as fe,X as pe,Y as he,a as _,C as g,E as z,e as R,Z as me,f as Z,F as q,b as D,t as U,k as ve,q as X,R as _e,_ as ge,G as xe}from"./vendor.bc4bfb4e.js";import{u as ye,h as Ae,a as Me,j as Ee,r as Oe,k as ke}from"./index.26721c2c.js";const Be=A({setup(u){const e=(t,s)=>{k(t,{scale:[.7,1]},{duration:.3}).finished.then(()=>s())},a=(t,s)=>{k(t,{opacity:0}).finished.then(()=>s())};return(t,s)=>(i(),M(S,{appear:"",css:!1,onEnter:e,onLeave:a},{default:v(()=>[O(t.$slots,"default")]),_:3}))}}),be=A({setup(u){const e=(t,s)=>{k(t,{scale:[.7,1]},{duration:.3}).finished.then(()=>s())},a=(t,s)=>{k(t,{scale:.5,opacity:0,y:-100,display:"absolute"},{duration:.3}).finished.then(()=>s())};return(t,s)=>(i(),M(S,{appear:"",css:!1,onEnter:e,onLeave:a},{default:v(()=>[O(t.$slots,"default")]),_:3}))}}),we={class:"h-[54px]"},ze=A({props:{status:{required:!1,type:String,default:"file"}},emits:["file-change"],setup(u,{emit:e}){const a=async({file:t})=>{const s=await ye(t);s.parsedFile&&Ae(s.parsedFile),e("file-change",{fileState:s.fileState,message:s.message,fileName:t.name})};return(t,s)=>{const d=Me,B=be,y=Be;return i(),f("div",we,[w(B,null,{default:v(()=>[u.status==="file"?(i(),M(d,{key:0,small:"",onFileChange:a})):N("",!0)]),_:1}),w(y,null,{default:v(()=>[u.status==="chips"?O(t.$slots,"default",{key:0}):N("",!0)]),_:3})])}}}),Te=A({setup(u){const e=async(a,t)=>{k(".stagger",{opacity:[0,1],x:[100,0]},{delay:pe(.2),easing:he({velocity:100,damping:100})}).finished.then(()=>t())};return(a,t)=>(i(),M(fe,de({mode:"out-in",css:!1,appear:""},a.$attrs,{onEnter:e}),{default:v(()=>[O(a.$slots,"default")]),_:3},16))}}),qe=A({props:{from:{required:!1,type:Boolean}},setup(u){const e=u,a=t=>{const s=t,d=e.from?-100:100;k(s,{opacity:[0,1],x:[d,0]})};return(t,s)=>(i(),M(S,{appear:"",css:!1,onEnter:a},{default:v(()=>[O(t.$slots,"default")]),_:3}))}}),Ue={width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24"},Ye=_("path",{d:"M19.903 8.586a.997.997 0 0 0-.196-.293l-6-6a.997.997 0 0 0-.293-.196c-.03-.014-.062-.022-.094-.033a.991.991 0 0 0-.259-.051C13.04 2.011 13.021 2 13 2H6c-1.103 0-2 .897-2 2v16c0 1.103.897 2 2 2h12c1.103 0 2-.897 2-2V9c0-.021-.011-.04-.013-.062a.952.952 0 0 0-.051-.259c-.01-.032-.019-.063-.033-.093zM16.586 8H14V5.414L16.586 8zM6 20V4h6v5a1 1 0 0 0 1 1h5l.002 10H6z",fill:"currentColor"},null,-1),Ne=_("path",{d:"M8 12h8v2H8zm0 4h8v2H8zm0-8h2v2H8z",fill:"currentColor"},null,-1),Ze=[Ye,Ne];function De(u,e){return i(),f("svg",Ue,Ze)}var Fe={name:"bx-bx-file",render:De},Ce="data:image/png;base64,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";const F=g([{id:z(),avatar:!0,from:!0,type:"hello",text:""},{id:z(),from:!0,type:"file",text:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0445\u0435\u043C\u0443 \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u0438 \u0447\u0442\u043E-\u0431\u044B \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C"}]);function Ve(){const u=R(()=>F.value[F.value.length-1]);return{messages:F,lastMessage:u}}function Ie(){const u=t=>{F.value.push(H({id:z()},t))},e=t=>{let s=0;t.forEach(d=>{setTimeout(()=>u(d),s),s+=500})};return{addMessage:u,addMessages:e,addMessagePair:({toText:t,fromText:s,options:d})=>{e(d?[{to:!0,type:"text",text:t},{from:!0,type:"text",text:s,avatar:!0,chips:d}]:[{to:!0,type:"text",text:t},{from:!0,type:"text",text:s,avatar:!0}])}}}function Ke(){const{now:u}=me({controls:!0}),e=u.value.getHours();return R(()=>e>6&&e<12?"\u0414\u043E\u0431\u0440\u043E\u0435 \u0443\u0442\u0440\u043E!":e>=12&&e<18?"\u0414\u043E\u0431\u0440\u044B\u0439 \u0434\u0435\u043D\u044C!":e>=18&&e<23?"\u0414\u043E\u0431\u0440\u044B\u0439 \u0432\u0435\u0447\u0435\u0440!":"\u0414\u043E\u0431\u0440\u043E\u0439 \u043D\u043E\u0447\u0438!")}const Qe={key:0,class:"ec-chat-message ec-chat-message--from"},He={key:0,class:"select-none absolute -top-1.5 -left-5"},Se=["src"],Re={class:"text-sm px-3 py-2"},Le={key:1,class:"ec-chat-message ec-chat-message--to"},Pe={key:0,class:"absolute -top-1.5 left-1"},We={class:"text-sm px-3 py-2"},Ge={class:"inline"},je={key:0,class:"flex items-center space-x-4"},Je={class:"text-gray-600 font-medium tracking-wide"},Xe=A({props:{avatar:{required:!1,type:Boolean},message:{required:!1,type:String,default:""},type:{required:!1,type:String,default:""},from:{required:!1,type:Boolean},to:{required:!1,type:Boolean}},setup(u){const e=Ke();return(a,t)=>{const s=Fe,d=qe;return i(),M(d,{from:u.from},{default:v(()=>[u.from?(i(),f("div",Qe,[u.avatar?(i(),f("div",He,[_("img",{src:Z(Ce),alt:"\u0410\u0432\u0430\u0442\u0430\u0440 \u0431\u043E\u0442\u0430",width:"16",height:"16"},null,8,Se)])):N("",!0),_("div",Re,[O(a.$slots,"default",{},()=>[u.type==="hello"?(i(),f(q,{key:0},[D(U(Z(e)),1)],64)):(i(),f(q,{key:1},[D(U(u.message),1)],64))])])])):(i(),f("div",Le,[u.avatar?(i(),f("div",Pe)):N("",!0),_("div",We,[_("div",Ge,[O(a.$slots,"default",{},()=>[u.type==="file"?(i(),f("div",je,[w(s,{class:"w-5 h-5 text-gray-600"}),_("span",Je,U(u.message),1)])):(i(),f(q,{key:1},[D(U(u.message),1)],64))])])])]))]),_:3},8,["from"])}}});const $e=A({props:{messages:{required:!1,type:Array,default:()=>[]}},setup(u){const e=u,a=R(()=>e.messages.length),t=g(null),s=()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight+200)};return ve([a],()=>{_e(()=>{s(),setTimeout(s,200)})}),(d,B)=>{const y=Xe;return i(),f("div",{ref:(l,m)=>{m.chat=l,t.value=l},class:"ec-chat"},[(i(!0),f(q,null,X(u.messages,l=>(i(),M(y,{key:l.id,avatar:l.avatar,to:l.to,type:l.type,from:l.from,message:l.text},null,8,["avatar","to","type","from","message"]))),128))],512)}}});var $={};const et={class:"overflow-y-hidden flex flex-col shadow-lg mx-auto h-screen w-full lg:w-[980px]"},tt=_("div",{class:"flex-shrink-0 flex justify-center py-2 border-0 border-b-1 border-gray-100"},[_("h3",{class:"font-medium tracking-wide text-xl"},"\u0421\u043E\u0437\u0434\u0430\u043D\u0438\u0435 \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u0438")],-1),ut={class:"flex-shrink-0 px-6 py-4"},st=A({setup(u){const{messages:e,lastMessage:a}=Ve(),{addMessages:t,addMessagePair:s}=Ie(),{enrichedSchema:d}=Ee(),B=g("nofile"),y=g("file"),l=g(null),m=g(0),Y=g(null),ee=n=>{if(n.target){const p=n.composedPath().find(o=>{var r;return(r=o.classList)==null?void 0:r.contains("stagger")});if(Y.value.$el){const o=p.cloneNode(!0);Y.value.$el.appendChild(o),o.style.position="absolute",k(o,{x:400,y:-60,opacity:0},{duration:.7}).finished.then(()=>Y.value.$el.removeChild(o))}}},te=n=>{B.value=n.fileState.value,y.value="chips",B.value==="uploaded"&&t([{to:!0,type:"file",text:n.fileName},{avatar:!0,from:!0,type:"text",text:"\u0421 \u043A\u0430\u043A\u043E\u0433\u043E \u0432\u043E\u043F\u0440\u043E\u0441\u0430 \u043D\u0430\u0447\u0430\u0442\u044C \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u044E?",chips:d.value.nodes}])},ue=n=>{const p=g(xe(d.value)),o=p.value.nodes.findIndex(r=>r._id===n);return p.value.nodes.splice(0,o),p},se=n=>{const p=g([]),o=r=>{var E;p.value.push({_id:r._id,id:r.id,computedId:r.computedId,type:"question",title:r.title,parent:r.parent,value:r.value,when:r.when,answer:r.answer,options:((E=r.options)==null?void 0:E.filter(x=>x.type!=="node"))||[]}),r.options&&r.options.forEach(x=>{x.type==="node"&&o(J(H({},x),{parent:r._id}))})};return n.forEach(r=>{o(r)}),p},C=(n="answer")=>[{_id:z(),title:"\u0414\u0430",type:n},{_id:z(),title:"\u041D\u0435\u0442",type:n}],ae=(n,p)=>{var x,h;if(ee(p),a.value.chips&&a.value.chips.forEach(c=>c.disabled=!0),n.type==="new-schema"){B.value="nofile",y.value="file",l.value=null,m.value=0,Oe(),t([{from:!0,type:"file",text:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0445\u0435\u043C\u0443 \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u0438 \u0447\u0442\u043E-\u0431\u044B \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C"}]);return}if(!l.value){l.value=se(ue(n._id).value.nodes).value,s({toText:`\u041D\u0430\u0447\u0430\u0442\u044C \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u044E \u0441 \u0432\u043E\u043F\u0440\u043E\u0441\u0430 "${n.title}"`,fromText:n.title,options:C()});return}let o=l.value[m.value];const r=()=>{var c;return(c=l.value)==null?void 0:c.filter(b=>b.parent===o._id?b.when===o.value:!0)},E=()=>{var c;return l.value&&l.value[m.value]===void 0?-1:((c=l.value)==null?void 0:c.findIndex((b,V)=>!(b.value!==null||l.value===null||V===m.value)))||-1};if(n.type==="answer")o.value=n.title==="\u0414\u0430",o.answer=n.title,l.value=r()||[],o.options=(x=o.options)==null?void 0:x.filter(c=>c.when===o.value),((h=o.options)==null?void 0:h.length)?s({toText:n.title,fromText:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043E\u0434\u0438\u043D \u0438\u0437 \u0432\u0430\u0440\u0438\u0430\u043D\u0442\u043E\u0432 \u043E\u0442\u0432\u0435\u0442\u0430",options:o.options}):(m.value=E(),o=l.value[m.value],s({toText:n.title,fromText:o.title,options:C()}));else if(m.value=E(),m.value===-1){n.value=!0;const c=V=>{const I=g([]);return V.forEach(T=>{const L=T.computedId||`${T.id}.`,P=`${L} ${T.title}`,W=T.value?"\u0414\u0430":"\u041D\u0435\u0442",K=T.options.find(Q=>Q.value);if(K){const Q=(L.split(".").filter(ne=>ne).length-1)*8;I.value.push({question:P,questionAnswer:W,selectedOption:`${K.computedId} ${K.title}`,indent:Q})}else I.value.push({question:P,questionAnswer:W,selectedOption:"",indent:0})}),{answers:I}},{answers:b}=c(l.value);ke(d.value.name,b.value),t([{to:!0,type:"text",text:n.title},{from:!0,type:"text",text:"\u0417\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u0435 \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043E, \u0441\u043A\u0430\u0447\u0438\u0432\u0430\u043D\u0438\u0435 \u0437\u0430\u043F\u0443\u0449\u0435\u043D\u043E",avatar:!0},{from:!0,type:"text",text:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0435\u0449\u0451 \u043E\u0434\u043D\u0443 \u0441\u0445\u0435\u043C\u0443 \u0438\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u0438?",chips:[{id:z(),title:"\u0414\u0430",type:"new-schema"}]}])}else{const c=l.value[m.value];n.value=!0,s({toText:n.title,fromText:c.title,options:C()})}};return(n,p)=>{const o=$e,r=ge,E=Te,x=ze;return i(),f("div",et,[tt,w(o,{class:"flex-grow",messages:Z(e)},null,8,["messages"]),_("div",ut,[w(x,{status:y.value,"onUpdate:status":p[0]||(p[0]=h=>y.value=h),onFileChange:te},{default:v(()=>[w(E,{ref:(h,c)=>{c.toolbar=h,Y.value=h},tag:"div",class:"chat-tools"},{default:v(()=>[(i(!0),f(q,null,X(Z(a).chips,h=>(i(),M(r,{key:h._id||h.id,disabled:!!h.disabled,class:"stagger !outline-none rounded-full mr-4 transition-none",type:"primary",onClick:c=>ae(h,c)},{default:v(()=>[D(U(h.title),1)]),_:2},1032,["disabled","onClick"]))),128))]),_:1},512)]),_:1},8,["status"])])])}}});typeof $=="function"&&$(st);export{st as default};
