import{u as eo,_ as to,a as no}from"./index.26721c2c.js";import{d as Wt,o as q,c as re,r as Bi,Q as jn,a as Hn,C as qt,K as io,h as Vi,w as Bn,b as Kt,t as Vn,f as Ke,F as Je,q as Ui,g as Jt,i as Un,I as ro,R as so}from"./vendor.bc4bfb4e.js";const oo=Wt({props:{left:{required:!1,type:Number,default:0},top:{required:!1,type:Number,default:0},width:{required:!1,type:Number,default:0},height:{required:!1,type:Number,default:0}},setup(s){return(o,n)=>(q(),re("div",{class:"ec-ftemplate-process",style:jn({top:`${s.top}px`,left:`${s.left}px`,width:`${s.width}px`,height:`${s.height}px`})},[Bi(o.$slots,"default")],4))}});const ao={style:{position:"relative"}},lo=["width","height"],uo=["d"],co=["width","height"],ho=Wt({props:{left:{required:!1,type:Number,default:0},top:{required:!1,type:Number,default:0},width:{required:!1,type:Number,default:0},height:{required:!1,type:Number,default:0}},setup(s){return(o,n)=>(q(),re("div",{style:jn(`left:${s.left}px;top:${s.top}px;width:${s.width}px;height:${s.height}px;`),class:"ec-ftemplate-decision","data-jtk-target":"true","data-jtk-target-port-type":"target"},[Hn("div",ao,[(q(),re("svg",{width:s.width,height:s.height},[Hn("path",{d:`M ${s.width/2} 10 L ${s.width-10} ${s.height/2} L ${s.width/2} ${s.height-10} L 10 ${s.height/2} Z`},null,8,uo),(q(),re("foreignObject",{width:s.width,height:s.height},[Hn("div",{class:"flex m-auto text-sm items-center justify-center text-center",style:jn({width:`${s.width-80}px`,height:`${s.height}px`})},[Bi(o.$slots,"default")],4)],8,co))],8,lo))])],4))}});function Ie(s,o,n){return s==="*"?!0:s.length>0?s.indexOf(o)!==-1:!n}function w(s,o,n){var i;s=s||{},o=o||{};var e=s,t=o;if(n)for(i=0;i<n.length;i++)e[n[i]]=t[n[i]];else for(i in t)e[i]=t[i];return s}function Yn(s){return Object.prototype.toString.call(s)==="[object Number]"}function R(s){return typeof s=="string"}function Yi(s){return typeof s=="boolean"}function Ze(s){return s==null?!1:Object.prototype.toString.call(s)==="[object Object]"}function fo(s){return Object.prototype.toString.call(s)==="[object Date]"}function Me(s){return Object.prototype.toString.call(s)==="[object Function]"}function Zt(s){if(R(s))return""+s;if(Yi(s))return!!s;if(fo(s))return new Date(s.getTime());if(Me(s))return s;if(Array.isArray(s)){for(var o=[],n=0;n<s.length;n++)o.push(Zt(s[n]));return o}else if(Ze(s)){var i={};for(var e in s)i[e]=Zt(s[e]);return i}else return s}function zt(s,o,n,i){var e={},t,r,a={};for(n=n||[],i=i||[],r=0;r<n.length;r++)e[n[r]]=!0;for(r=0;r<i.length;r++)a[i[r]]=!0;var l=Zt(s);for(r in o)if(l[r]==null||a[r])l[r]=o[r];else if(e[r])t=[],t.push.apply(t,Array.isArray(l[r])?l[r]:[l[r]]),t.push(o[r]),l[r]=t;else if(R(o[r])||Yi(o[r])||Me(o[r])||Yn(o[r]))l[r]=o[r];else if(Array.isArray(o[r]))t=[],Array.isArray(l[r])&&t.push.apply(t,l[r]),t.push.apply(t,o[r]),l[r]=t;else if(Ze(o[r])){Ze(l[r])||(l[r]={});for(var u in o[r])l[r][u]=o[r][u]}return l}function Xi(s,o,n){for(var i=0;i<n.length;i++){var e=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(e===o)return e}return s}function vo(s,o,n,i){var e=function(a){var l=a.match(/(\${.*?})/g);if(l!=null)for(var u=0;u<l.length;u++){var c=o[l[u].substring(2,l[u].length-1)]||"";c!=null&&(a=a.replace(l[u],c))}return a},t=function r(a){if(a!=null){if(R(a))return e(a);if(Me(a)&&!i&&(n==null||(a.name||"").indexOf(n)===0))return a(o);if(Array.isArray(a)){for(var l=[],u=0;u<a.length;u++)l.push(r(a[u]));return l}else if(Ze(a)){var c={};for(var h in a)c[h]=r(a[h]);return c}else return a}};return t(s)}function D(s,o){if(s)for(var n=0;n<s.length;n++)o(s[n]);else return null}function Ee(s,o){if(s){for(var n=0;n<s.length;n++)if(o(s[n]))return n}return-1}function po(s,o){var n=[];if(s)for(var i=0;i<s.length;i++)o(s[i])&&n.push(i);return n}function Xn(s,o){var n=Ee(s,o);return n===-1?null:s[n]}function go(s,o){var n=po(s,o);return n.map(function(i){return s[i]})}function $i(s,o){var n=null;return s.forEach(function(i){o(i)&&(n=i)}),n}function yo(s){var o=[];return s.forEach(function(n){o.push(n)}),o}function V(s,o){var n=Ee(s,o);return n>-1&&s.splice(n,1),n!==-1}function Qt(s){if(Array.fromArray!=null)return Array.from(s);var o=[];return Array.prototype.push.apply(o,s),o}function Wi(s,o){var n=s.indexOf(o);return n>-1&&s.splice(n,1),n!==-1}function $n(s,o,n,i){var e=s[o];return e==null&&(e=[],s[o]=e),e[i?"unshift":"push"](n),e}function bt(s,o,n){return s.indexOf(o)===-1?(n?s.unshift(o):s.push(o),!0):!1}var Y=[];for(var Tt=0;Tt<256;Tt++)Y[Tt]=(Tt<16?"0":"")+Tt.toString(16);function X(){var s=Math.random()*4294967295|0,o=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return Y[s&255]+Y[s>>8&255]+Y[s>>16&255]+Y[s>>24&255]+"-"+Y[o&255]+Y[o>>8&255]+"-"+Y[o>>16&15|64]+Y[o>>24&255]+"-"+Y[n&63|128]+Y[n>>8&255]+"-"+Y[n>>16&255]+Y[n>>24&255]+Y[i&255]+Y[i>>8&255]+Y[i>>16&255]+Y[i>>24&255]}function en(s,o,n){var i={x:s.x-o.x,y:s.y-o.y},e=Math.cos(n/360*Math.PI*2),t=Math.sin(n/360*Math.PI*2);return{x:i.x*e-i.y*t+o.x,y:i.y*e+i.x*t+o.y,cr:e,sr:t}}function Wn(s){if(s==null)return null;for(var o=s.replace(/^\s\s*/,""),n=/\s/,i=o.length;n.test(o.charAt(--i)););return o.slice(0,i+1)}function _o(s,o){s=s.length==null||typeof s=="string"?[s]:s;for(var n=0;n<s.length;n++)o(s[n])}function qi(s,o){for(var n=[],i=0;i<s.length;i++)n.push(o(s[i]));return n}function ee(){for(var s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];if(typeof console!="undefined")try{var i=arguments[arguments.length-1];console.log(i)}catch{}}function tn(s,o,n){return function(){var i=null;try{o!=null&&(i=o.apply(this,arguments))}catch(e){ee("jsPlumb function failed : "+e)}if(s!=null&&(n==null||i!==n))try{i=s.apply(this,arguments)}catch(e){ee("wrapped function failed : "+e)}return i}}function Ki(s,o,n){return s.has(o)||s.set(o,n()),s.get(o)}function Ji(s,o){for(var n=s.__proto__;n!=null;){if(n instanceof o)return!0;n=n.__proto__}return!1}function mo(s,o,n,i){if(o.length===0)o.push(s);else{for(var e=i?-1:1,t=0,r=o.length,a=Math.floor((t+r)/2);r>t;){var l=n(s,o[a])*e;l<0?r=a:t=a+1,a=Math.floor((t+r)/2)}o.splice(a,0,s)}}function Zi(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function zi(s,o){for(var n=0;n<o.length;n++){var i=o[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,i.key,i)}}function Qi(s,o,n){return o&&zi(s.prototype,o),n&&zi(s,n),s}function Pt(s,o,n){return o in s?Object.defineProperty(s,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[o]=n,s}function Eo(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),o&&qn(s,o)}function nn(s){return nn=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},nn(s)}function qn(s,o){return qn=Object.setPrototypeOf||function(i,e){return i.__proto__=e,i},qn(s,o)}function Co(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function xo(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function ko(s,o){return o&&(typeof o=="object"||typeof o=="function")?o:xo(s)}function So(s){var o=Co();return function(){var i=nn(s),e;if(o){var t=nn(this).constructor;e=Reflect.construct(i,arguments,t)}else e=i.apply(this,arguments);return ko(this,e)}}var At=function(){function s(){Zi(this,s),Pt(this,"_listeners",{}),Pt(this,"eventsSuspended",!1),Pt(this,"tick",!1),Pt(this,"eventsToDieOn",{ready:!0}),Pt(this,"queue",[])}return Qi(s,[{key:"fire",value:function(n,i,e){var t=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[n]){var r=this._listeners[n].length,a=0,l=!1;if(!this.shouldFireEvent||this.shouldFireEvent(n,i,e))for(;!l&&a<r&&t!==!1;){if(this.eventsToDieOn[n])this._listeners[n][a].apply(this,[i,e]);else try{t=this._listeners[n][a].apply(this,[i,e])}catch(u){ee("jsPlumb: fire failed for event "+n+" : "+(u.message||u))}a++,(this._listeners==null||this._listeners[n]==null)&&(l=!0)}}this.tick=!1,this._drain()}return t}},{key:"_drain",value:function(){var n=this.queue.pop();n&&this.fire.apply(this,n)}},{key:"unbind",value:function(n,i){if(arguments.length===0)this._listeners={};else if(arguments.length===1){if(typeof n=="string")delete this._listeners[n];else if(n.__jsPlumb){var e;for(var t in n.__jsPlumb)e=n.__jsPlumb[t],Wi(this._listeners[e]||[],n)}}else arguments.length===2&&Wi(this._listeners[n]||[],i);return this}},{key:"getListener",value:function(n){return this._listeners[n]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(n){this.eventsSuspended=n}},{key:"bind",value:function(n,i,e){var t=this,r=function(u){$n(t._listeners,u,i,e),i.__jsPlumb=i.__jsPlumb||{},i.__jsPlumb[X()]=u};if(typeof n=="string")r(n);else if(n.length!=null)for(var a=0;a<n.length;a++)r(n[a]);return this}},{key:"silently",value:function(n){this.setSuspendEvents(!0);try{n()}catch(i){ee("Cannot execute silent function "+i)}this.setSuspendEvents(!1)}}]),s}();(function(s){Eo(n,s);var o=So(n);function n(){return Zi(this,n),o.apply(this,arguments)}return Qi(n,[{key:"shouldFireEvent",value:function(e,t,r){return!0}}]),n})(At);var bo=[null,[1,-1],[1,1],[-1,1],[-1,-1]],To=[null,[-1,-1],[-1,1],[1,1],[1,-1]],Ge=2*Math.PI;function ze(s,o){return o.x===s.x?o.y>s.y?1/0:-1/0:o.y===s.y?o.x>s.x?0:-0:(o.y-s.y)/(o.x-s.x)}function Po(s,o){return-1/ze(s,o)}function Kn(s,o){return Math.sqrt(Math.pow(o.y-s.y,2)+Math.pow(o.x-s.x,2))}function Jn(s,o){return o.x>s.x||o.x==s.x?o.y>s.y?2:1:o.y>s.y?3:4}function Ao(s,o){var n=ze(s,o),i=Math.atan(n),e=Jn(s,o);return(e==4||e==3)&&(i+=Math.PI),i<0&&(i+=2*Math.PI),i}function er(s,o){var n=s.x,i=s.x+s.w,e=s.y,t=s.y+s.h,r=o.x,a=o.x+o.w,l=o.y,u=o.y+o.h;return n<=r&&r<=i&&e<=l&&l<=t||n<=a&&a<=i&&e<=l&&l<=t||n<=r&&r<=i&&e<=u&&u<=t||n<=a&&r<=i&&e<=u&&u<=t||r<=n&&n<=a&&l<=e&&e<=u||r<=i&&i<=a&&l<=e&&e<=u||r<=n&&n<=a&&l<=t&&t<=u||r<=i&&n<=a&&l<=t&&t<=u}function Ne(s,o,n){var i=ze(s,o),e=Jn(s,o),t=n>0?bo[e]:To[e],r=Math.atan(i),a=Math.abs(n*Math.sin(r))*t[1],l=Math.abs(n*Math.cos(r))*t[0];return{x:s.x+l,y:s.y+a}}function Do(s,o,n){var i=ze(s,o),e=Math.atan(-1/i),t=n/2*Math.sin(e),r=n/2*Math.cos(e);return[{x:o.x+r,y:o.y+t},{x:o.x-r,y:o.y-t}]}function Oo(s,o,n,i){n=n==null?o.thresholdX==null?o.w/2:o.thresholdX:n,i=i==null?o.thresholdY==null?o.h/2:o.thresholdY:i;var e=Math.floor(s.x/o.w),t=o.w*e,r=t+o.w,a=Math.abs(s.x-t)<=n?t:Math.abs(r-s.x)<=n?r:s.x,l=Math.floor(s.y/o.h),u=o.h*l,c=u+o.h,h=Math.abs(s.y-u)<=i?u:Math.abs(c-s.y)<=i?c:s.y;return{x:a,y:h}}var Ce;(function(s){s.Circle="Circle",s.Ellipse="Ellipse",s.Triangle="Triangle",s.Diamond="Diamond",s.Rectangle="Rectangle",s.Square="Square"})(Ce||(Ce={}));var Qe;(function(s){s.Assign="Assign",s.AutoDefault="AutoDefault",s.Bottom="Bottom",s.BottomLeft="BottomLeft",s.BottomRight="BottomRight",s.Center="Center",s.Continuous="Continuous",s.ContinuousBottom="ContinuousBottom",s.ContinuousLeft="ContinuousLeft",s.ContinuousRight="ContinuousRight",s.ContinuousTop="ContinuousTop",s.ContinuousLeftRight="ContinuousLeftRight",s.ContinuousTopBottom="ContinuousTopBottom",s.Left="Left",s.Perimeter="Perimeter",s.Right="Right",s.Top="Top",s.TopLeft="TopLeft",s.TopRight="TopRight"})(Qe||(Qe={}));function wo(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function tr(s,o){for(var n=0;n<o.length;n++){var i=o[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,i.key,i)}}function Io(s,o,n){return o&&tr(s.prototype,o),n&&tr(s,n),s}function et(s,o,n){return o in s?Object.defineProperty(s,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[o]=n,s}function Mo(){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}function rn(){return{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}var nr=function(){function s(o){wo(this,s),this.params=o,et(this,"x1",void 0),et(this,"x2",void 0),et(this,"y1",void 0),et(this,"y2",void 0),et(this,"extents",rn()),et(this,"type",void 0),this.x1=o.x1,this.y1=o.y1,this.x2=o.x2,this.y2=o.y2}return Io(s,[{key:"findClosestPointOnPath",value:function(n,i){return Mo()}},{key:"lineIntersection",value:function(n,i,e,t){return[]}},{key:"boxIntersection",value:function(n,i,e,t){var r=[];return r.push.apply(r,this.lineIntersection(n,i,n+e,i)),r.push.apply(r,this.lineIntersection(n+e,i,n+e,i+t)),r.push.apply(r,this.lineIntersection(n+e,i+t,n,i+t)),r.push.apply(r,this.lineIntersection(n,i+t,n,i)),r}},{key:"boundingBoxIntersection",value:function(n){return this.boxIntersection(n.x,n.y,n.w,n.h)}}]),s}(),ir="undefined",sn="default",rr="true",tt="false",nt="*";function G(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function sr(s,o){for(var n=0;n<o.length;n++){var i=o[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,i.key,i)}}function L(s,o,n){return o&&sr(s.prototype,o),n&&sr(s,n),s}function d(s,o,n){return o in s?Object.defineProperty(s,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[o]=n,s}function F(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),o&&Zn(s,o)}function z(s){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},z(s)}function Zn(s,o){return Zn=Object.setPrototypeOf||function(i,e){return i.__proto__=e,i},Zn(s,o)}function Go(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function p(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function No(s,o){return o&&(typeof o=="object"||typeof o=="function")?o:p(s)}function j(s){var o=Go();return function(){var i=z(s),e;if(o){var t=z(this).constructor;e=Reflect.construct(i,arguments,t)}else e=i.apply(this,arguments);return No(this,e)}}function Lo(s,o){for(;!Object.prototype.hasOwnProperty.call(s,o)&&(s=z(s),s!==null););return s}function te(s,o,n){return typeof Reflect!="undefined"&&Reflect.get?te=Reflect.get:te=function(e,t,r){var a=Lo(e,t);if(!!a){var l=Object.getOwnPropertyDescriptor(a,t);return l.get?l.get.call(r):l.value}},te(s,o,n||s)}function zn(s,o){return Fo(s)||Ho(s,o)||or(s,o)||Vo()}function on(s){return Ro(s)||jo(s)||or(s)||Bo()}function Ro(s){if(Array.isArray(s))return Qn(s)}function Fo(s){if(Array.isArray(s))return s}function jo(s){if(typeof Symbol!="undefined"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function Ho(s,o){var n=s==null?null:typeof Symbol!="undefined"&&s[Symbol.iterator]||s["@@iterator"];if(n!=null){var i=[],e=!0,t=!1,r,a;try{for(n=n.call(s);!(e=(r=n.next()).done)&&(i.push(r.value),!(o&&i.length===o));e=!0);}catch(l){t=!0,a=l}finally{try{!e&&n.return!=null&&n.return()}finally{if(t)throw a}}return i}}function or(s,o){if(!!s){if(typeof s=="string")return Qn(s,o);var n=Object.prototype.toString.call(s).slice(8,-1);if(n==="Object"&&s.constructor&&(n=s.constructor.name),n==="Map"||n==="Set")return Array.from(s);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qn(s,o)}}function Qn(s,o){(o==null||o>s.length)&&(o=s.length);for(var n=0,i=new Array(o);n<o;n++)i[n]=s[n];return i}function Bo(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vo(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ar={},lr={},ur={},xe={get:function(o,n,i){var e=ar[n];if(e)return new e(o,i);throw{message:"jsPlumb: unknown endpoint type '"+n+"'"}},clone:function(o){var n=ur[o.type];return xe.get(o.endpoint,o.type,n.getParams(o))},compute:function(o,n,i,e){var t=lr[o.type];if(t!=null)return t(o,n,i,e);ee("jsPlumb: cannot find endpoint calculator for endpoint of type ",o.type)},registerHandler:function(o){ur[o.type]=o,ar[o.type]=o.cls,lr[o.type]=o.compute}},it=function(){function s(o,n){G(this,s),this.endpoint=o,d(this,"typeId",void 0),d(this,"x",void 0),d(this,"y",void 0),d(this,"w",void 0),d(this,"h",void 0),d(this,"computedValue",void 0),d(this,"bounds",rn()),d(this,"classes",[]),d(this,"instance",void 0),d(this,"type",void 0),n=n||{},this.instance=o.instance,o.cssClass&&this.classes.push(o.cssClass),n.cssClass&&this.classes.push(n.cssClass)}return L(s,[{key:"addClass",value:function(n){this.classes.push(n),this.instance.addEndpointClass(this.endpoint,n)}},{key:"removeClass",value:function(n){this.classes=this.classes.filter(function(i){return i!==n}),this.instance.removeEndpointClass(this.endpoint,n)}},{key:"compute",value:function(n,i,e){this.computedValue=xe.compute(this,n,i,e),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(n){this.instance.setEndpointVisible(this.endpoint,n)}}]),s}(),rt=function(s){F(n,s);var o=j(n);function n(i,e){var t;return G(this,n),t=o.call(this,i,e),d(p(t),"radius",void 0),d(p(t),"defaultOffset",void 0),d(p(t),"defaultInnerRadius",void 0),d(p(t),"type",n.type),e=e||{},t.radius=e.radius||5,t.defaultOffset=.5*t.radius,t.defaultInnerRadius=t.radius/3,t}return n}(it);d(rt,"type","Dot");var Uo={type:rt.type,cls:rt,compute:function(o,n,i,e){var t=n.curX-o.radius,r=n.curY-o.radius,a=o.radius*2,l=o.radius*2;if(e&&e.stroke){var u=e.strokeWidth||1;t-=u,r-=u,a+=u*2,l+=u*2}return o.x=t,o.y=r,o.w=a,o.h=l,[t,r,a,l,o.radius]},getParams:function(o){return{radius:o.radius}}},an=function(s){F(n,s);var o=j(n);function n(i,e){var t;return G(this,n),t=o.call(this,i,e),d(p(t),"type",n.type),t}return n}(it);d(an,"type","Blank");var Yo={type:an.type,cls:an,compute:function(o,n,i,e){return o.x=n.curX,o.y=n.curY,o.w=10,o.h=0,[n.curX,n.curY,10,0]},getParams:function(o){return{}}},ln=function(s){F(n,s);var o=j(n);function n(i,e){var t;return G(this,n),t=o.call(this,i,e),d(p(t),"width",void 0),d(p(t),"height",void 0),d(p(t),"type",n.type),e=e||{},t.width=e.width||10,t.height=e.height||10,t}return L(n,null,[{key:"_getParams",value:function(e){return{width:e.width,height:e.height}}}]),n}(it);d(ln,"type","Rectangle");var Xo={type:ln.type,cls:ln,compute:function(o,n,i,e){var t=e.width||o.width,r=e.height||o.height,a=n.curX-t/2,l=n.curY-r/2;return o.x=a,o.y=l,o.w=t,o.h=r,[a,l,t,r]},getParams:function(o){return{width:o.width,height:o.height}}},ei=function(){function s(o,n){G(this,s),this.connection=o,d(this,"type",void 0),d(this,"edited",!1),d(this,"stub",void 0),d(this,"sourceStub",void 0),d(this,"targetStub",void 0),d(this,"maxStub",void 0),d(this,"typeId",void 0),d(this,"gap",void 0),d(this,"sourceGap",void 0),d(this,"targetGap",void 0),d(this,"segments",[]),d(this,"totalLength",0),d(this,"segmentProportions",[]),d(this,"segmentProportionalLengths",[]),d(this,"paintInfo",null),d(this,"strokeWidth",void 0),d(this,"x",void 0),d(this,"y",void 0),d(this,"w",void 0),d(this,"h",void 0),d(this,"segment",void 0),d(this,"bounds",rn()),d(this,"cssClass",void 0),d(this,"hoverClass",void 0),d(this,"geometry",void 0),this.stub=n.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=n.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=n.cssClass||"",this.hoverClass=n.hoverClass||""}return L(s,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(n,i){this.geometry=n,this.edited=n!=null&&!i}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(n){return this.geometry=n,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"resetBounds",value:function(){this.bounds=rn()}},{key:"findSegmentForPoint",value:function(n,i){for(var e={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},t=0;t<this.segments.length;t++){var r=this.segments[t].findClosestPointOnPath(n,i);r.d<e.d&&(e.d=r.d,e.l=r.l,e.x=r.x,e.y=r.y,e.s=this.segments[t],e.x1=r.x1,e.x2=r.x2,e.y1=r.y1,e.y2=r.y2,e.index=t,e.connectorLocation=this.segmentProportions[t][0]+r.l*(this.segmentProportions[t][1]-this.segmentProportions[t][0]))}return e}},{key:"lineIntersection",value:function(n,i,e,t){for(var r=[],a=0;a<this.segments.length;a++)r.push.apply(r,this.segments[a].lineIntersection(n,i,e,t));return r}},{key:"boxIntersection",value:function(n,i,e,t){for(var r=[],a=0;a<this.segments.length;a++)r.push.apply(r,this.segments[a].boxIntersection(n,i,e,t));return r}},{key:"boundingBoxIntersection",value:function(n){for(var i=[],e=0;e<this.segments.length;e++)i.push.apply(i,this.segments[e].boundingBoxIntersection(n));return i}},{key:"_updateSegmentProportions",value:function(){for(var n=0,i=0;i<this.segments.length;i++){var e=this.segments[i].getLength();this.segmentProportionalLengths[i]=e/this.totalLength,this.segmentProportions[i]=[n,n+=e/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(n,i){var e,t,r;if(i&&(n=n>0?n/this.totalLength:(this.totalLength+n)/this.totalLength),n===1)e=this.segments.length-1,r=1;else if(n===0)r=0,e=0;else if(n>=.5){for(e=0,r=0,t=this.segmentProportions.length-1;t>-1;t--)if(this.segmentProportions[t][1]>=n&&this.segmentProportions[t][0]<=n){e=t,r=(n-this.segmentProportions[t][0])/this.segmentProportionalLengths[t];break}}else for(e=this.segmentProportions.length-1,r=1,t=0;t<this.segmentProportions.length;t++)if(this.segmentProportions[t][1]>=n){e=t,r=(n-this.segmentProportions[t][0])/this.segmentProportionalLengths[t];break}return{segment:this.segments[e],proportion:r,index:e}}},{key:"_addSegment",value:function(n,i){if(!(i.x1===i.x2&&i.y1===i.y2)){var e=new n(i);this.segments.push(e),this.totalLength+=e.getLength(),this.updateBounds(e)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(n){this.strokeWidth=n.strokeWidth;var i=n.sourcePos.curX,e=n.targetPos.curX,t=n.sourcePos.curY,r=n.targetPos.curY,a=Jn({x:i,y:t},{x:e,y:r}),l=e<i,u=r<t,c=[n.sourcePos.ox,n.sourcePos.oy],h=[n.targetPos.ox,n.targetPos.oy],f=l?e:i,v=u?r:t,g=Math.abs(e-i),E=Math.abs(r-t);if(c[0]===0&&c[1]===0||h[0]===0&&h[1]===0){var y=g>E?0:1,m=[1,0][y],C=y===0?i:t,k=y===0?e:r;c[y]=C>k?-1:1,h[y]=C>k?1:-1,c[m]=0,h[m]=0}var b=l?g+this.sourceGap*c[0]:this.sourceGap*c[0],A=u?E+this.sourceGap*c[1]:this.sourceGap*c[1],O=l?this.targetGap*h[0]:g+this.targetGap*h[0],T=u?this.targetGap*h[1]:E+this.targetGap*h[1],S=c[0]*h[0]+c[1]*h[1],I={sx:b,sy:A,tx:O,ty:T,xSpan:Math.abs(O-b),ySpan:Math.abs(T-A),mx:(b+O)/2,my:(A+T)/2,so:c,to:h,x:f,y:v,w:g,h:E,segment:a,startStubX:b+c[0]*this.sourceStub,startStubY:A+c[1]*this.sourceStub,endStubX:O+h[0]*this.targetStub,endStubY:T+h[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(b-O)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(A-T)>this.sourceStub+this.targetStub,opposite:S===-1,perpendicular:S===0,orthogonal:S===1,sourceAxis:c[0]===0?"y":"x",points:[f,v,g,E,b,A,O,T],stubs:[this.sourceStub,this.targetStub]};return I.anchorOrientation=I.opposite?"opposite":I.orthogonal?"orthogonal":"perpendicular",I}},{key:"updateBounds",value:function(n){var i=n.extents;this.bounds.xmin=Math.min(this.bounds.xmin,i.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,i.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,i.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,i.ymax)}},{key:"dumpSegmentsToConsole",value:function(){ee("SEGMENTS:");for(var n=0;n<this.segments.length;n++)ee(this.segments[n].type,""+this.segments[n].getLength(),""+this.segmentProportions[n])}},{key:"pointOnPath",value:function(n,i){var e=this._findSegmentForLocation(n,i);return e.segment&&e.segment.pointOnPath(e.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(n,i){var e=this._findSegmentForLocation(n,i);return e.segment&&e.segment.gradientAtPoint(e.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(n,i,e){var t=this._findSegmentForLocation(n,e);return t.segment&&t.segment.pointAlongPathFrom(t.proportion,i,!1)||{x:0,y:0}}},{key:"compute",value:function(n){this.paintInfo=this._prepareCompute(n),this._clearSegments(),this._compute(this.paintInfo,n),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(n,i){}}]),s}(),Le=function(s){F(n,s);var o=j(n);function n(i){var e;return G(this,n),e=o.call(this,i),d(p(e),"length",void 0),d(p(e),"m",void 0),d(p(e),"m2",void 0),d(p(e),"type",n.segmentType),e._setCoordinates({x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2}),e}return L(n,[{key:"getPath",value:function(e){return(e?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=ze({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(e){this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this._recalc()}},{key:"pointOnPath",value:function(e,t){if(e===0&&!t)return{x:this.x1,y:this.y1};if(e===1&&!t)return{x:this.x2,y:this.y2};var r=t?e>0?e:this.length+e:e*this.length;return Ne({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},r)}},{key:"gradientAtPoint",value:function(e,t){return this.m}},{key:"pointAlongPathFrom",value:function(e,t,r){var a=this.pointOnPath(e,r),l=t<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return t<=0&&Math.abs(t)>1&&(t*=-1),Ne(a,l,t)}},{key:"within",value:function(e,t,r){return r>=Math.min(e,t)&&r<=Math.max(e,t)}},{key:"closest",value:function(e,t,r){return Math.abs(r-e)<Math.abs(r-t)?e:t}},{key:"findClosestPointOnPath",value:function(e,t){var r={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(this.m===0)r.y=this.y1,r.x=this.within(this.x1,this.x2,e)?e:this.closest(this.x1,this.x2,e);else if(this.m===1/0||this.m===-1/0)r.x=this.x1,r.y=this.within(this.y1,this.y2,t)?t:this.closest(this.y1,this.y2,t);else{var a=this.y1-this.m*this.x1,l=t-this.m2*e,u=(l-a)/(this.m-this.m2),c=this.m*u+a;r.x=this.within(this.x1,this.x2,u)?u:this.closest(this.x1,this.x2,u),r.y=this.within(this.y1,this.y2,c)?c:this.closest(this.y1,this.y2,c)}var h=Kn({x:r.x,y:r.y},{x:this.x1,y:this.y1});return r.d=Kn({x:e,y:t},r),r.l=h/length,r}},{key:"_pointLiesBetween",value:function(e,t,r){return r>t?t<=e&&e<=r:t>=e&&e>=r}},{key:"lineIntersection",value:function(e,t,r,a){var l=Math.abs(ze({x:e,y:t},{x:r,y:a})),u=Math.abs(this.m),c=u===1/0?this.x1:this.y1-u*this.x1,h=[],f=l===1/0?e:t-l*e;if(l!==u)if(l===1/0&&u===0)this._pointLiesBetween(e,this.x1,this.x2)&&this._pointLiesBetween(this.y1,t,a)&&h.push({x:e,y:this.y1});else if(l===0&&u===1/0)this._pointLiesBetween(t,this.y1,this.y2)&&this._pointLiesBetween(this.x1,e,r)&&h.push({x:this.x1,y:t});else{var v,g;l===1/0?(v=e,this._pointLiesBetween(v,this.x1,this.x2)&&(g=u*e+c,this._pointLiesBetween(g,t,a)&&h.push({x:v,y:g}))):l===0?(g=t,this._pointLiesBetween(g,this.y1,this.y2)&&(v=(t-c)/u,this._pointLiesBetween(v,e,r)&&h.push({x:v,y:g}))):(v=(f-c)/(u-l),g=u*v+c,this._pointLiesBetween(v,this.x1,this.x2)&&this._pointLiesBetween(g,this.y1,this.y2)&&h.push({x:v,y:g}))}return h}},{key:"boxIntersection",value:function(e,t,r,a){var l=[];return l.push.apply(l,this.lineIntersection(e,t,e+r,t)),l.push.apply(l,this.lineIntersection(e+r,t,e+r,t+a)),l.push.apply(l,this.lineIntersection(e+r,t+a,e,t+a)),l.push.apply(l,this.lineIntersection(e,t+a,e,t)),l}}]),n}(nr);d(Le,"segmentType","Straight");var un=function(s){F(n,s);var o=j(n);function n(){var i;G(this,n);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return i=o.call.apply(o,[this].concat(t)),d(p(i),"type",n.type),i}return L(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){this._addSegment(Le,{x1:e.sx,y1:e.sy,x2:e.startStubX,y2:e.startStubY}),this._addSegment(Le,{x1:e.startStubX,y1:e.startStubY,x2:e.endStubX,y2:e.endStubY}),this._addSegment(Le,{x1:e.endStubX,y1:e.endStubY,x2:e.tx,y2:e.ty}),this.geometry={source:t.sourcePos,target:t.targetPos}}}]),n}(ei);d(un,"type","Straight");var cr={},ti={get:function(o,n,i){var e=cr[n];if(e)return new e(o,i);throw{message:"jsPlumb: unknown connector type '"+n+"'"}},register:function(o,n){cr[o]=n}};function st(){for(var s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return o.map(function(i){return"."+i}).join(",")}function $o(){for(var s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return o.join(" ")}function ni(){for(var s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return o.map(function(i){return"["+i+"]"}).join(",")}var hr="source",dr="target",ii="block",Re="none",ot="absolute",fr="fixed",Wo="static",vr="data-jtk-group",Fe="data-jtk-managed",cn="data-jtk-not-draggable",pr="tabindex",qo="data-jtk-scope",gr=qo+"-",yr="checkCondition",Ko="checkDropAllowed",ri="jtk-connector",Jo="jtk-connector-outline",Zo="jtk-connected",Dt="jtk-endpoint",zo="jtk-endpoint-connected",Qo="jtk-endpoint-full",ea="jtk-endpoint-drop-allowed",ta="jtk-endpoint-drop-forbidden",na="jtk-endpoint-anchor",hn="jtk-group-collapsed",Ot="jtk-group-expanded",dn="jtk-overlay",ia="anchor:changed",ra="connection",_r="internal.connection",sa="connection:detach",mr="connection:move",oa="container:change",aa="endpoint:replaced",Er="internal.endpoint:unregistered",si="internal.connection:detached",la="element:manage",ua="group:added",ca="group:collapse",ha="group:expand",da="group:member:added",fa="group:member:removed",va="group:removed",Cr="maxConnections",pa="group:nested:added",ga="group:nested:removed",ya="element:unmanage",xr="zoom",at="isDetachAllowed",_a="beforeDrag",ma="beforeDrop",kr="beforeDetach",Ea="beforeStartDetach",U=ni(Fe),Ca="Cannot establish connection: source endpoint is full",xa="Cannot establish connection: target endpoint is full",ka="Cannot establish connection: source does not exist",Sa="Cannot establish connection: target does not exist",ba="connectionOverlays";function oi(s){var o=null;return R(s)?o={type:s,options:{}}:o=s,o.options.id=o.options.id||X(),o}var fn=function(s){F(n,s);var o=j(n);function n(i,e,t){var r;G(this,n),r=o.call(this),r.instance=i,r.component=e,d(p(r),"id",void 0),d(p(r),"type",void 0),d(p(r),"cssClass",void 0),d(p(r),"visible",!0),d(p(r),"location",void 0),d(p(r),"events",void 0),t=t||{},r.id=t.id||X(),r.cssClass=t.cssClass||"",r.location=t.location||.5,r.events=t.events||{};for(var a in r.events)r.bind(a,r.events[a]);return r}return L(n,[{key:"shouldFireEvent",value:function(e,t,r){return!0}},{key:"setVisible",value:function(e){this.visible=e,this.instance.setOverlayVisible(this,e)}},{key:"isVisible",value:function(){return this.visible}}]),n}(At),Sr={},je={get:function(o,n,i,e){var t=Sr[n];if(t)return new t(o,i,e);throw{message:"jsPlumb: unknown overlay type '"+n+"'"}},register:function(o,n){Sr[o]=n}},lt=function(s){F(n,s);var o=j(n);function n(i,e,t){var r;return G(this,n),r=o.call(this,i,e,t),r.instance=i,r.component=e,d(p(r),"label",void 0),d(p(r),"labelText",void 0),d(p(r),"type",n.type),d(p(r),"cachedDimensions",void 0),t=t||{label:""},r.setLabel(t.label),r}return L(n,[{key:"getLabel",value:function(){return Me(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(e){this.label=e,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(e){e.label!=null&&this.setLabel(e.label)}}]),n}(fn);d(lt,"type","Label");function ke(s){return s.type===lt.type}je.register("Label",lt);function vn(s){return s==null?null:s.split(" ")}function br(s,o,n){for(var i in o)s[i]=n}var Ta="connector",Pa="override",Aa="cssClass",Tr="__default",Da="anchor",Oa="anchors",wt="__label",wa="overlay",Ia="labelLocation",Pr="add",Ar="remove";function ut(s,o){if(s.getDefaultType){var n=s.getTypeDescriptor(),i={},e=s.getDefaultType(),t=w({},e);br(i,e,Tr);for(var r=0,a=s._types.length;r<a;r++){var l=s._types[r];if(l!==Tr){var u=s.instance.getType(l,n);if(u!=null){var c=new Set([Ta,Da,Oa]);if(u.mergeStrategy===Pa)for(var h in u)c.add(h);t=zt(t,u,[Aa],yo(c)),br(i,u,l)}}}o&&(t=vo(t,o,"_")),s.applyType(t,i)}}function ai(s,o){var n=s._types[o],i=s.instance.getType(n,s.getTypeDescriptor());i!=null&&i.cssClass&&s.removeClass(i.cssClass)}function Dr(s){if(s.paintStyle&&s.hoverPaintStyle){var o={};w(o,s.paintStyle),w(o,s.hoverPaintStyle),s.hoverPaintStyle=o}}function Ma(s,o){var n={cssClass:o.cssClass,id:wt,component:s},i=w(n,o);return new lt(s.instance,s,i)}function Ga(s,o){var n=null;if(R(o))n=je.get(s.instance,o,s,{});else if(o.type!=null&&o.options!=null){var i=o,e=w({},i.options);n=je.get(s.instance,i.type,s,e)}else n=o;return n.id=n.id||X(),s.cacheTypeItem(wa,n,n.id),s.overlays[n.id]=n,n}var Or=function(s){F(n,s);var o=j(n);function n(i,e){var t;if(G(this,n),t=o.call(this),t.instance=i,d(p(t),"defaultLabelLocation",.5),d(p(t),"overlays",{}),d(p(t),"overlayPositions",{}),d(p(t),"overlayPlacements",{}),d(p(t),"clone",void 0),d(p(t),"deleted",void 0),d(p(t),"segment",void 0),d(p(t),"x",void 0),d(p(t),"y",void 0),d(p(t),"w",void 0),d(p(t),"h",void 0),d(p(t),"id",void 0),d(p(t),"visible",!0),d(p(t),"typeId",void 0),d(p(t),"params",{}),d(p(t),"paintStyle",void 0),d(p(t),"hoverPaintStyle",void 0),d(p(t),"paintStyleInUse",void 0),d(p(t),"_hover",!1),d(p(t),"lastPaintedAt",void 0),d(p(t),"data",void 0),d(p(t),"_defaultType",void 0),d(p(t),"events",void 0),d(p(t),"parameters",void 0),d(p(t),"_types",void 0),d(p(t),"_typeCache",void 0),d(p(t),"cssClass",void 0),d(p(t),"hoverClass",void 0),d(p(t),"beforeDetach",void 0),d(p(t),"beforeDrop",void 0),e=e||{},t.cssClass=e.cssClass||"",t.hoverClass=e.hoverClass||i.defaults.hoverClass,t.beforeDetach=e.beforeDetach,t.beforeDrop=e.beforeDrop,t._types=[],t._typeCache={},t.parameters=Zt(e.parameters||{}),t.id=e.id||t.getIdPrefix()+new Date().getTime(),t._defaultType={parameters:t.parameters,scope:e.scope||t.instance.defaultScope,overlays:{}},e.events)for(var r in e.events)t.bind(r,e.events[r]);t.clone=function(){var v=Object.create(t.constructor.prototype);return t.constructor.apply(v,[i,e]),v},t.overlays={},t.overlayPositions={};var a=e.overlays||[],l={},u=t.getDefaultOverlayKey();if(u){var c=t.instance.defaults[u];c&&a.push.apply(a,on(c));for(var h=0;h<a.length;h++){var f=oi(a[h]);l[f.options.id]=f}}return t._defaultType.overlays=l,e.label&&(t.getDefaultType().overlays[wt]={type:lt.type,options:{label:e.label,location:e.labelLocation||t.defaultLabelLocation,id:wt}}),t}return L(n,[{key:"isDetachAllowed",value:function(e){var t=!0;if(this.beforeDetach)try{t=this.beforeDetach(e)}catch(r){ee("jsPlumb: beforeDetach callback failed",r)}return t}},{key:"isDropAllowed",value:function(e,t,r,a,l){var u,c={sourceId:e,targetId:t,scope:r,connection:a,dropEndpoint:l};if(this.beforeDrop)try{u=this.beforeDrop(c)}catch(h){ee("jsPlumb: beforeDrop callback failed",h)}else u=this.instance.checkCondition(ma,c);return u}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(e){for(var t in e)this._defaultType[t]=e[t]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(e,t,r){this._typeCache[r]=this._typeCache[r]||{},this._typeCache[r][e]=t}},{key:"getCachedTypeItem",value:function(e,t){return this._typeCache[t]?this._typeCache[t][e]:null}},{key:"setType",value:function(e,t){this.clearTypes(),this._types=vn(e)||[],ut(this,t)}},{key:"getType",value:function(){return this._types}},{key:"reapplyTypes",value:function(e){ut(this,e)}},{key:"hasType",value:function(e){return this._types.indexOf(e)!==-1}},{key:"addType",value:function(e,t){var r=vn(e),a=!1;if(r!=null){for(var l=0,u=r.length;l<u;l++)this.hasType(r[l])||(this._types.push(r[l]),a=!0);a&&ut(this,t)}}},{key:"removeType",value:function(e,t){var r=this,a=vn(e),l=!1,u=function(v){var g=r._types.indexOf(v);return g!==-1?(ai(r,g),r._types.splice(g,1),!0):!1};if(a!=null){for(var c=0,h=a.length;c<h;c++)l=u(a[c])||l;l&&ut(this,t)}}},{key:"clearTypes",value:function(e,t){for(var r=this._types.length,a=0;a<r;a++)ai(this,0),this._types.splice(0,1);ut(this,e)}},{key:"toggleType",value:function(e,t){var r=vn(e);if(r!=null){for(var a=0,l=r.length;a<l;a++){var u=this._types.indexOf(r[a]);u!==-1?(ai(this,u),this._types.splice(u,1)):this._types.push(r[a])}ut(this,t)}}},{key:"applyType",value:function(e,t){if(this.setPaintStyle(e.paintStyle),this.setHoverPaintStyle(e.hoverPaintStyle),this.mergeParameters(e.parameters),this.paintStyleInUse=this.getPaintStyle(),e.overlays){var r={},a;for(a in e.overlays){var l=this.overlays[e.overlays[a].options.id];if(l)l.updateFrom(e.overlays[a].options),r[e.overlays[a].options.id]=!0,this.instance.reattachOverlay(l,this);else{var u=this.getCachedTypeItem("overlay",e.overlays[a].options.id);u!=null?(this.instance.reattachOverlay(u,this),u.setVisible(!0),u.updateFrom(e.overlays[a].options),this.overlays[u.id]=u):u=this.addOverlay(e.overlays[a]),r[u.id]=!0}}for(a in this.overlays)r[this.overlays[a].id]==null&&this.removeOverlay(this.overlays[a].id,!0)}}},{key:"setPaintStyle",value:function(e){this.paintStyle=e,this.paintStyleInUse=this.paintStyle,Dr(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(e){this.hoverPaintStyle=e,Dr(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(e){e!=null&&w(this.parameters,e)}},{key:"setVisible",value:function(e){this.visible=e,e?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(e,t){this.overlayPositions[e.id]=t}},{key:"getAbsoluteOverlayPosition",value:function(e){return this.overlayPositions?this.overlayPositions[e.id]:null}},{key:"_clazzManip",value:function(e,t){for(var r in this.overlays)e===Pr?this.instance.addOverlayClass(this.overlays[r],t):e===Ar&&this.instance.removeOverlayClass(this.overlays[r],t)}},{key:"addClass",value:function(e,t){var r=(this.cssClass||"").split(" ");r.push(e),this.cssClass=r.join(" "),this._clazzManip(Pr,e)}},{key:"removeClass",value:function(e,t){var r=(this.cssClass||"").split(" ");this.cssClass=r.filter(function(a){return a!==e}).join(" "),this._clazzManip(Ar,e)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(e,t,r){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(e){this.data=e||{}}},{key:"mergeData",value:function(e){this.data=w(this.data,e)}},{key:"addOverlay",value:function(e){var t=Ga(this,e);if(this.getData&&t.type===lt.type&&!R(e)){var r=this.getData(),a=e.options;if(r){var l=a.labelLocationAttribute||Ia,u=r[l];u&&(t.location=u)}}return t}},{key:"getOverlay",value:function(e){return this.overlays[e]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var e in this.overlays)this.overlays[e].setVisible(!1)}},{key:"showOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!0)}},{key:"showOverlays",value:function(){for(var e in this.overlays)this.overlays[e].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(e,t){var r=this.overlays[e];r&&(r.setVisible(!1),t||this.instance.destroyOverlay(r),delete this.overlays[e],this.overlayPositions&&delete this.overlayPositions[e],this.overlayPlacements&&delete this.overlayPlacements[e])}},{key:"removeOverlays",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var a=0,l=t.length;a<l;a++)this.removeOverlay(arguments[a])}},{key:"getLabel",value:function(){var e=this.getLabelOverlay();return e!=null?e.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(wt)}},{key:"setLabel",value:function(e){var t=this.getLabelOverlay();if(t)if(R(e)||Me(e))t.setLabel(e);else{var a=e;a.label&&t.setLabel(a.label),a.location&&(t.location=a.location)}else{var r=R(e)||Me(e)?{label:e}:e;t=Ma(this,r),this.overlays[wt]=t}}}]),n}(At),ct,ht,dt,ft;(function(s){s.top="top",s.left="left",s.right="right",s.bottom="bottom"})(ft||(ft={}));var H=ft.top,K=ft.left,$=ft.right,Q=ft.bottom,Na=[K,$],La=[H,Q],Ra=function(){function s(o,n){G(this,s),this.instance=o,this.element=n,d(this,"isFloating",!0),d(this,"isContinuous",void 0),d(this,"isDynamic",void 0),d(this,"locations",[{x:0,y:0,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}]),d(this,"currentLocation",0),d(this,"locked",!1),d(this,"cssClass",""),d(this,"timestamp",null),d(this,"type","Floating"),d(this,"id",X()),d(this,"orientation",[0,0]),d(this,"size",void 0),this.size=o.getSize(n)}return L(s,[{key:"over",value:function(n){this.orientation=this.instance.router.getEndpointOrientation(n),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1]}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy}}]),s}(),wr=(ct={},d(ct,H,Q),d(ct,$,K),d(ct,K,$),d(ct,Q,H),ct),Ir=(ht={},d(ht,H,$),d(ht,$,Q),d(ht,K,H),d(ht,Q,K),ht),Mr=(dt={},d(dt,H,K),d(dt,$,H),d(dt,K,Q),d(dt,Q,$),dt);function Fa(s){return s.faces.length===0?H:s.faces[0]}function It(s,o){return s.faces.indexOf(o)!==-1}function ja(s,o){return(s.clockwise?Ir:Mr)[o]}function Ha(s,o){return(s.clockwise?Mr:Ir)[o]}function Gr(s,o){return s.lockedAxis==null?s.lockedFace==null?It(s,o)===!0:s.lockedFace===o:s.lockedAxis.indexOf(o)!==-1}function Ba(s,o){if(It(s,o))return o;if(It(s,wr[o]))return wr[o];var n=ja(s,o);if(It(s,n))return n;var i=Ha(s,o);return It(s,i)?i:o}var Nr={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},Lr={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},Rr={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},Fr={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},Va={x:0,y:0,ox:0,oy:-1,offx:0,offy:0},Ua={x:1,y:0,ox:1,oy:-1,offx:0,offy:0},Ya={x:0,y:1,ox:0,oy:1,offx:0,offy:0},Xa={x:1,y:1,ox:0,oy:1,offx:0,offy:0},$a={x:.5,y:.5,ox:0,oy:0,offx:0,offy:0},jr={Top:[Nr],Bottom:[Lr],Left:[Rr],Right:[Fr],TopLeft:[Va],TopRight:[Ua],BottomLeft:[Ya],BottomRight:[Xa],Center:[$a],AutoDefault:[Nr,Rr,Lr,Fr]},Wa={Continuous:{faces:[H,K,Q,$]},ContinuousTop:{faces:[H]},ContinuousRight:{faces:[$]},ContinuousBottom:{faces:[Q]},ContinuousLeft:{faces:[K]},ContinuousLeftRight:{faces:[K,$]},ContinuousTopBottom:{faces:[H,Q]}};function Hr(s,o){if(o=o||{},s===Qe.Perimeter)return tl(o);var n=jr[s];if(n!=null)return pn(s,qi(n,function(i){return w({iox:i.ox,ioy:i.oy},i)}),o);if(n=Wa[s],n!=null)return Ja(s,n.faces,o);throw{message:"jsPlumb: unknown anchor type '"+s+"'"}}function pn(s,o,n){return{type:s,locations:o,currentLocation:0,locked:!1,id:X(),isFloating:!1,isContinuous:!1,isDynamic:o.length>1,timestamp:null,cssClass:n.cssClass||""}}function qa(s,o){return new Ra(s,o)}var Ka="currentFace";function Ja(s,o,n){var i={type:s,locations:[],currentLocation:0,locked:!1,id:X(),cssClass:n.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:n.faces||o,lockedFace:null,lockedAxis:null,clockwise:n.clockwise!==!1,__currentFace:null};return Object.defineProperty(i,Ka,{get:function(){return this.__currentFace},set:function(t){this.__currentFace=Ba(this,t)}}),i}function Br(s){return s.length<7&&s.every(Yn)||s.length===7&&s.slice(0,5).every(Yn)&&R(s[6])}function Mt(s){if(R(s))return Hr(s,null);if(Array.isArray(s))if(Br(s)){var o=s;return pn(null,[{x:o[0],y:o[1],ox:o[2],oy:o[3],offx:o[4]==null?0:o[4],offy:o[5]==null?0:o[5],iox:o[2],ioy:o[3],cls:o[6]||""}],{cssClass:o[6]||""})}else{var n=qi(s,function(e){if(R(e)){var t=jr[e];return t!=null?w({iox:0,ioy:0,cls:""},t[0]):null}else if(Br(e))return{x:e[0],y:e[1],ox:e[2],oy:e[3],offx:e[4]==null?0:e[4],offy:e[5]==null?0:e[5],iox:e[2],ioy:e[3],cls:e[6]||""}}).filter(function(e){return e!=null});return pn("Dynamic",n,{})}else{var i=s;return Hr(i.type,i.options)}}function Vr(s){for(var o=.5,n=Math.PI*2/s,i=[],e=0,t=0;t<s;t++){var r=o+o*Math.sin(e),a=o+o*Math.cos(e);i.push({x:r,y:a,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),e+=n}return i}function Za(s,o){for(var n=o/s.length,i=[],e=function(a,l,u,c,h,f,v){n=o*h;for(var g=(u-a)/n,E=(c-l)/n,y=0;y<n;y++)i.push({x:a+g*y,y:l+E*y,ox:f==null?0:f,oy:v==null?0:v,offx:0,offy:0,iox:0,ioy:0,cls:""})},t=0;t<s.length;t++)e.apply(null,s[t]);return i}function li(s,o){for(var n=[],i=0;i<s.length;i++)n.push([s[i][0],s[i][1],s[i][2],s[i][3],1/s.length,s[i][4],s[i][5]]);return Za(n,o)}function Ur(s){return li([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],s)}function za(s){return li([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],s)}function Qa(s){return li([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],s)}function el(s,o){for(var n=[],i=o/180*Math.PI,e=0;e<s.length;e++){var t=s[e].x-.5,r=s[e].y-.5;n.push({x:.5+(t*Math.cos(i)-r*Math.sin(i)),y:.5+(t*Math.sin(i)+r*Math.cos(i)),ox:s[e].ox,oy:s[e].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}var Se=new Map;Se.set(Ce.Circle,Vr);Se.set(Ce.Ellipse,Vr);Se.set(Ce.Rectangle,Ur);Se.set(Ce.Square,Ur);Se.set(Ce.Diamond,za);Se.set(Ce.Triangle,Qa);function tl(s){s=s||{};var o=s.anchorCount||60,n=s.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");if(!Se.has(n))throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var i=Se.get(n)(o);s.rotation&&(i=el(i,s.rotation));var e=pn(Qe.Perimeter,i,s),t=w(e,{shape:n});return t}var gn="anchors",ui="connector";function Yr(s,o,n,i,e,t,r){var a;if(o)s.endpoints[n]=o,o.addConnection(s);else{var l=r||s.endpointSpec||s.endpointsSpec[n]||s.instance.defaults.endpoints[n]||s.instance.defaults.endpoint,u=s.endpointStyles[n]||s.endpointStyle||s.instance.defaults.endpointStyles[n]||s.instance.defaults.endpointStyle;u.fill==null&&s.paintStyle!=null&&(u.fill=s.paintStyle.stroke),u.outlineStroke==null&&s.paintStyle!=null&&(u.outlineStroke=s.paintStyle.outlineStroke),u.outlineWidth==null&&s.paintStyle!=null&&(u.outlineWidth=s.paintStyle.outlineWidth);var c=s.endpointHoverStyles[n]||s.endpointHoverStyle||s.endpointHoverStyle||s.instance.defaults.endpointHoverStyles[n]||s.instance.defaults.endpointHoverStyle;s.hoverPaintStyle!=null&&(c==null&&(c={}),c.fill==null&&(c.fill=s.hoverPaintStyle.stroke));var h=s.uuids?s.uuids[n]:null;i=i!=null?i:s.instance.defaults.anchors!=null?s.instance.defaults.anchors[n]:s.instance.defaults.anchor,a=s.instance._internal_newEndpoint({paintStyle:u,hoverPaintStyle:c,endpoint:l,connections:[s],uuid:h,element:e,scope:s.scope,anchor:i,reattachConnections:s.reattach||s.instance.defaults.reattachConnections,connectionsDetachable:s.detachable||s.instance.defaults.connectionsDetachable}),o==null&&(a.deleteOnEmpty=!0),s.endpoints[n]=a}return a}var Gt=function(s){F(n,s);var o=j(n);function n(i,e){var t;G(this,n),t=o.call(this,i,e),t.instance=i,d(p(t),"connector",void 0),d(p(t),"defaultLabelLocation",.5),d(p(t),"scope",void 0),d(p(t),"typeId","_jsplumb_connection"),d(p(t),"previousConnection",void 0),d(p(t),"sourceId",void 0),d(p(t),"targetId",void 0),d(p(t),"source",void 0),d(p(t),"target",void 0),d(p(t),"detachable",!0),d(p(t),"reattach",!1),d(p(t),"uuids",void 0),d(p(t),"cost",1),d(p(t),"directed",void 0),d(p(t),"endpoints",[null,null]),d(p(t),"endpointStyles",void 0),d(p(t),"endpointSpec",void 0),d(p(t),"endpointsSpec",void 0),d(p(t),"endpointStyle",{}),d(p(t),"endpointHoverStyle",{}),d(p(t),"endpointHoverStyles",void 0),d(p(t),"suspendedEndpoint",void 0),d(p(t),"suspendedIndex",void 0),d(p(t),"suspendedElement",void 0),d(p(t),"suspendedElementId",void 0),d(p(t),"suspendedElementType",void 0),d(p(t),"_forceReattach",void 0),d(p(t),"_forceDetach",void 0),d(p(t),"proxies",[]),d(p(t),"pending",!1),t.id=e.id,t.previousConnection=e.previousConnection,t.source=e.source,t.target=e.target,e.sourceEndpoint?(t.source=e.sourceEndpoint.element,t.sourceId=e.sourceEndpoint.elementId):t.sourceId=i.getId(t.source),e.targetEndpoint?(t.target=e.targetEndpoint.element,t.targetId=e.targetEndpoint.elementId):t.targetId=i.getId(t.target),t.scope=e.scope;var r=e.anchors?e.anchors[0]:e.anchor,a=e.anchors?e.anchors[1]:e.anchor;i.manage(t.source),i.manage(t.target),t.visible=!0,t.params={cssClass:e.cssClass,hoverClass:e.hoverClass,"pointer-events":e["pointer-events"],overlays:e.overlays},t.lastPaintedAt=null,e.type&&(e.endpoints=e.endpoints||t.instance._deriveEndpointAndAnchorSpec(e.type).endpoints),t.endpointSpec=e.endpoint,t.endpointsSpec=e.endpoints||[null,null],t.endpointStyle=e.endpointStyle,t.endpointHoverStyle=e.endpointHoverStyle,t.endpointStyles=e.endpointStyles||[null,null],t.endpointHoverStyles=e.endpointHoverStyles||[null,null],t.paintStyle=e.paintStyle,t.hoverPaintStyle=e.hoverPaintStyle,t.uuids=e.uuids,t.makeEndpoint(!0,t.source,t.sourceId,r,e.sourceEndpoint),t.makeEndpoint(!1,t.target,t.targetId,a,e.targetEndpoint),t.scope||(t.scope=t.endpoints[0].scope),e.deleteEndpointsOnEmpty!=null&&(t.endpoints[0].deleteOnEmpty=e.deleteEndpointsOnEmpty,t.endpoints[1].deleteOnEmpty=e.deleteEndpointsOnEmpty);var l=t.instance.defaults.connectionsDetachable;e.detachable===!1&&(l=!1),t.endpoints[0].connectionsDetachable===!1&&(l=!1),t.endpoints[1].connectionsDetachable===!1&&(l=!1),t.endpointsSpec=e.endpoints||[null,null],t.endpointSpec=e.endpoint||null;var u=e.reattach||t.endpoints[0].reattachConnections||t.endpoints[1].reattachConnections||t.instance.defaults.reattachConnections;if(t.appendToDefaultType({detachable:l,reattach:u,paintStyle:t.endpoints[0].connectorStyle||t.endpoints[1].connectorStyle||e.paintStyle||t.instance.defaults.paintStyle,hoverPaintStyle:t.endpoints[0].connectorHoverStyle||t.endpoints[1].connectorHoverStyle||e.hoverPaintStyle||t.instance.defaults.hoverPaintStyle}),!t.instance._suspendDrawing){var c=t.instance._suspendedAt||X();t.instance.paintEndpoint(t.endpoints[0],{timestamp:c}),t.instance.paintEndpoint(t.endpoints[1],{timestamp:c})}t.cost=e.cost||t.endpoints[0].connectionCost,t.directed=e.directed,e.directed==null&&(t.directed=t.endpoints[0].connectionsDirected);var h=w({},t.endpoints[1].parameters);w(h,t.endpoints[0].parameters),w(h,t.parameters),t.parameters=h,t.paintStyleInUse=t.getPaintStyle()||{},t.setConnector(t.endpoints[0].connector||t.endpoints[1].connector||e.connector||t.instance.defaults.connector,!0);var f=e.data==null||!Ze(e.data)?{}:e.data;t.setData(f);var v=[sn,t.endpoints[0].edgeType,t.endpoints[1].edgeType,e.type].join(" ");return/[^\s]/.test(v)&&t.addType(v,e.data),t}return L(n,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return ba}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(e,t,r,a,l){return r=r||this.instance.getId(t),Yr(this,l,e?0:1,a,t)}},{key:"getTypeDescriptor",value:function(){return n.type}},{key:"isDetachable",value:function(e){return this.detachable===!1?!1:e!=null?e.connectionsDetachable===!0:this.detachable===!0}},{key:"setDetachable",value:function(e){this.detachable=e===!0}},{key:"isReattach",value:function(){return this.reattach===!0||this.endpoints[0].reattachConnections===!0||this.endpoints[1].reattachConnections===!0}},{key:"setReattach",value:function(e){this.reattach=e===!0}},{key:"applyType",value:function(e,t){var r=null;e.connector!=null&&(r=this.getCachedTypeItem(ui,t.connector),r==null&&(r=this.prepareConnector(e.connector,t.connector),this.cacheTypeItem(ui,r,t.connector)),this.setPreparedConnector(r)),te(z(n.prototype),"applyType",this).call(this,e,t),e.detachable!=null&&this.setDetachable(e.detachable),e.reattach!=null&&this.setReattach(e.reattach),e.scope&&(this.scope=e.scope);var a=null;e.anchor?(a=this.getCachedTypeItem(gn,t.anchor),a==null&&(a=[Mt(e.anchor),Mt(e.anchor)],this.cacheTypeItem(gn,a,t.anchor))):e.anchors&&(a=this.getCachedTypeItem(gn,t.anchors),a==null&&(a=[Mt(e.anchors[0]),Mt(e.anchors[1])],this.cacheTypeItem(gn,a,t.anchors))),a!=null&&(this.instance.router.setConnectionAnchors(this,a),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,e)}},{key:"addClass",value:function(e,t){te(z(n.prototype),"addClass",this).call(this,e),t&&(this.endpoints[0].addClass(e),this.endpoints[1].addClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(e)),this.connector&&this.instance.addConnectorClass(this.connector,e)}},{key:"removeClass",value:function(e,t){te(z(n.prototype),"removeClass",this).call(this,e),t&&(this.endpoints[0].removeClass(e),this.endpoints[1].removeClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(e)),this.connector&&this.instance.removeConnectorClass(this.connector,e)}},{key:"setVisible",value:function(e){te(z(n.prototype),"setVisible",this).call(this,e),this.connector&&this.instance.setConnectorVisible(this.connector,e),this.instance.paintConnection(this)}},{key:"destroy",value:function(){te(z(n.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(e,t){var r={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]},a;if(R(e))a=this.instance.makeConnector(this,e,r);else{var l=e;a=this.instance.makeConnector(this,l.type,zt(l.options,r))}return t!=null&&(a.typeId=t),a}},{key:"setPreparedConnector",value:function(e,t,r,a){if(this.connector!==e){var l,u="";if(this.connector!=null&&(l=this.connector,u=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=e,a&&this.cacheTypeItem(ui,e,a),this.addClass(u),l!=null){var c=this.getOverlays();for(var h in c)this.instance.reattachOverlay(c[h],this)}t||this.instance.paintConnection(this)}}},{key:"setConnector",value:function(e,t,r,a){var l=this.prepareConnector(e,a);this.setPreparedConnector(l,t,r,a)}},{key:"replaceEndpoint",value:function(e,t){var r=this.endpoints[e],a=r.elementId,l=this.instance.getEndpoints(r.element),u=l.indexOf(r),c=Yr(this,null,e,null,r.element,a,t);this.endpoints[e]=c,l.splice(u,1,c),r.detachFromConnection(this),this.instance.deleteEndpoint(r),this.instance.fire(aa,{previous:r,current:c})}}]),n}(Or);d(Gt,"type","connection");var nl=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],yn=function(s){F(n,s);var o=j(n);function n(i,e){var t;G(this,n),t=o.call(this,i,e),t.instance=i,d(p(t),"connections",[]),d(p(t),"endpoint",void 0),d(p(t),"element",void 0),d(p(t),"elementId",void 0),d(p(t),"dragAllowedWhenFull",!0),d(p(t),"timestamp",void 0),d(p(t),"portId",void 0),d(p(t),"maxConnections",void 0),d(p(t),"proxiedBy",void 0),d(p(t),"connectorClass",void 0),d(p(t),"connectorHoverClass",void 0),d(p(t),"finalEndpoint",void 0),d(p(t),"enabled",!0),d(p(t),"isSource",void 0),d(p(t),"isTarget",void 0),d(p(t),"isTemporarySource",void 0),d(p(t),"connectionCost",1),d(p(t),"connectionsDirected",void 0),d(p(t),"connectionsDetachable",void 0),d(p(t),"reattachConnections",void 0),d(p(t),"currentAnchorClass",void 0),d(p(t),"referenceEndpoint",void 0),d(p(t),"edgeType",void 0),d(p(t),"connector",void 0),d(p(t),"connectorOverlays",void 0),d(p(t),"connectorStyle",void 0),d(p(t),"connectorHoverStyle",void 0),d(p(t),"deleteOnEmpty",void 0),d(p(t),"uuid",void 0),d(p(t),"scope",void 0),d(p(t),"_anchor",void 0),d(p(t),"defaultLabelLocation",[.5,.5]),t.appendToDefaultType({edgeType:e.edgeType,maxConnections:e.maxConnections==null?t.instance.defaults.maxConnections:e.maxConnections,paintStyle:e.paintStyle||t.instance.defaults.endpointStyle,hoverPaintStyle:e.hoverPaintStyle||t.instance.defaults.endpointHoverStyle,connectorStyle:e.connectorStyle,connectorHoverStyle:e.connectorHoverStyle,connectorClass:e.connectorClass,connectorHoverClass:e.connectorHoverClass,connectorOverlays:e.connectorOverlays,connector:e.connector}),t.enabled=e.enabled!==!1,t.visible=!0,t.element=e.element,t.uuid=e.uuid,t.portId=e.portId,t.elementId=e.elementId,t.connectionCost=e.connectionCost==null?1:e.connectionCost,t.connectionsDirected=e.connectionsDirected,t.currentAnchorClass="",t.events={},t.connectorOverlays=e.connectorOverlays,t.connectorStyle=e.connectorStyle,t.connectorHoverStyle=e.connectorHoverStyle,t.connector=e.connector,t.edgeType=e.edgeType,t.connectorClass=e.connectorClass,t.connectorHoverClass=e.connectorHoverClass,t.deleteOnEmpty=e.deleteOnEmpty===!0,t.isSource=e.source||!1,t.isTemporarySource=e.isTemporarySource||!1,t.isTarget=e.target||!1,t.connections=e.connections||[],t.scope=e.scope||i.defaultScope,t.timestamp=null,t.reattachConnections=e.reattachConnections||i.defaults.reattachConnections,t.connectionsDetachable=i.defaults.connectionsDetachable,e.connectionsDetachable===!1&&(t.connectionsDetachable=!1),t.dragAllowedWhenFull=e.dragAllowedWhenFull!==!1,e.onMaxConnections&&t.bind(Cr,e.onMaxConnections);var r=e.endpoint||e.existingEndpoint||i.defaults.endpoint;if(t.setEndpoint(r),e.preparedAnchor!=null)t.setPreparedAnchor(e.preparedAnchor);else{var a=e.anchor?e.anchor:e.anchors?e.anchors:i.defaults.anchor||Qe.Top;t.setAnchor(a)}var l=[sn,e.type||""].join(" ");return t.addType(l,e.data),t}return L(n,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var e=this._anchor&&this._anchor.cssClass;if(e!=null&&e.length>0){var t=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=e;var r=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");t!==r&&(this.removeClass(t),this.addClass(r),this.instance.removeClass(this.element,t),this.instance.addClass(this.element,r))}}},{key:"setPreparedAnchor",value:function(e){return this.instance.router.setAnchor(this,e),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(e){this.fire(ia,{endpoint:this,anchor:e}),this._updateAnchorClass()}},{key:"setAnchor",value:function(e){var t=this.instance.router.prepareAnchor(this,e);return this.setPreparedAnchor(t),this}},{key:"addConnection",value:function(e){var t=this.isFull(),r=this.connections.length===0;this.connections.push(e),r&&this.addClass(this.instance.endpointConnectedClass),this.isFull()?t||this.addClass(this.instance.endpointFullClass):t&&this.removeClass(this.instance.endpointFullClass)}},{key:"detachFromConnection",value:function(e,t,r){t=t==null?this.connections.indexOf(e):t,t>=0&&(this.connections.splice(t,1),this.instance.refreshEndpoint(this)),!r&&this.deleteOnEmpty&&this.connections.length===0&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(e){for(var t=this.connections.length,r=0;r<t;r++)this.instance.deleteConnection(this.connections[0],e)}},{key:"detachFrom",value:function(e){for(var t=[],r=0;r<this.connections.length;r++)(this.connections[r].endpoints[1]===e||this.connections[r].endpoints[0]===e)&&t.push(this.connections[r]);for(var a=0,l=t.length;a<l;a++)this.instance.deleteConnection(t[0]);return this}},{key:"setVisible",value:function(e,t,r){if(te(z(n.prototype),"setVisible",this).call(this,e),this.endpoint.setVisible(e),e?this.showOverlays():this.hideOverlays(),!t){for(var a=0;a<this.connections.length;a++)if(this.connections[a].setVisible(e),!r){var l=this===this.connections[a].endpoints[0]?1:0;this.connections[a].endpoints[l].connections.length===1&&this.connections[a].endpoints[l].setVisible(e,!0,!0)}}}},{key:"applyType",value:function(e,t){te(z(n.prototype),"applyType",this).call(this,e,t),this.setPaintStyle(e.endpointStyle||e.paintStyle),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle),this.connectorStyle=e.connectorStyle,this.connectorHoverStyle=e.connectorHoverStyle,this.connector=e.connector,this.connectorOverlays=e.connectorOverlays,this.edgeType=e.edgeType,e.maxConnections!=null&&(this.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),w(e,nl),this.instance.applyEndpointType(this,e)}},{key:"destroy",value:function(){te(z(n.prototype),"destroy",this).call(this),this.endpoint!=null&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return this.maxConnections===0?!0:!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(e){var t=!1;if(e){for(var r=0;r<this.connections.length;r++)if(this.connections[r].endpoints[1]===e||this.connections[r].endpoints[0]===e){t=!0;break}}return t}},{key:"setDragAllowedWhenFull",value:function(e){this.dragAllowedWhenFull=e}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(e,t){var r={cssClass:this.cssClass,endpoint:this},a;if(Ji(e,it)){var l=e;a=xe.clone(l)}else if(R(e))a=xe.get(this,e,r);else{var u=e;w(r,u.options||{}),a=xe.get(this,u.type,r)}return a.typeId=t,a}},{key:"setEndpoint",value:function(e){var t=this.prepareEndpoint(e);this.setPreparedEndpoint(t)}},{key:"setPreparedEndpoint",value:function(e){this.endpoint!=null&&this.instance.destroyEndpoint(this),this.endpoint=e}},{key:"addClass",value:function(e,t){te(z(n.prototype),"addClass",this).call(this,e,t),this.endpoint!=null&&this.endpoint.addClass(e)}},{key:"removeClass",value:function(e,t){te(z(n.prototype),"removeClass",this).call(this,e,t),this.endpoint!=null&&this.endpoint.removeClass(e)}}]),n}(Or),ci=function s(o,n){G(this,s),this.instance=o,this.el=n,d(this,"group",void 0)},il=function(s){F(n,s);var o=j(n);function n(i,e,t){var r;G(this,n),r=o.call(this,i,e),r.instance=i,d(p(r),"children",[]),d(p(r),"collapsed",!1),d(p(r),"droppable",void 0),d(p(r),"enabled",void 0),d(p(r),"orphan",void 0),d(p(r),"constrain",void 0),d(p(r),"proxied",void 0),d(p(r),"ghost",void 0),d(p(r),"revert",void 0),d(p(r),"prune",void 0),d(p(r),"dropOverride",void 0),d(p(r),"anchor",void 0),d(p(r),"endpoint",void 0),d(p(r),"connections",{source:[],target:[],internal:[]}),d(p(r),"manager",void 0),d(p(r),"id",void 0),d(p(r),"elId",void 0);var a=r.el;return a._isJsPlumbGroup=!0,a._jsPlumbGroup=p(r),r.elId=i.getId(e),r.orphan=t.orphan===!0,r.revert=r.orphan===!0?!1:t.revert!==!1,r.droppable=t.droppable!==!1,r.ghost=t.ghost===!0,r.enabled=t.enabled!==!1,r.prune=r.orphan!==!0&&t.prune===!0,r.constrain=r.ghost||t.constrain===!0,r.proxied=t.proxied!==!1,r.id=t.id||X(),r.dropOverride=t.dropOverride===!0,r.anchor=t.anchor,r.endpoint=t.endpoint,r.anchor=t.anchor,i.setAttribute(e,vr,""),r}return L(n,[{key:"overrideDrop",value:function(e,t){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(e,t){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(e,t){return this.endpoint||{type:rt.type,options:{radius:10}}}},{key:"add",value:function(e,t){var r=this.instance.getGroupContentArea(this),a=e;if(a._jsPlumbParentGroup!=null){if(a._jsPlumbParentGroup===this)return;a._jsPlumbParentGroup.remove(e,!0,t,!1)}a._jsPlumbParentGroup=this,this.children.push(new ci(this.instance,e)),this.instance._appendElement(a,r),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(e){return e==null?null:Xn(this.children,function(t){return t.el===e})}},{key:"remove",value:function(e,t,r,a,l){var u=this.resolveNode(e);u!=null&&this._doRemove(u,t,r,a,l)}},{key:"_doRemove",value:function(e,t,r,a,l){var u=e.el;if(delete u._jsPlumbParentGroup,V(this.children,function(h){return h===e}),t)try{this.instance.getGroupContentArea(this).removeChild(u)}catch(h){ee("Could not remove element from Group "+h)}if(!r){var c={group:this,el:u};l&&(c.targetGroup=l),this.instance.fire(fa,c)}a||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(e,t){for(var r=0,a=this.children.length;r<a;r++){var l=this.children[0];this._doRemove(l,e,t,!0),this.instance.unmanage(l.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var e={},t=0;t<this.children.length;t++){var r=this.manager.orphan(this.children[t].el,!1);e[r.id]=r.pos}return this.children.length=0,e}},{key:"addGroup",value:function(e){if(this.instance.allowNestedGroups&&e!==this){if(this.instance.groupManager.isAncestor(this,e))return!1;e.group!=null&&e.group.removeGroup(e);var t=this.instance.getId(e.el),r=this.instance.getManagedElements()[t];r.group=this.elId;var a=this.instance.getOffsetRelativeToRoot(e.el),l=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));e.el._jsPlumbParentGroup=this,this.children.push(e),this.instance._appendElement(e.el,this.instance.getGroupContentArea(this)),e.group=this;var u={x:a.x-l.x,y:a.y-l.y};return this.instance.setPosition(e.el,u),this.instance.fire(pa,{parent:this,child:e}),!0}else return!1}},{key:"removeGroup",value:function(e){if(e.group===this){var t=e.el,r=this.instance.getGroupContentArea(this);r===t.parentNode&&r.removeChild(e.el);var a=this.instance.getId(e.el),l=this.instance.getManagedElements()[a];l&&delete l.group,this.children=this.children.filter(function(u){return u.id!==e.id}),delete e.group,delete t._jsPlumbParentGroup,this.instance.fire(ga,{parent:this,child:e})}}},{key:"getGroups",value:function(){return this.children.filter(function(e){return e.constructor===n})}},{key:"getNodes",value:function(){return this.children.filter(function(e){return e.constructor===ci})}},{key:"collapseParent",get:function(){var e=null;if(this.group==null)return null;for(var t=this.group;t!=null;)t.collapsed&&(e=t),t=t.group;return e}}]),n}(ci),rl=function(){function s(o){var n=this;G(this,s),this.instance=o,d(this,"groupMap",{}),d(this,"_connectionSourceMap",{}),d(this,"_connectionTargetMap",{}),o.bind(_r,function(i){var e=n.getGroupFor(i.source),t=n.getGroupFor(i.target);e!=null&&t!=null&&e===t?(n._connectionSourceMap[i.connection.id]=e,n._connectionTargetMap[i.connection.id]=e,bt(e.connections.internal,i.connection)):(e!=null&&(i.target._jsPlumbGroup===e?bt(e.connections.internal,i.connection):bt(e.connections.source,i.connection),n._connectionSourceMap[i.connection.id]=e),t!=null&&(i.source._jsPlumbGroup===t?bt(t.connections.internal,i.connection):bt(t.connections.target,i.connection),n._connectionTargetMap[i.connection.id]=t))}),o.bind(si,function(i){n._cleanupDetachedConnection(i.connection)}),o.bind(mr,function(i){var e=i.originalEndpoint.element,t=n.getGroupFor(e),r=i.connection.endpoints[i.index],a=r.element,l=n.getGroupFor(a),u=i.index===0?n._connectionSourceMap:n._connectionTargetMap,c=i.index===0?n._connectionTargetMap:n._connectionSourceMap;l!=null?(u[i.connection.id]=l,i.connection.source===i.connection.target&&(c[i.connection.id]=l)):(delete u[i.connection.id],i.connection.source===i.connection.target&&delete c[i.connection.id]),t!=null&&n._updateConnectionsForGroup(t),l!=null&&n._updateConnectionsForGroup(l)})}return L(s,[{key:"_cleanupDetachedConnection",value:function(n){n.proxies.length=0;var i=this._connectionSourceMap[n.id],e;i!=null&&(e=function(r){return r.id===n.id},V(i.connections.source,e),V(i.connections.target,e),V(i.connections.internal,e),delete this._connectionSourceMap[n.id]),i=this._connectionTargetMap[n.id],i!=null&&(e=function(r){return r.id===n.id},V(i.connections.source,e),V(i.connections.target,e),V(i.connections.internal,e),delete this._connectionTargetMap[n.id])}},{key:"addGroup",value:function(n){var i=n.el;if(this.groupMap[n.id]!=null)throw new Error("cannot create Group ["+n.id+"]; a Group with that ID exists");if(i._isJsPlumbGroup!=null)throw new Error("cannot create Group ["+n.id+"]; the given element is already a Group");var e=new il(this.instance,n.el,n);return this.groupMap[e.id]=e,n.collapsed&&this.collapseGroup(e),this.instance.manage(e.el),this.instance.addClass(e.el,Ot),e.manager=this,this._updateConnectionsForGroup(e),this.instance.fire(ua,{group:e}),e}},{key:"getGroup",value:function(n){var i=n;if(R(n)&&(i=this.groupMap[n],i==null))throw new Error("No such group ["+n+"]");return i}},{key:"getGroupFor",value:function(n){for(var i=n,e=this.instance.getContainer(),t=!1,r=null;!t;)i==null||i===e?t=!0:i._jsPlumbParentGroup?(r=i._jsPlumbParentGroup,t=!0):i=i.parentNode;return r}},{key:"getGroups",value:function(){var n=[];for(var i in this.groupMap)n.push(this.groupMap[i]);return n}},{key:"removeGroup",value:function(n,i,e,t){var r=this,a=this.getGroup(n);this.expandGroup(a,!0);var l={};return D(a.children,function(u){var c=r.instance.getManagedElements()[r.instance.getId(u.el)];c&&delete c.group}),i?(D(a.getGroups(),function(u){return r.removeGroup(u,i,e)}),a.removeAll(e,t)):(a.group&&D(a.children,function(u){return a.group.add(u.el)}),l=a.orphanAll()),a.group&&a.group.removeGroup(a),this.instance.unmanage(a.el,!0),delete this.groupMap[a.id],this.instance.fire(va,{group:a}),l}},{key:"removeAllGroups",value:function(n,i,e){for(var t in this.groupMap)this.removeGroup(this.groupMap[t],n,i,e)}},{key:"forEach",value:function(n){for(var i in this.groupMap)n(this.groupMap[i])}},{key:"orphan",value:function(n,i){var e=n;if(e._jsPlumbParentGroup){var t=e._jsPlumbParentGroup,r=this.instance.getOffset(e),a=this.instance.getId(e),l=this.instance.getOffset(n);return e.parentNode.removeChild(e),i!==!0&&t.group?(l.x+=r.x,l.y+=r.y,this.instance.getGroupContentArea(t.group).appendChild(n)):this.instance._appendElement(n,this.instance.getContainer()),this.instance.setPosition(n,l),delete e._jsPlumbParentGroup,{id:a,pos:l}}}},{key:"_updateConnectionsForGroup",value:function(n){var i=this;n.connections.source.length=0,n.connections.target.length=0,n.connections.internal.length=0;var e=n.children.slice().map(function(f){return f.el}),t=[];if(D(e,function(f){Array.prototype.push.apply(t,i.instance.getSelector(f,U))}),Array.prototype.push.apply(e,t),e.length>0){var r=this.instance.getConnections({source:e,scope:nt},!0),a=this.instance.getConnections({target:e,scope:nt},!0),l={},u,c,h=function(v){for(var g=0;g<v.length;g++)l[v[g].id]||(l[v[g].id]=!0,u=i.getGroupFor(v[g].source),c=i.getGroupFor(v[g].target),v[g].source===n.el&&c===n||v[g].target===n.el&&u===n?n.connections.internal.push(v[g]):u===n?(c!==n?n.connections.source.push(v[g]):n.connections.internal.push(v[g]),i._connectionSourceMap[v[g].id]=n):c===n&&(n.connections.target.push(v[g]),i._connectionTargetMap[v[g].id]=n))};h(r),h(a)}}},{key:"_collapseConnection",value:function(n,i,e){var t=n.endpoints[i===0?1:0].element;if(t._jsPlumbParentGroup&&!t._jsPlumbParentGroup.proxied&&t._jsPlumbParentGroup.collapsed)return!1;var r=n.endpoints[0].element,a=r._jsPlumbParentGroup,l=a!=null?a.collapseParent||a:null,u=n.endpoints[1].element,c=u._jsPlumbParentGroup,h=c!=null?c.collapseParent||c:null;if(l==null||h==null||l.id!==h.id){var f=e.el;return this.instance.getId(f),this.instance.proxyConnection(n,i,f,function(v,g){return e.getEndpoint(v,g)},function(v,g){return e.getAnchor(v,g)}),!0}else return!1}},{key:"_expandConnection",value:function(n,i,e){this.instance.unproxyConnection(n,i)}},{key:"isElementDescendant",value:function(n,i){for(var e=this.instance.getContainer(),t=!1;!t;){if(n==null||n===e)return!1;if(n===i)return!0;n=n.parentNode}}},{key:"collapseGroup",value:function(n){var i=this,e=this.getGroup(n);if(!(e==null||e.collapsed)){var t=e.el;if(e.collapseParent==null){if(this.instance.setGroupVisible(e,!1),e.collapsed=!0,this.instance.removeClass(t,Ot),this.instance.addClass(t,hn),e.proxied){var r=new Set,a=function(u,c){for(var h=0;h<u.length;h++){var f=u[h];i._collapseConnection(f,c,e)===!0&&r.add(f.id)}};a(e.connections.source,0),a(e.connections.target,1),D(e.getGroups(),function(l){i.cascadeCollapse(e,l,r)})}this.instance.revalidate(t),this.repaintGroup(e),this.instance.fire(ca,{group:e})}else e.collapsed=!0,this.instance.removeClass(t,Ot),this.instance.addClass(t,hn)}}},{key:"cascadeCollapse",value:function(n,i,e){var t=this;if(n.proxied){var r=function(l,u){for(var c=0;c<l.length;c++){var h=l[c];e.has(h.id)||t._collapseConnection(h,u,n)===!0&&e.add(h.id)}};r(i.connections.source,0),r(i.connections.target,1)}D(i.getGroups(),function(a){t.cascadeCollapse(n,a,e)})}},{key:"expandGroup",value:function(n,i){var e=this,t=this.getGroup(n);if(t!=null){var r=t.el;if(t.collapseParent==null){if(this.instance.setGroupVisible(t,!0),t.collapsed=!1,this.instance.addClass(r,Ot),this.instance.removeClass(r,hn),t.proxied){var a=function(c,h){for(var f=0;f<c.length;f++){var v=c[f];e._expandConnection(v,h,t)}};a(t.connections.source,0),a(t.connections.target,1);var l=function u(c,h){if(h||c.collapsed){var f=function(g,E){for(var y=0;y<g.length;y++){var m=g[y];e._collapseConnection(m,E,c.collapseParent||c)}};f(c.connections.source,0),f(c.connections.target,1),D(c.connections.internal,function(v){return v.setVisible(!1)}),D(c.getGroups(),function(v){return u(v,!0)})}else e.expandGroup(c,!0)};D(t.getGroups(),l)}this.instance.revalidate(r),this.repaintGroup(t),i||this.instance.fire(ha,{group:t})}else t.collapsed=!1,this.instance.addClass(r,Ot),this.instance.removeClass(r,hn)}}},{key:"toggleGroup",value:function(n){n=this.getGroup(n),n!=null&&(n.collapsed?this.expandGroup(n):this.collapseGroup(n))}},{key:"repaintGroup",value:function(n){for(var i=this.getGroup(n),e=i.children,t=0;t<e.length;t++)this.instance.revalidate(e[t].el)}},{key:"addToGroup",value:function(n,i){var e=this,t=this.getGroup(n);if(t){for(var r=t.el,a=function(f){var v=f,g=v._isJsPlumbGroup!=null,E=v._jsPlumbGroup,y=v._jsPlumbParentGroup;if(y!==t){var m=e.instance.manage(f),C=e.instance.getOffset(f),k=t.collapsed?e.instance.getOffsetRelativeToRoot(r):e.instance.getOffset(e.instance.getGroupContentArea(t));m.group=t.elId,y!=null&&(y.remove(f,!1,i,!1,t),e._updateConnectionsForGroup(y)),g?t.addGroup(E):t.add(f,i);var b=function(S,I){var M=I===0?1:0;S.each(function(N){N.setVisible(!1),N.endpoints[M].element._jsPlumbGroup===t?(N.endpoints[M].setVisible(!1),e._expandConnection(N,M,t)):(N.endpoints[I].setVisible(!1),e._collapseConnection(N,I,t))})};t.collapsed&&(b(e.instance.select({source:f}),0),b(e.instance.select({target:f}),1)),e.instance.getId(f);var A={x:C.x-k.x,y:C.y-k.y};if(e.instance.setPosition(f,A),e._updateConnectionsForGroup(t),e.instance.revalidate(f),!i){var O={group:t,el:f,pos:A};y&&(O.sourceGroup=y),e.instance.fire(da,O)}}},l=arguments.length,u=new Array(l>2?l-2:0),c=2;c<l;c++)u[c-2]=arguments[c];D(u,a)}}},{key:"removeFromGroup",value:function(n,i){var e=this,t=this.getGroup(n);if(t){for(var r=function(h){if(t.collapsed){var f=function(E,y){for(var m=0;m<E.length;m++){var C=E[m];if(C.proxies){for(var k=0;k<C.proxies.length;k++)if(C.proxies[k]!=null){var b=C.proxies[k].originalEp.element;(b===h||e.isElementDescendant(b,h))&&e._expandConnection(C,y,t)}}}};f(t.connections.source.slice(),0),f(t.connections.target.slice(),1)}t.remove(h,null,i);var v=e.instance.getManagedElements()[e.instance.getId(h)];v&&delete v.group},a=arguments.length,l=new Array(a>2?a-2:0),u=2;u<a;u++)l[u-2]=arguments[u];D(l,r)}}},{key:"getAncestors",value:function(n){for(var i=[],e=n.group;e!=null;)i.push(e),e=e.group;return i}},{key:"isAncestor",value:function(n,i){return n==null||i==null?!1:this.getAncestors(n).indexOf(i)!==-1}},{key:"getDescendants",value:function(n){var i=[],e=function t(r){var a=r.getGroups();i.push.apply(i,on(a)),D(a,t)};return e(n),i}},{key:"isDescendant",value:function(n,i){return n==null||i==null?!1:this.getDescendants(i).indexOf(n)!==-1}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),s}(),Xr=function(){function s(o,n){G(this,s),this.instance=o,this.entries=n}return L(s,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(n){return D(this.entries,function(i){return n(i)}),this}},{key:"get",value:function(n){return this.entries[n]}},{key:"addClass",value:function(n,i){return this.each(function(e){return e.addClass(n,i)}),this}},{key:"removeClass",value:function(n,i){return this.each(function(e){return e.removeClass(n,i)}),this}},{key:"removeAllOverlays",value:function(){return this.each(function(n){return n.removeAllOverlays()}),this}},{key:"setLabel",value:function(n){return this.each(function(i){return i.setLabel(n)}),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(n){var i=[];return this.each(function(e){return i.push(n(e))}),i}},{key:"addOverlay",value:function(n){return this.each(function(i){return i.addOverlay(n)}),this}},{key:"removeOverlay",value:function(n){return this.each(function(i){return i.removeOverlay(n)}),this}},{key:"removeOverlays",value:function(){return this.each(function(n){return n.removeOverlays()}),this}},{key:"showOverlay",value:function(n){return this.each(function(i){return i.showOverlay(n)}),this}},{key:"hideOverlay",value:function(n){return this.each(function(i){return i.hideOverlay(n)}),this}},{key:"setPaintStyle",value:function(n){return this.each(function(i){return i.setPaintStyle(n)}),this}},{key:"setHoverPaintStyle",value:function(n){return this.each(function(i){return i.setHoverPaintStyle(n)}),this}},{key:"setSuspendEvents",value:function(n){return this.each(function(i){return i.setSuspendEvents(n)}),this}},{key:"setParameter",value:function(n,i){return this.each(function(e){return e.parameters[n]=i}),this}},{key:"setParameters",value:function(n){return this.each(function(i){return i.parameters=n}),this}},{key:"setVisible",value:function(n){return this.each(function(i){return i.setVisible(n)}),this}},{key:"addType",value:function(n){return this.each(function(i){return i.addType(n)}),this}},{key:"toggleType",value:function(n){return this.each(function(i){return i.toggleType(n)}),this}},{key:"removeType",value:function(n){return this.each(function(i){return i.removeType(n)}),this}},{key:"bind",value:function(n,i){return this.each(function(e){return e.bind(n,i)}),this}},{key:"unbind",value:function(n,i){return this.each(function(e){return e.unbind(n,i)}),this}},{key:"setHover",value:function(n){var i=this;return this.each(function(e){return i.instance.setHover(e,n)}),this}}]),s}(),sl=function(s){F(n,s);var o=j(n);function n(){return G(this,n),o.apply(this,arguments)}return L(n,[{key:"setEnabled",value:function(e){return this.each(function(t){return t.enabled=e}),this}},{key:"setAnchor",value:function(e){return this.each(function(t){return t.setAnchor(e)}),this}},{key:"deleteEveryConnection",value:function(){return this.each(function(e){return e.deleteEveryConnection()}),this}},{key:"deleteAll",value:function(){var e=this;return this.each(function(t){return e.instance.deleteEndpoint(t)}),this.clear(),this}}]),n}(Xr),ol=function(s){F(n,s);var o=j(n);function n(){return G(this,n),o.apply(this,arguments)}return L(n,[{key:"setDetachable",value:function(e){return this.each(function(t){return t.setDetachable(e)}),this}},{key:"setReattach",value:function(e){return this.each(function(t){return t.setReattach(e)}),this}},{key:"setConnector",value:function(e){return this.each(function(t){return t.setConnector(e)}),this}},{key:"deleteAll",value:function(){var e=this;this.each(function(t){return e.instance.deleteConnection(t)}),this.clear()}},{key:"repaint",value:function(){var e=this;return this.each(function(t){return e.instance.paintConnection(t)}),this}}]),n}(Xr),al=function s(){G(this,s),d(this,"affectedElements",new Set)};function $r(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}function ll(s,o,n,i,e){var t={x:s+n/2,y:o+i/2},r=Math.cos(e/360*Math.PI*2),a=Math.sin(e/360*Math.PI*2),l=function(k,b){return{x:t.x+Math.round((k-t.x)*r-(b-t.y)*a),y:t.y+Math.round((b-t.y)*r-(k-t.x)*a)}},u=l(s,o),c=l(s+n,o),h=l(s+n,o+i),f=l(s,o+i),v=l(s+n/2,o+i/2),g=Math.min(u.x,c.x,h.x,f.x),E=Math.max(u.x,c.x,h.x,f.x),y=Math.min(u.y,c.y,h.y,f.y),m=Math.max(u.y,c.y,h.y,f.y);return{x:g,y,w:E-g,h:m-y,c:v,r:e,x2:E,y2:m,cr:r,sr:a}}var _n=function(o,n){var i=0;return n[1]>o[1]?i=-1:n[1]<o[1]&&(i=1),i},Wr=function(o,n){return _n(o,n)*-1};function mn(s,o,n,i){mo([s,o],n,_n,i)}function be(s,o){var n=Ee(o,function(i){return i[0]===s});n>-1&&o.splice(n,1)}var ul=function(s){F(n,s);var o=j(n);function n(i){var e;return G(this,n),e=o.call(this),e.instance=i,d(p(e),"_currentTransaction",null),d(p(e),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),d(p(e),"_elementMap",new Map),d(p(e),"_transformedElementMap",new Map),d(p(e),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),e}return L(n,[{key:"_updateBounds",value:function(e,t,r){t!=null&&(be(e,this._sortedElements.xmin),be(e,this._sortedElements.xmax),be(e,this._sortedElements.ymin),be(e,this._sortedElements.ymax),mn(e,t.t.x,this._sortedElements.xmin,!1),mn(e,t.t.x+t.t.w,this._sortedElements.xmax,!0),mn(e,t.t.y,this._sortedElements.ymin,!1),mn(e,t.t.y+t.t.h,this._sortedElements.ymax,!0),r!==!0&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var e=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach(function(t,r){e._sortedElements.xmin.push([r,t.t.x]),e._sortedElements.xmax.push([r,t.t.x+t.t.w]),e._sortedElements.ymin.push([r,t.t.y]),e._sortedElements.ymax.push([r,t.t.y+t.t.h])}),this._sortedElements.xmin.sort(_n),this._sortedElements.ymin.sort(_n),this._sortedElements.xmax.sort(Wr),this._sortedElements.ymax.sort(Wr),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(e,t,r){t.t=ll(t.x,t.y,t.w,t.h,t.r),this._transformedElementMap.set(e,t.t),r!==!0&&this._updateBounds(e,t,r)}},{key:"shouldFireEvent",value:function(e,t,r){return!0}},{key:"startTransaction",value:function(){if(this._currentTransaction!=null)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new al}},{key:"endTransaction",value:function(){var e=this;this._currentTransaction!=null&&(this._currentTransaction.affectedElements.forEach(function(t){var r=e.getPosition(t);e._finaliseUpdate(t,r,!0)}),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(e){var t=this;D(e,function(r){return t.updateElement(r.id,r.x,r.y,r.width,r.height,r.rotation)})}},{key:"updateElement",value:function(e,t,r,a,l,u,c){var h=Ki(this._elementMap,e,$r);return h.dirty=t==null&&h.x==null||r==null&&h.y==null||a==null&&h.w==null||l==null&&h.h==null,t!=null&&(h.x=t),r!=null&&(h.y=r),a!=null&&(h.w=a),l!=null&&(h.h=l),u!=null&&(h.r=u||0),h.c.x=h.x+h.w/2,h.c.y=h.y+h.h/2,h.x2=h.x+h.w,h.y2=h.y+h.h,this._currentTransaction==null?this._finaliseUpdate(e,h,c):this._currentTransaction.affectedElements.add(e),h}},{key:"refreshElement",value:function(e,t){var r=this.instance.getManagedElements(),a=r[e]?r[e].el:null;if(a!=null){var l=this.getSize(a),u=this.getOffset(a);return this.updateElement(e,u.x,u.y,l.w,l.h,null,t)}else return null}},{key:"getSize",value:function(e){return this.instance.getSize(e)}},{key:"getOffset",value:function(e){return this.instance.getOffset(e)}},{key:"registerElement",value:function(e,t){return this.updateElement(e,0,0,0,0,0,t)}},{key:"addElement",value:function(e,t,r,a,l,u){return this.updateElement(e,t,r,a,l,u)}},{key:"rotateElement",value:function(e,t){var r=Ki(this._elementMap,e,$r);return r.r=t||0,this._finaliseUpdate(e,r),r}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(e,t,r){if(this._elementMap.has(e))return this.updateElement(e,null,null,t,r,null)}},{key:"setPosition",value:function(e,t,r){if(this._elementMap.has(e))return this.updateElement(e,t,r,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(e){be(e,this._sortedElements.xmin),be(e,this._sortedElements.xmax),be(e,this._sortedElements.ymin),be(e,this._sortedElements.ymax),this._elementMap.delete(e),this._transformedElementMap.delete(e),this._recalculateBounds()}},{key:"getPosition",value:function(e){return this._elementMap.get(e)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return this._elementMap.size===0}}]),n}(At),qr=function(){function s(o,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;G(this,s),this.selector=o,this.def=n,this.exclude=i}return L(s,[{key:"setEnabled",value:function(n){this.def.enabled=n}},{key:"isEnabled",value:function(){return this.def.enabled!==!1}}]),s}(),cl="strict",hl="any",dl=function(s){F(n,s);var o=j(n);function n(i,e,t){var r;return G(this,n),r=o.call(this,i,e,t),r.def=e,d(p(r),"redrop",void 0),r.redrop=e.def.redrop||cl,r}return n}(qr),fl=function(s){F(n,s);var o=j(n);function n(i,e,t){var r;return G(this,n),r=o.call(this,i,e,t),r.def=e,r}return n}(qr),vt;function vl(s,o,n,i,e){for(var t=n?s.w:s.h,r=n?s.h:s.w,a=[],l=t/(o.length+1),u=0;u<o.length;u++){var c=(u+1)*l,h=i*r;e&&(c=t-c);var f=n?c:h,v=s.x+f,g=f/s.w,E=n?h:c,y=s.y+E,m=E/s.h;if(s.r!==0&&s.r!=null){var C=en({x:v,y},s.c,s.r);v=C.x,y=C.y}a.push({x:v,y,xLoc:g,yLoc:m,c:o[u].c})}return a}function Kr(s,o){return o.theta-s.theta}function Jr(s,o){var n=s.theta<0?-Math.PI-s.theta:Math.PI-s.theta,i=o.theta<0?-Math.PI-o.theta:Math.PI-o.theta;return n-i}var pl=(vt={},d(vt,H,Jr),d(vt,$,Kr),d(vt,Q,Kr),d(vt,K,Jr),vt);function Te(s){return s.isContinuous===!0}function Zr(s){return s.isContinuous===!0}function gl(s){return s.locations.length>1}function zr(s){return[s.currentLocation,s.locations[s.currentLocation]]}var yl=function(){function s(o){var n=this;G(this,s),this.instance=o,d(this,"anchorLists",new Map),d(this,"anchorLocations",new Map),o.bind(si,function(i){n._removeEndpointFromAnchorLists(i.sourceEndpoint),n._removeEndpointFromAnchorLists(i.targetEndpoint)}),o.bind(Er,function(i){n._removeEndpointFromAnchorLists(i)})}return L(s,[{key:"getAnchorOrientation",value:function(n){var i=this.anchorLocations.get(n.id);return i?[i.ox,i.oy]:[0,0]}},{key:"_distance",value:function(n,i,e,t,r,a,l){var u=t.x+n.x*r.w,c=t.y+n.y*r.h,h=t.x+r.w/2,f=t.y+r.h/2;if(a!=null&&a.length>0){var v=this.instance._applyRotations([u,c,0,0],a);u=v.x,c=v.y}return Math.sqrt(Math.pow(i-u,2)+Math.pow(e-c,2))+Math.sqrt(Math.pow(h-u,2)+Math.pow(f-c,2))}},{key:"_anchorSelector",value:function(n,i,e,t,r,a,l){for(var u=e.x+t.w/2,c=e.y+t.h/2,h=-1,f=1/0,v=0;v<l.length;v++){var g=this._distance(l[v],u,c,n,i,r,a);g<f&&(h=v+0,f=g)}return[h,l[h]]}},{key:"_floatingAnchorCompute",value:function(n,i){var e=i.xy,t={curX:e.x+n.size.w/2,curY:e.y+n.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(n,t)}},{key:"_setComputedPosition",value:function(n,i,e){return this.anchorLocations.set(n.id,i),n.computedPosition=i,e&&(n.timestamp=e),i}},{key:"_computeSingleLocation",value:function(n,i,e,t){var r={curX:i.x+n.x*e.w+n.offx,curY:i.y+n.y*e.h+n.offy,x:n.x,y:n.y,ox:0,oy:0},a,l=t.rotation;if(l!=null&&l.length>0){var u=[n.iox,n.ioy],c={x:r.curX,y:r.curY,cr:0,sr:0};D(l,function(h){c=en(c,h.c,h.r);var f=[Math.round(u[0]*c.cr-u[1]*c.sr),Math.round(u[1]*c.cr+u[0]*c.sr)];u=f.slice()}),n.ox=u[0],n.oy=u[1],a={curX:c.x,curY:c.y,x:n.x,y:n.y,ox:u[0],oy:u[1]}}else n.ox=n.iox,n.oy=n.ioy,a=w({ox:n.iox,oy:n.ioy},r);return a}},{key:"_singleAnchorCompute",value:function(n,i){var e=i.xy,t=i.wh,r=i.timestamp,a=this.anchorLocations.get(n.id);if(a!=null&&r&&r===n.timestamp)return a;var l=zr(n),u=zn(l,2);u[0];var c=u[1];return a=this._computeSingleLocation(c,e,t,i),this._setComputedPosition(n,a,r)}},{key:"_defaultAnchorCompute",value:function(n,i){var e;if(n.locations.length===1)return this._singleAnchorCompute(n,i);var t=i.xy,r=i.wh,a=i.txy,l=i.twh,u=zr(n),c=zn(u,2),h=c[0],f=c[1];if(n.locked||a==null||l==null)e=this._computeSingleLocation(f,t,r,i);else{var v=this._anchorSelector(t,r,a,l,i.rotation,i.tRotation,n.locations),g=zn(v,2),E=g[0],y=g[1];n.currentLocation=E,E!==h&&(n.cssClass=y.cls||n.cssClass,i.element._anchorLocationChanged(n)),e=this._computeSingleLocation(y,t,r,i)}return this._setComputedPosition(n,e,i.timestamp)}},{key:"_placeAnchors",value:function(n,i){var e=this,t=this.instance.viewport.getPosition(n),r=function(l,u,c,h,f,v){if(c.length>0)for(var g=c.sort(pl[l]),E=l===$||l===H,y=vl(t,g,h,f,E),m=0;m<y.length;m++){var C=y[m].c,k=C.endpoints[0].elementId===n,b=k?C.endpoints[0]:C.endpoints[1];e._setComputedPosition(b._anchor,{curX:y[m].x,curY:y[m].y,x:y[m].xLoc,y:y[m].yLoc,ox:v[0],oy:v[1]})}};r(Q,t,i.bottom,!0,1,[0,1]),r(H,t,i.top,!0,0,[0,-1]),r(K,t,i.left,!1,0,[-1,0]),r($,t,i.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(n,i,e,t,r,a,l,u,c,h,f){var v=t.endpoints[l],g=v.id,E=[1,0][l],y={theta:i,order:e,c:t,b:r,elId:a,epId:g},m=n[c],C=v._continuousAnchorEdge?n[v._continuousAnchorEdge]:null,k;if(C){var b=Ee(C,function(S){return S.epId===g});if(b!==-1){C.splice(b,1);for(var A=0;A<C.length;A++)k=C[A].c,k.placeholder!==!0&&h.add(k),f.add(C[A].c.endpoints[l]),f.add(C[A].c.endpoints[E])}}for(var O=0;O<m.length;O++)k=m[O].c,k.placeholder!==!0&&h.add(k),f.add(m[O].c.endpoints[l]),f.add(m[O].c.endpoints[E]);{var T=u?0:m.length;m.splice(T,0,y)}v._continuousAnchorEdge=c}},{key:"_removeEndpointFromAnchorLists",value:function(n){var i=this.anchorLists.get(n.elementId),e=0;(function(t,r){if(t){var a=function(u){return u.epId===r};V(t.top,a),V(t.left,a),V(t.bottom,a),V(t.right,a),e+=t.top.length,e+=t.left.length,e+=t.bottom.length,e+=t.right.length}})(i,n.id),e===0&&this.anchorLists.delete(n.elementId),this.anchorLocations.delete(n._anchor.id)}},{key:"computeAnchorLocation",value:function(n,i){var e;return Te(n)?e=this.anchorLocations.get(n.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:Zr(n)?e=this._floatingAnchorCompute(n,i):e=this._defaultAnchorCompute(n,i),n.timestamp=i.timestamp,e}},{key:"computePath",value:function(n,i){var e=this.instance.viewport.getPosition(n.sourceId),t=this.instance.viewport.getPosition(n.targetId),r=n.endpoints[0],a=n.endpoints[1],l=this.getEndpointLocation(r,{xy:e,wh:e,element:r,timestamp:i,rotation:this.instance._getRotations(n.sourceId)}),u=this.getEndpointLocation(a,{xy:t,wh:t,element:a,timestamp:i,rotation:this.instance._getRotations(n.targetId)});n.connector.resetBounds(),n.connector.compute({sourcePos:l,targetPos:u,sourceEndpoint:n.endpoints[0],targetEndpoint:n.endpoints[1],strokeWidth:n.paintStyleInUse.strokeWidth,sourceInfo:e,targetInfo:t})}},{key:"getEndpointLocation",value:function(n,i){i=i||{};var e=n._anchor,t=this.anchorLocations.get(e.id);return(t==null||i.timestamp!=null&&e.timestamp!==i.timestamp)&&(t=this.computeAnchorLocation(e,i),this._setComputedPosition(e,t,i.timestamp)),t}},{key:"getEndpointOrientation",value:function(n){return n._anchor?this.getAnchorOrientation(n._anchor):[0,0]}},{key:"isDynamicAnchor",value:function(n){return n._anchor?!Te(n._anchor)&&n._anchor.locations.length>1:!1}},{key:"isFloating",value:function(n){return n._anchor?Zr(n._anchor):!1}},{key:"prepareAnchor",value:function(n,i){return Mt(i)}},{key:"redraw",value:function(n,i,e){var t=this,r=new Set,a=new Set,l=new Set;if(!this.instance._suspendDrawing){var u=this.instance.endpointsByElement[n]||[];i=i||X();for(var c={},h,f,v=0;v<u.length;v++)if(f=u[v],a.add(f),h=f._anchor,f.connections.length===0)Te(h)&&(this.anchorLists.has(n)||this.anchorLists.set(n,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(n),-Math.PI/2,0,{endpoints:[f,f],placeholder:!0},!1,n,0,!1,Fa(h),r,a),l.add(n));else for(var g=0;g<f.connections.length;g++){var E=f.connections[g],y=E.sourceId,m=E.targetId,C=Te(E.endpoints[0]._anchor),k=Te(E.endpoints[1]._anchor);if(C||k){var b=y+"_"+m,A=c[b],O=E.sourceId===n?1:0;C&&!this.anchorLists.has(y)&&this.anchorLists.set(y,{top:[],right:[],bottom:[],left:[]}),k&&!this.anchorLists.has(m)&&this.anchorLists.set(m,{top:[],right:[],bottom:[],left:[]});var T=this.instance.viewport.getPosition(m),S=this.instance.viewport.getPosition(y);if(m===y&&(C||k))this._updateAnchorList(this.anchorLists.get(y),-Math.PI/2,0,E,!1,m,0,!1,H,r,a),this._updateAnchorList(this.anchorLists.get(m),-Math.PI/2,0,E,!1,y,1,!1,H,r,a);else{var I=this.instance._getRotations(y),M=this.instance._getRotations(m);A||(A=this._calculateOrientation(y,m,S,T,E.endpoints[0]._anchor,E.endpoints[1]._anchor,I,M),c[b]=A),C&&this._updateAnchorList(this.anchorLists.get(y),A.theta,0,E,!1,m,0,!1,A.a[0],r,a),k&&this._updateAnchorList(this.anchorLists.get(m),A.theta2,-1,E,!0,y,1,!0,A.a[1],r,a)}C&&l.add(y),k&&l.add(m),r.add(E),(C&&O===0||k&&O===1)&&a.add(E.endpoints[O])}else{var N=f.connections[g].endpoints[E.sourceId===n?1:0],P=N._anchor;if(gl(P)){this.instance.paintEndpoint(N,{elementWithPrecedence:n,timestamp:i}),r.add(f.connections[g]);for(var W=0;W<N.connections.length;W++)N.connections[W]!==f.connections[g]&&r.add(N.connections[W])}else r.add(f.connections[g])}}l.forEach(function(ie){t._placeAnchors(ie,t.anchorLists.get(ie))}),a.forEach(function(ie){var St=t.instance.viewport.getPosition(ie.elementId);t.instance.paintEndpoint(ie,{timestamp:i,offset:St})}),r.forEach(function(ie){t.instance.paintConnection(ie,{timestamp:i})})}return{c:r,e:a}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(n,i){i!=null&&(n._anchor=i)}},{key:"setConnectionAnchors",value:function(n,i){n.endpoints[0]._anchor=i[0],n.endpoints[1]._anchor=i[1]}},{key:"_calculateOrientation",value:function(n,i,e,t,r,a,l,u){var c=this,h={HORIZONTAL:"horizontal",VERTICAL:"vertical",DIAGONAL:"diagonal",IDENTITY:"identity"};if(n===i)return{orientation:h.IDENTITY,a:[H,H]};var f=Math.atan2(t.c.y-e.c.y,t.c.x-e.c.x),v=Math.atan2(e.c.y-t.c.y,e.c.x-t.c.x),g=[],E={};(function(O,T){for(var S=0;S<O.length;S++){var I;if(E[O[S]]=(I={},d(I,K,{x:T[S][0].x,y:T[S][0].c.y}),d(I,$,{x:T[S][0].x+T[S][0].w,y:T[S][0].c.y}),d(I,H,{x:T[S][0].c.x,y:T[S][0].y}),d(I,Q,{x:T[S][0].c.x,y:T[S][0].y+T[S][0].h}),I),T[S][1]!=null&&T[S][1].length>0)for(var M in E[O[S]])E[O[S]][M]=c.instance._applyRotationsXY(E[O[S]][M],T[S][1])}})([hr,dr],[[e,l],[t,u]]);for(var y=[H,K,$,Q],m=0;m<y.length;m++)for(var C=0;C<y.length;C++)g.push({source:y[m],target:y[C],dist:Kn(E.source[y[m]],E.target[y[C]])});g.sort(function(O,T){if(O.dist<T.dist)return-1;if(T.dist<O.dist)return 1;var S,I=(S={},d(S,K,0),d(S,H,1),d(S,$,2),d(S,Q,3),S),M=I[O.source],N=I[T.source],P=I[O.target],W=I[T.target];return M<N?-1:N<M?1:P<W?-1:W<P?1:0});for(var k=g[0].source,b=g[0].target,A=0;A<g.length&&(Te(r)&&r.locked?k=r.currentFace:!r.isContinuous||Gr(r,g[A].source)?k=g[A].source:k=null,a.isContinuous&&a.locked?b=a.currentFace:!a.isContinuous||Gr(a,g[A].target)?b=g[A].target:b=null,!(k!=null&&b!=null));A++);return r.isContinuous&&this.setCurrentFace(r,k),a.isContinuous&&this.setCurrentFace(a,b),{a:[k,b],theta:f,theta2:v}}},{key:"setCurrentFace",value:function(n,i,e){n.currentFace=i,e&&n.lockedFace!=null&&(n.lockedFace=n.currentFace)}},{key:"lock",value:function(n){n.locked=!0,Te(n)&&(n.lockedFace=n.currentFace)}},{key:"unlock",value:function(n){n.locked=!1,Te(n)&&(n.lockedFace=null)}},{key:"selectAnchorLocation",value:function(n,i){var e=Ee(n.locations,function(t){return t.x===i.x&&t.y===i.y});return e!==-1?(n.currentLocation=e,!0):!1}},{key:"lockCurrentAxis",value:function(n){n.currentFace!=null&&(n.lockedAxis=n.currentFace===K||n.currentFace===$?Na:La)}},{key:"unlockCurrentAxis",value:function(n){n.lockedAxis=null}},{key:"anchorsEqual",value:function(n,i){if(!n||!i)return!1;var e=n.locations[n.currentLocation],t=i.locations[i.currentLocation];return e.x===t.x&&e.y===t.y&&e.offx===t.offx&&e.offy===t.offy&&e.ox===t.ox&&e.oy===t.oy}}]),s}();function _l(s,o){for(var n=s.scope.split(/\s/),i=o.scope.split(/\s/),e=0;e<n.length;e++)for(var t=0;t<i.length;t++)if(i[t]===n[e])return!0;return!1}function He(s,o,n){var i=[],e=function(a){return R(a)?a:s.getId(a)};if(o)if(typeof o=="string"){if(o==="*")return o;i.push(o)}else if(n)i=o;else if(o.length!=null){var t;(t=i).push.apply(t,on(on(o).map(e)))}else i.push(e(o));return i}function ml(s,o){s!=null&&s.endpoints.push(o)}function El(s,o){s!=null&&V(s.endpoints,function(n){return n===o})}function En(s,o,n){o!=null&&(o.connections.push(s),o.connections.length===1&&s.instance.addClass(s.source,s.instance.connectedClass)),n!=null&&(o==null||s.sourceId!==s.targetId)&&(n.connections.push(s),n.connections.length===1&&s.instance.addClass(s.target,s.instance.connectedClass))}function Cn(s,o,n){if(o!=null){var i=o.connections.length;V(o.connections,function(t){return s.id===t.id}),i>0&&o.connections.length===0&&s.instance.removeClass(s.source,s.instance.connectedClass)}if(n!=null){var e=n.connections.length;(o==null||s.sourceId!==s.targetId)&&V(n.connections,function(t){return s.id===t.id}),e>0&&n.connections.length===0&&s.instance.removeClass(s.target,s.instance.connectedClass)}}var Cl=function(s){F(n,s);var o=j(n);function n(i,e){var t;return G(this,n),t=o.call(this),t._instanceIndex=i,d(p(t),"defaults",void 0),d(p(t),"_initialDefaults",{}),d(p(t),"isConnectionBeingDragged",!1),d(p(t),"currentlyDragging",!1),d(p(t),"hoverSuspended",!1),d(p(t),"_suspendDrawing",!1),d(p(t),"_suspendedAt",null),d(p(t),"connectorClass",ri),d(p(t),"connectorOutlineClass",Jo),d(p(t),"connectedClass",Zo),d(p(t),"endpointClass",Dt),d(p(t),"endpointConnectedClass",zo),d(p(t),"endpointFullClass",Qo),d(p(t),"endpointDropAllowedClass",ea),d(p(t),"endpointDropForbiddenClass",ta),d(p(t),"endpointAnchorClassPrefix",na),d(p(t),"overlayClass",dn),d(p(t),"connections",[]),d(p(t),"endpointsByElement",{}),d(p(t),"endpointsByUUID",new Map),d(p(t),"sourceSelectors",[]),d(p(t),"targetSelectors",[]),d(p(t),"allowNestedGroups",void 0),d(p(t),"_curIdStamp",1),d(p(t),"viewport",new ul(p(t))),d(p(t),"router",void 0),d(p(t),"groupManager",void 0),d(p(t),"_connectionTypes",new Map),d(p(t),"_endpointTypes",new Map),d(p(t),"_container",void 0),d(p(t),"_managedElements",{}),d(p(t),"DEFAULT_SCOPE",void 0),d(p(t),"_zoom",1),t.defaults={anchor:Qe.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:un.type,container:null,endpoint:rt.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},e&&w(t.defaults,e),w(t._initialDefaults,t.defaults),t.DEFAULT_SCOPE=t.defaults.scope,t.allowNestedGroups=t._initialDefaults.allowNestedGroups!==!1,t.router=new yl(p(t)),t.groupManager=new rl(p(t)),t.setContainer(t._initialDefaults.container),t}return L(n,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(e,t){return this._zoom=e,this.fire(xr,this._zoom),t&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(e,t){var r=this.getListener(e),a=!0;if(r&&r.length>0){var l=Array.prototype.slice.call(arguments,1);try{for(var u=0,c=r.length;u<c;u++)a=a&&r[u].apply(r[u],l)}catch(h){ee("cannot check condition ["+e+"]"+h)}}return a}},{key:"getId",value:function(e,t){if(e==null)return null;var r=this.getAttribute(e,Fe);return(!r||r==="undefined")&&(arguments.length===2&&arguments[1]!==void 0?r=t:(arguments.length===1||arguments.length===3&&!arguments[2])&&(r="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(e,Fe,r)),r}},{key:"getConnections",value:function(e,t){e?e.constructor===String&&(e={scope:e}):e={};for(var r=e.scope||this.defaultScope,a=He(this,r,!0),l=He(this,e.source),u=He(this,e.target),c=!t&&a.length>1?{}:[],h=function(C,k){if(!t&&a.length>1){var b=c[C];b==null&&(b=c[C]=[]),b.push(k)}else c.push(k)},f=0,v=this.connections.length;f<v;f++){var g=this.connections[f],E=g.proxies&&g.proxies[0]?g.proxies[0].originalEp.elementId:g.sourceId,y=g.proxies&&g.proxies[1]?g.proxies[1].originalEp.elementId:g.targetId;Ie(a,g.scope)&&Ie(l,E)&&Ie(u,y)&&h(g.scope,g)}return c}},{key:"select",value:function(e){return e=e||{},e.scope=e.scope||"*",new ol(this,e.connections||this.getConnections(e,!0))}},{key:"selectEndpoints",value:function(e){e=e||{},e.scope=e.scope||nt;var t=!e.element&&!e.source&&!e.target,r=t?nt:He(this,e.element),a=t?nt:He(this,e.source),l=t?nt:He(this,e.target),u=He(this,e.scope,!0),c=[];for(var h in this.endpointsByElement){var f=Ie(r,h,!0),v=Ie(a,h,!0),g=a!=="*",E=Ie(l,h,!0),y=l!=="*";if(f||v||E){e:for(var m=0,C=this.endpointsByElement[h].length;m<C;m++){var k=this.endpointsByElement[h][m];if(Ie(u,k.scope,!0)){var b=g&&a.length>0&&!k.isSource,A=y&&l.length>0&&!k.isTarget;if(b||A)continue e;c.push(k)}}}}return new sl(this,c)}},{key:"setContainer",value:function(e){this._container=e,this.fire(oa,this._container)}},{key:"_set",value:function(e,t,r){var a=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}],l,u=a[r],c=e[u.elId],h,f=e.endpoints[r],v={index:r,originalEndpoint:f,originalSourceId:r===0?c:e.sourceId,newSourceId:e.sourceId,originalTargetId:r===1?c:e.targetId,newTargetId:e.targetId,connection:e,newEndpoint:f};return t instanceof yn?(l=t,l.addConnection(e)):(h=this.getId(t),h===e[u.elId]?l=null:l=e.makeEndpoint(r===0,t,h)),l!=null&&(v.newEndpoint=l,f.detachFromConnection(e),e.endpoints[r]=l,e[u.el]=l.element,e[u.elId]=l.elementId,v[r===0?"newSourceId":"newTargetId"]=l.elementId,this.fireMoveEvent(v),this.paintConnection(e)),v}},{key:"setSource",value:function(e,t){Cn(e,this._managedElements[e.sourceId]);var r=this._set(e,t,0);En(e,this._managedElements[r.newSourceId])}},{key:"setTarget",value:function(e,t){Cn(e,this._managedElements[e.targetId]);var r=this._set(e,t,1);En(e,this._managedElements[r.newTargetId])}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(e,t){var r=this._suspendDrawing;return this._suspendDrawing=e,e?this._suspendedAt=""+new Date().getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),t&&this.repaintEverything(),r}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(e,t){var r=this._suspendDrawing===!0;r||this.setSuspendDrawing(!0),e(),r||this.setSuspendDrawing(!1,!t)}},{key:"each",value:function(e,t){if(e!=null){if(e.length!=null)for(var r=0;r<e.length;r++)t(e[r]);else t(e);return this}}},{key:"updateOffset",value:function(e){var t=e.elId;return e.recalc?this.viewport.refreshElement(t):this.viewport.getPosition(t)}},{key:"deleteConnection",value:function(e,t){if(e!=null&&e.deleted!==!0&&(t=t||{},t.force||Xi(!0,!1,[[e.endpoints[0],at,[e]],[e.endpoints[1],at,[e]],[e,at,[e]],[this,yr,[kr,e]]]))){Cn(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this.fireDetachEvent(e,!e.pending&&t.fireEvent!==!1,t.originalEvent);var r=e.endpoints[0],a=e.endpoints[1];return r!==t.endpointToIgnore&&r.detachFromConnection(e,null,!0),a!==t.endpointToIgnore&&a.detachFromConnection(e,null,!0),V(this.connections,function(l){return e.id===l.id}),e.destroy(),r!==t.endpointToIgnore&&r.deleteOnEmpty&&r.connections.length===0&&this.deleteEndpoint(r),a!==t.endpointToIgnore&&a.deleteOnEmpty&&a.connections.length===0&&this.deleteEndpoint(a),!0}return!1}},{key:"deleteEveryConnection",value:function(e){var t=this;e=e||{};var r=this.connections.length,a=0;return this.batch(function(){for(var l=0;l<r;l++)a+=t.deleteConnection(t.connections[0],e)?1:0}),a}},{key:"deleteConnectionsForElement",value:function(e,t){var r=this.getId(e),a=this._managedElements[r];if(a)for(var l=a.connections.length,u=0;u<l;u++)this.deleteConnection(a.connections[0],t);return this}},{key:"fireDetachEvent",value:function(e,t,r){var a=e.id!=null,l=a?{connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]}:e;t&&this.fire(sa,l,r),this.fire(si,l,r)}},{key:"fireMoveEvent",value:function(e,t){this.fire(mr,e,t)}},{key:"manageAll",value:function(e,t){for(var r=R(e)?this.getSelector(this.getContainer(),e):e,a=0;a<r.length;a++)this.manage(r[a],null,t)}},{key:"manage",value:function(e,t,r){this.getAttribute(e,Fe)==null&&(t=t||this.getAttribute(e,"id")||X(),this.setAttribute(e,Fe,t));var a=this.getId(e);if(this._managedElements[a])r&&(this._managedElements[a].viewportElement=this.updateOffset({elId:a,timestamp:null,recalc:!0}));else{var l={el:e,endpoints:[],connections:[],rotation:0};this._managedElements[a]=l,this._suspendDrawing?l.viewportElement=this.viewport.registerElement(a,!0):l.viewportElement=this.updateOffset({elId:a,recalc:!0}),this.fire(la,{el:e})}return this._managedElements[a]}},{key:"getManagedElement",value:function(e){return this._managedElements[e]?this._managedElements[e].el:null}},{key:"unmanage",value:function(e,t){var r=this;this.removeAllEndpoints(e,!0);var a=function(u){var c=r.getId(u);r.removeAttribute(u,Fe),delete r._managedElements[c],r.viewport.remove(c),r.fire(ya,{el:u}),u&&t&&r._removeElement(u)};this._getAssociatedElements(e).map(a),a(e)}},{key:"rotate",value:function(e,t,r){var a=this.getId(e);return this._managedElements[a]&&(this._managedElements[a].rotation=t,this.viewport.rotateElement(a,t),r!==!0)?this.revalidate(e):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(e){var t=this._managedElements[e];return t!=null&&t.rotation||0}},{key:"_getRotations",value:function(e){var t=this,r=[],a=this._managedElements[e],l=function u(c){if(c.group!=null){var h=t._managedElements[c.group];h!=null&&(r.push({r:h.viewportElement.r,c:h.viewportElement.c}),u(h))}};return a!=null&&(r.push({r:a.viewportElement.r||0,c:a.viewportElement.c}),l(a)),r}},{key:"_applyRotations",value:function(e,t){var r=e.slice(),a={x:r[0],y:r[1],cr:0,sr:0};return D(t,function(l){a=en(a,l.c,l.r)}),a}},{key:"_applyRotationsXY",value:function(e,t){return D(t,function(r){e=en(e,r.c,r.r)}),e}},{key:"_internal_newEndpoint",value:function(e){var t=w({},e),r=this.manage(t.element);t.elementId=this.getId(t.element),t.id="ep_"+this._idstamp();var a=new yn(this,t);return ml(r,a),e.uuid&&this.endpointsByUUID.set(e.uuid,a),$n(this.endpointsByElement,a.elementId,a),this._suspendDrawing||this.paintEndpoint(a,{timestamp:this._suspendedAt}),a}},{key:"_deriveEndpointAndAnchorSpec",value:function(e,t){for(var r=((t?"":"default ")+e).split(/[\s]/),a=null,l=null,u=null,c=null,h=0;h<r.length;h++){var f=this.getConnectionType(r[h]);f&&(f.endpoints&&(a=f.endpoints),f.endpoint&&(l=f.endpoint),f.anchors&&(c=f.anchors),f.anchor&&(u=f.anchor))}return{endpoints:a||[l,l],anchors:c||[u,u]}}},{key:"revalidate",value:function(e,t){var r=this.getId(e);return this.updateOffset({elId:r,recalc:!0,timestamp:t}),this.repaint(e)}},{key:"repaintEverything",value:function(){var e=X(),t;for(t in this._managedElements)this.viewport.refreshElement(t,!0);this.viewport.recomputeBounds();for(t in this._managedElements)this.repaint(this._managedElements[t].el,e,!0);return this}},{key:"setElementPosition",value:function(e,t,r){var a=this.getId(e);return this.viewport.setPosition(a,t,r),this.repaint(e)}},{key:"repaint",value:function(e,t,r){var a={c:new Set,e:new Set},l=function(g){g.c.forEach(function(E){return a.c.add(E)}),g.e.forEach(function(E){return a.e.add(E)})};if(!this._suspendDrawing){var u=this.getId(e);if(e!=null){var c=this._getAssociatedElements(e);if(t==null&&(t=X()),!r)for(var h=0;h<c.length;h++)this.updateOffset({elId:this.getId(c[h]),recalc:!0,timestamp:t});if(l(this.router.redraw(u,t,null)),c.length>0)for(var f=0;f<c.length;f++)l(this.router.redraw(this.getId(c[f]),t,null))}}return a}},{key:"unregisterEndpoint",value:function(e){var t=e.getUuid();t&&this.endpointsByUUID.delete(t),El(this._managedElements[e.elementId],e);for(var r in this.endpointsByElement){var a=this.endpointsByElement[r];if(a){for(var l=[],u=0,c=a.length;u<c;u++)a[u]!==e&&l.push(a[u]);this.endpointsByElement[r]=l}this.endpointsByElement[r].length<1&&delete this.endpointsByElement[r]}this.fire(Er,e)}},{key:"_maybePruneEndpoint",value:function(e){return e.deleteOnEmpty&&e.connections.length===0?(this.deleteEndpoint(e),!0):!1}},{key:"deleteEndpoint",value:function(e){var t=this,r=typeof e=="string"?this.endpointsByUUID.get(e):e;if(r){var a=r.proxiedBy,l=r.connections.slice();D(l,function(u){r.detachFromConnection(u,null,!0)}),this.unregisterEndpoint(r),r.destroy(),D(l,function(u){t.deleteConnection(u,{force:!0,endpointToIgnore:r})}),a!=null&&this.deleteEndpoint(a)}return this}},{key:"addEndpoint",value:function(e,t,r){r=r||{};var a=w({},r);w(a,t||{});var l=w({element:e},a);return this._internal_newEndpoint(l)}},{key:"addEndpoints",value:function(e,t,r){for(var a=[],l=0,u=t.length;l<u;l++)a.push(this.addEndpoint(e,t[l],r));return a}},{key:"reset",value:function(){var e=this;this.silently(function(){e.endpointsByElement={},e._managedElements={},e.endpointsByUUID.clear(),e.viewport.reset(),e.router.reset(),e.groupManager.reset(),e.connections.length=0})}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(e){return this.endpointsByElement[this.getId(e)]||[]}},{key:"getEndpoint",value:function(e){return this.endpointsByUUID.get(e)}},{key:"setEndpointUuid",value:function(e,t){e.uuid&&this.endpointsByUUID.delete(e.uuid),e.uuid=t,this.endpointsByUUID.set(t,e)}},{key:"connect",value:function(e,t){try{var r=this._prepareConnectionParams(e,t),a=this._newConnection(r);return this._finaliseConnection(a,r),a}catch(l){ee(l);return}}},{key:"_prepareConnectionParams",value:function(e,t){var r=w({},e);t&&w(r,t);var a=r;if(a.source&&a.source.endpoint&&(a.sourceEndpoint=a.source),a.target&&a.target.endpoint&&(a.targetEndpoint=a.target),e.uuids&&(a.sourceEndpoint=this.getEndpoint(e.uuids[0]),a.targetEndpoint=this.getEndpoint(e.uuids[1])),a.sourceEndpoint!=null){if(a.sourceEndpoint.isFull())throw Ca;if(a.type||(a.type=a.sourceEndpoint.edgeType),a.sourceEndpoint.connectorOverlays){a.overlays=a.overlays||[];for(var l=0,u=a.sourceEndpoint.connectorOverlays.length;l<u;l++)a.overlays.push(a.sourceEndpoint.connectorOverlays[l])}a.sourceEndpoint.scope&&(a.scope=a.sourceEndpoint.scope)}else if(a.source==null)throw ka;if(a.targetEndpoint!=null){if(a.targetEndpoint.isFull())throw xa}else if(a.target==null)throw Sa;if(a.sourceEndpoint&&a.targetEndpoint&&!_l(a.sourceEndpoint,a.targetEndpoint))throw"Cannot establish connection: scopes do not match";return a}},{key:"_newConnection",value:function(e){e.id="con_"+this._idstamp();var t=new Gt(this,e);return En(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this.paintConnection(t),t}},{key:"_finaliseConnection",value:function(e,t,r){t=t||{},e.suspendedEndpoint||this.connections.push(e),e.pending=null,e.endpoints[0].isTemporarySource=!1,this.repaint(e.source);var a={connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]};this.fire(_r,a,r),!t.doNotFireConnectionEvent&&t.fireEvent!==!1&&this.fire(ra,a,r)}},{key:"removeAllEndpoints",value:function(e,t){var r=this,a=function(u){var c=r.getId(u),h=r.endpointsByElement[c],f,v;if(h)for(f=0,v=h.length;f<v;f++)r.deleteEndpoint(h[f]);delete r.endpointsByElement[c]};return t&&this._getAssociatedElements(e).map(a),a(e),this}},{key:"_createSourceDefinition",value:function(e,t){var r=w({},t);w(r,e),r.edgeType=r.edgeType||sn;var a=this._deriveEndpointAndAnchorSpec(r.edgeType);r.endpoint=r.endpoint||a.endpoints[0],r.anchor=r.anchor||a.anchors[0];var l=r.maxConnections||-1,u={def:w({},r),uniqueEndpoint:r.uniqueEndpoint,maxConnections:l,enabled:!0,endpoint:null};return u}},{key:"addSourceSelector",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=this._createSourceDefinition(t),l=new dl(e,a,r);return this.sourceSelectors.push(l),l}},{key:"removeSourceSelector",value:function(e){V(this.sourceSelectors,function(t){return t===e})}},{key:"removeTargetSelector",value:function(e){V(this.targetSelectors,function(t){return t===e})}},{key:"addTargetSelector",value:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=this._createTargetDefinition(t),l=new fl(e,a,r);return this.targetSelectors.push(l),l}},{key:"_createTargetDefinition",value:function(e,t){var r=w({},t);w(r,e),r.edgeType=r.edgeType||sn;var a=r.maxConnections||-1,l={def:w({},r),uniqueEndpoint:r.uniqueEndpoint,maxConnections:a,enabled:!0,endpoint:null};return l}},{key:"show",value:function(e,t){return this._setVisible(e,ii,t)}},{key:"hide",value:function(e,t){return this._setVisible(e,Re,t)}},{key:"_setVisible",value:function(e,t,r){var a=t===ii,l=null;r&&(l=function(h){h.setVisible(a,!0,!0)});var u=this.getId(e);return this._operation(e,function(c){if(a&&r){var h=c.sourceId===u?1:0;c.endpoints[h].isVisible()&&c.setVisible(!0)}else c.setVisible(a)},l),this}},{key:"toggleVisible",value:function(e,t){var r=null;t&&(r=function(l){var u=l.isVisible();l.setVisible(!u)}),this._operation(e,function(a){var l=a.isVisible();a.setVisible(!l)},r)}},{key:"_operation",value:function(e,t,r){var a=this.getId(e),l=this.endpointsByElement[a];if(l&&l.length)for(var u=0,c=l.length;u<c;u++){for(var h=0,f=l[u].connections.length;h<f;h++){var v=t(l[u].connections[h]);if(v)return}r&&r(l[u])}}},{key:"registerConnectionType",value:function(e,t){if(this._connectionTypes.set(e,w({},t)),t.overlays){for(var r={},a=0;a<t.overlays.length;a++){var l=oi(t.overlays[a]);r[l.options.id]=l}this._connectionTypes.get(e).overlays=r}}},{key:"registerConnectionTypes",value:function(e){for(var t in e)this.registerConnectionType(t,e[t])}},{key:"registerEndpointType",value:function(e,t){if(this._endpointTypes.set(e,w({},t)),t.overlays){for(var r={},a=0;a<t.overlays.length;a++){var l=oi(t.overlays[a]);r[l.options.id]=l}this._endpointTypes.get(e).overlays=r}}},{key:"registerEndpointTypes",value:function(e){for(var t in e)this.registerEndpointType(t,e[t])}},{key:"getType",value:function(e,t){return t==="connection"?this.getConnectionType(e):this.getEndpointType(e)}},{key:"getConnectionType",value:function(e){return this._connectionTypes.get(e)}},{key:"getEndpointType",value:function(e){return this._endpointTypes.get(e)}},{key:"importDefaults",value:function(e){for(var t in e)this.defaults[t]=e[t];return e.container&&this.setContainer(e.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=w({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(e,t,r,a,l){var u=e.proxies[t]!=null,c,h=u?e.proxies[t].originalEp.elementId:e.endpoints[t].elementId,f=u?e.proxies[t].originalEp:e.endpoints[t],v=this.getId(r);e.proxies[t]?e.proxies[t].ep.elementId===v?c=e.proxies[t].ep:(e.proxies[t].ep.detachFromConnection(e,t),c=this._internal_newEndpoint({element:r,endpoint:a(e,t),anchor:l(e,t),parameters:{isProxyEndpoint:!0}})):c=this._internal_newEndpoint({element:r,endpoint:a(e,t),anchor:l(e,t),parameters:{isProxyEndpoint:!0}}),c.deleteOnEmpty=!0,e.proxies[t]={ep:c,originalEp:f},this.sourceOrTargetChanged(h,v,e,r,t),f.detachFromConnection(e,null,!0),c.connections=[e],e.endpoints[t]=c,f.proxiedBy=c,f.setVisible(!1),e.setVisible(!0),this.revalidate(r)}},{key:"unproxyConnection",value:function(e,t){if(!(e.proxies==null||e.proxies[t]==null)){var r=e.proxies[t].originalEp.element,a=e.proxies[t].originalEp.elementId,l=e.proxies[t].ep.elementId;e.endpoints[t]=e.proxies[t].originalEp,delete e.proxies[t].originalEp.proxiedBy,this.sourceOrTargetChanged(l,a,e,r,t),e.proxies[t].ep.detachFromConnection(e,null),e.proxies[t].originalEp.addConnection(e),e.isVisible()&&e.proxies[t].originalEp.setVisible(!0),e.proxies[t]=null,Ee(e.proxies,function(u){return u!=null})===-1&&(e.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(e,t,r,a,l){e!==t&&(l===0?(r.sourceId=t,r.source=a):l===1&&(r.targetId=t,r.target=a),Cn(r,this._managedElements[e]),En(r,this._managedElements[t]))}},{key:"getGroup",value:function(e){return this.groupManager.getGroup(e)}},{key:"getGroupFor",value:function(e){return this.groupManager.getGroupFor(e)}},{key:"addGroup",value:function(e){return this.groupManager.addGroup(e)}},{key:"addToGroup",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];return(t=this.groupManager).addToGroup.apply(t,[e,!1].concat(a))}},{key:"collapseGroup",value:function(e){this.groupManager.collapseGroup(e)}},{key:"expandGroup",value:function(e){this.groupManager.expandGroup(e)}},{key:"toggleGroup",value:function(e){this.groupManager.toggleGroup(e)}},{key:"removeGroup",value:function(e,t,r,a){return this.groupManager.removeGroup(e,t,r,a)}},{key:"removeAllGroups",value:function(e,t){this.groupManager.removeAllGroups(e,t,!1)}},{key:"removeFromGroup",value:function(e,t,r){this.groupManager.removeFromGroup(e,r,t),this._appendElement(t,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(t)})}},{key:"paintEndpoint",value:function(e,t){function r(k){var b=0;if(t.elementWithPrecedence!=null){for(var A=0;A<k.connections.length;A++)if(k.connections[A].sourceId===t.elementWithPrecedence||k.connections[A].targetId===t.elementWithPrecedence){b=A;break}}return k.connections[b]}t=t||{};var a=t.timestamp,l=t.recalc!==!1;if(!a||e.timestamp!==a){var u=this.viewport.getPosition(e.elementId),c=t.offset?{x:t.offset.x,y:t.offset.y}:{x:u.x,y:u.y};if(c!=null){var h=t.anchorLoc;if(h==null){var f={xy:c,wh:u,element:e,timestamp:a};if(l&&this.router.isDynamicAnchor(e)&&e.connections.length>0){var v=r(e),g=v.endpoints[0]===e?1:0,E=g===0?v.sourceId:v.targetId,y=this.viewport.getPosition(E);f.index=g===0?1:0,f.connection=v,f.txy=y,f.twh=y,f.tElement=v.endpoints[g],f.tRotation=this._getRotations(E)}else e.connections.length>0&&(f.connection=e.connections[0]);f.rotation=this._getRotations(e.elementId),h=this.router.computeAnchorLocation(e._anchor,f)}e.endpoint.compute(h,this.router.getEndpointOrientation(e),e.paintStyleInUse),this.renderEndpoint(e,e.paintStyleInUse),e.timestamp=a;for(var m in e.overlays)if(e.overlays.hasOwnProperty(m)){var C=e.overlays[m];C.isVisible()&&(e.overlayPlacements[m]=this.drawOverlay(C,e.endpoint,e.paintStyleInUse,e.getAbsoluteOverlayPosition(C)),this.paintOverlay(C,e.overlayPlacements[m],{xmin:0,ymin:0}))}}}}},{key:"paintConnection",value:function(e,t){if(!this._suspendDrawing&&e.visible!==!1){t=t||{};var r=t.timestamp;if(r!=null&&r===e.lastPaintedAt)return;if(r==null||r!==e.lastPaintedAt){this.router.computePath(e,r);var a={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var l in e.overlays)if(e.overlays.hasOwnProperty(l)){var u=e.overlays[l];u.isVisible()&&(e.overlayPlacements[l]=this.drawOverlay(u,e.connector,e.paintStyleInUse,e.getAbsoluteOverlayPosition(u)),a.xmin=Math.min(a.xmin,e.overlayPlacements[l].xmin),a.xmax=Math.max(a.xmax,e.overlayPlacements[l].xmax),a.ymin=Math.min(a.ymin,e.overlayPlacements[l].ymin),a.ymax=Math.max(a.ymax,e.overlayPlacements[l].ymax))}var c=parseFloat(""+e.paintStyleInUse.strokeWidth||"1")/2,h=parseFloat(""+e.paintStyleInUse.strokeWidth||"0"),f={xmin:Math.min(e.connector.bounds.xmin-(c+h),a.xmin),ymin:Math.min(e.connector.bounds.ymin-(c+h),a.ymin),xmax:Math.max(e.connector.bounds.xmax+(c+h),a.xmax),ymax:Math.max(e.connector.bounds.ymax+(c+h),a.ymax)};this.paintConnector(e.connector,e.paintStyleInUse,f);for(var v in e.overlays)if(e.overlays.hasOwnProperty(v)){var g=e.overlays[v];g.isVisible()&&this.paintOverlay(g,e.overlayPlacements[v],f)}}e.lastPaintedAt=r}}},{key:"refreshEndpoint",value:function(e){e.connections.length>0?this.addEndpointClass(e,this.endpointConnectedClass):this.removeEndpointClass(e,this.endpointConnectedClass),e.isFull()?this.addEndpointClass(e,this.endpointFullClass):this.removeEndpointClass(e,this.endpointFullClass)}},{key:"makeConnector",value:function(e,t,r){return ti.get(e,t,r)}},{key:"getPathData",value:function(e){for(var t="",r=0;r<e.segments.length;r++)t+=e.segments[r].getPath(r===0),t+=" ";return t}}]),n}(At),Qr=1e-10;function es(s){var o=Math.floor(s),n=Math.ceil(s);return s-o<Qr?o:n-s<Qr?n:s}var ts=function(s){F(n,s);var o=j(n);function n(i){var e;G(this,n),e=o.call(this,i),d(p(e),"type",n.segmentType),d(p(e),"cx",void 0),d(p(e),"cy",void 0),d(p(e),"radius",void 0),d(p(e),"anticlockwise",void 0),d(p(e),"startAngle",void 0),d(p(e),"endAngle",void 0),d(p(e),"sweep",void 0),d(p(e),"length",void 0),d(p(e),"circumference",void 0),d(p(e),"frac",void 0),e.cx=i.cx,e.cy=i.cy,e.radius=i.r,e.anticlockwise=i.ac,i.startAngle&&i.endAngle?(e.startAngle=i.startAngle,e.endAngle=i.endAngle,e.x1=e.cx+e.radius*Math.cos(e.startAngle),e.y1=e.cy+e.radius*Math.sin(e.startAngle),e.x2=e.cx+e.radius*Math.cos(e.endAngle),e.y2=e.cy+e.radius*Math.sin(e.endAngle)):(e.startAngle=e._calcAngle(e.x1,e.y1),e.endAngle=e._calcAngle(e.x2,e.y2)),e.endAngle<0&&(e.endAngle+=Ge),e.startAngle<0&&(e.startAngle+=Ge);var t=e.endAngle<e.startAngle?e.endAngle+Ge:e.endAngle;return e.sweep=Math.abs(t-e.startAngle),e.anticlockwise&&(e.sweep=Ge-e.sweep),e.circumference=2*Math.PI*e.radius,e.frac=e.sweep/Ge,e.length=e.circumference*e.frac,e.extents={xmin:e.cx-e.radius,xmax:e.cx+e.radius,ymin:e.cy-e.radius,ymax:e.cy+e.radius},e}return L(n,[{key:"_calcAngle",value:function(e,t){return Ao({x:this.cx,y:this.cy},{x:e,y:t})}},{key:"_calcAngleForLocation",value:function(e,t){if(e.anticlockwise){var r=e.startAngle<e.endAngle?e.startAngle+Ge:e.startAngle,a=Math.abs(r-e.endAngle);return r-a*t}else{var l=e.endAngle<e.startAngle?e.endAngle+Ge:e.endAngle,u=Math.abs(l-e.startAngle);return e.startAngle+u*t}}},{key:"getPath",value:function(e){var t=this.sweep>Math.PI?1:0,r=this.anticlockwise?0:1;return(e?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+t+","+r+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(e,t){if(e===0)return{x:this.x1,y:this.y1,theta:this.startAngle};if(e===1)return{x:this.x2,y:this.y2,theta:this.endAngle};t&&(e=e/length);var r=this._calcAngleForLocation(this,e),a=this.cx+this.radius*Math.cos(r),l=this.cy+this.radius*Math.sin(r);return{x:es(a),y:es(l),theta:r}}},{key:"gradientAtPoint",value:function(e,t){var r=this.pointOnPath(e,t),a=Po({x:this.cx,y:this.cy},r);return!this.anticlockwise&&(a===1/0||a===-1/0)&&(a*=-1),a}},{key:"pointAlongPathFrom",value:function(e,t,r){var a=this.pointOnPath(e,r),l=t/this.circumference*2*Math.PI,u=this.anticlockwise?-1:1,c=a.theta+u*l,h=this.cx+this.radius*Math.cos(c),f=this.cy+this.radius*Math.sin(c);return{x:h,y:f}}}]),n}(nr);d(ts,"segmentType","Arc");var xl=20,kl=20,pt=function(s){F(n,s);var o=j(n);function n(i,e,t){var r;return G(this,n),r=o.call(this,i,e,t),r.instance=i,r.component=e,d(p(r),"width",void 0),d(p(r),"length",void 0),d(p(r),"foldback",void 0),d(p(r),"direction",void 0),d(p(r),"location",.5),d(p(r),"paintStyle",void 0),d(p(r),"type",n.type),d(p(r),"cachedDimensions",void 0),t=t||{},r.width=t.width||xl,r.length=t.length||kl,r.direction=(t.direction||1)<0?-1:1,r.foldback=t.foldback||.623,r.paintStyle=t.paintStyle||{strokeWidth:1},r.location=t.location==null?r.location:Array.isArray(t.location)?t.location[0]:t.location,r}return L(n,[{key:"draw",value:function(e,t,r){if(e instanceof ei){var a=e,l,u,c,h,f;if(this.location>1||this.location<0){var v=this.location<0?1:0;l=a.pointAlongPathFrom(v,this.location,!1),u=a.pointAlongPathFrom(v,this.location-this.direction*this.length/2,!1),c=Ne(l,u,this.length)}else if(this.location===1){if(l=a.pointOnPath(this.location),u=a.pointAlongPathFrom(this.location,-this.length),c=Ne(l,u,this.length),this.direction===-1){var g=c;c=l,l=g}}else if(this.location===0){if(c=a.pointOnPath(this.location),u=a.pointAlongPathFrom(this.location,this.length),l=Ne(c,u,this.length),this.direction===-1){var E=c;c=l,l=E}}else l=a.pointAlongPathFrom(this.location,this.direction*this.length/2),u=a.pointOnPath(this.location),c=Ne(l,u,this.length);h=Do(l,c,this.width),f=Ne(l,c,this.foldback*this.length);var y={hxy:l,tail:h,cxy:f},m=this.paintStyle.stroke||t.stroke,C=this.paintStyle.fill||t.stroke,k=this.paintStyle.strokeWidth||t.strokeWidth;return{component:e,d:y,"stroke-width":k,stroke:m,fill:C,xmin:Math.min(l.x,h[0].x,h[1].x),xmax:Math.max(l.x,h[0].x,h[1].x),ymin:Math.min(l.y,h[0].y,h[1].y),ymax:Math.max(l.y,h[0].y,h[1].y)}}}},{key:"updateFrom",value:function(e){}}]),n}(fn);d(pt,"type","Arrow");function hi(s){return s.type===pt.type}je.register(pt.type,pt);var di=function(s){F(n,s);var o=j(n);function n(i,e,t){var r;return G(this,n),r=o.call(this,i,e,t),r.instance=i,d(p(r),"type",n.type),r.foldback=1,r}return n}(pt);d(di,"type","PlainArrow");function fi(s){return s.type===di.type}je.register("PlainArrow",di);var xn=function(s){F(n,s);var o=j(n);function n(i,e,t){var r;return G(this,n),r=o.call(this,i,e,t),r.instance=i,d(p(r),"type",n.type),r.length=r.length/2,r.foldback=2,r}return n}(pt);d(xn,"type","Diamond");function vi(s){return s.type===xn.type}je.register(xn.type,xn);var pi=function(s){F(n,s);var o=j(n);function n(i,e,t){var r;return G(this,n),r=o.call(this,i,e,t),r.instance=i,r.component=e,d(p(r),"create",void 0),d(p(r),"type",n.type),r.create=t.create,r}return L(n,[{key:"updateFrom",value:function(e){}}]),n}(fn);d(pi,"type","Custom");function Pe(s){return s.type===pi.type}je.register("Custom",pi);xe.registerHandler(Uo);xe.registerHandler(Xo);xe.registerHandler(Yo);ti.register(un.type,un);function gt(s){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?gt=function(o){return typeof o}:gt=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},gt(s)}function J(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function ns(s,o){for(var n=0;n<o.length;n++){var i=o[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,i.key,i)}}function Z(s,o,n){return o&&ns(s.prototype,o),n&&ns(s,n),s}function _(s,o,n){return o in s?Object.defineProperty(s,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[o]=n,s}function kn(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),o&&gi(s,o)}function ne(s){return ne=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},ne(s)}function gi(s,o){return gi=Object.setPrototypeOf||function(i,e){return i.__proto__=e,i},gi(s,o)}function Sl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function x(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function bl(s,o){return o&&(typeof o=="object"||typeof o=="function")?o:x(s)}function Sn(s){var o=Sl();return function(){var i=ne(s),e;if(o){var t=ne(this).constructor;e=Reflect.construct(i,arguments,t)}else e=i.apply(this,arguments);return bl(this,e)}}function Tl(s,o){for(;!Object.prototype.hasOwnProperty.call(s,o)&&(s=ne(s),s!==null););return s}function le(s,o,n){return typeof Reflect!="undefined"&&Reflect.get?le=Reflect.get:le=function(e,t,r){var a=Tl(e,t);if(!!a){var l=Object.getOwnPropertyDescriptor(a,t);return l.get?l.get.call(r):l.value}},le(s,o,n||s)}function Pl(s,o){return Al(s)||Dl(s,o)||Ol(s,o)||wl()}function Al(s){if(Array.isArray(s))return s}function Dl(s,o){var n=s==null?null:typeof Symbol!="undefined"&&s[Symbol.iterator]||s["@@iterator"];if(n!=null){var i=[],e=!0,t=!1,r,a;try{for(n=n.call(s);!(e=(r=n.next()).done)&&(i.push(r.value),!(o&&i.length===o));e=!0);}catch(l){t=!0,a=l}finally{try{!e&&n.return!=null&&n.return()}finally{if(t)throw a}}return i}}function Ol(s,o){if(!!s){if(typeof s=="string")return is(s,o);var n=Object.prototype.toString.call(s).slice(8,-1);if(n==="Object"&&s.constructor&&(n=s.constructor.name),n==="Map"||n==="Set")return Array.from(s);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return is(s,o)}}function is(s,o){(o==null||o>s.length)&&(o=s.length);for(var n=0,i=new Array(o);n<o;n++)i[n]=s[n];return i}function wl(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Be(s,o,n){n=n||s.parentNode;for(var i=n.querySelectorAll(o),e=0;e<i.length;e++)if(i[e]===s)return!0;return!1}function yt(s,o){s.stopPropagation?s.stopPropagation():s.returnValue=!1,!o&&s.preventDefault&&s.preventDefault()}function pe(s,o,n,i){if(i&&Be(s,o,n))return s;for(s=s.parentNode;s!=null&&s!==n;){if(Be(s,o))return s;s=s.parentNode}}function _t(s){return s.srcElement||s.target}function Il(s,o,n){o=Wn(o),typeof s.className.baseVal!="undefined"?s.className.baseVal=o:s.className=o;try{var i=s.classList;if(i!=null){for(;i.length>0;)i.remove(i.item(0));for(var e=0;e<n.length;e++)n[e]&&i.add(n[e])}}catch(t){ee("JSPLUMB: cannot set class list",t)}}function yi(s){return s.className!=null?typeof s.className.baseVal=="undefined"?s.className:s.className.baseVal:""}function rs(s,o,n){var i=o==null?[]:Array.isArray(o)?o:o.split(/\s+/),e=n==null?[]:Array.isArray(n)?n:n.split(/\s+/),t=yi(s),r=t.split(/\s+/),a=function(u,c){for(var h=0;h<c.length;h++)if(u)r.indexOf(c[h])===-1&&r.push(c[h]);else{var f=r.indexOf(c[h]);f!==-1&&r.splice(f,1)}};a(!0,i),a(!1,e),Il(s,r.join(" "),r)}function Nt(s){return!R(s)&&!Array.isArray(s)&&s.length!=null&&s.documentElement==null&&s.nodeType==null}function Ml(s){return yi(s)}function Ve(s,o){var n=function(e,t){if(e!=null&&t!=null&&t.length>0)if(e.classList){var r=Wn(t).split(/\s+/);D(r,function(a){e.classList.add(a)})}else rs(e,t)};Nt(s)?D(s,function(i){return n(i,o)}):n(s,o)}function Gl(s,o){return s.classList?s.classList.contains(o):yi(s).indexOf(o)!==-1}function _i(s,o){var n=function(e,t){if(e!=null&&t!=null&&t.length>0)if(e.classList){var r=Wn(t).split(/\s+/);r.forEach(function(a){e.classList.remove(a)})}else rs(e,null,t)};Nt(s)?D(s,function(i){return n(i,o)}):n(s,o)}function Nl(s,o){var n=this,i=function(t,r){t!=null&&r!=null&&r.length>0&&(t.classList?t.classList.toggle(r):n.hasClass(t,r)?n.removeClass(t,r):n.addClass(t,r))};Nt(s)?D(s,function(e){return i(e,o)}):i(s,o)}function mi(s,o,n,i){return ss(null,s,o,n,i)}function ss(s,o,n,i,e){var t=s==null?document.createElement(o):document.createElementNS(s,o),r;n=n||{};for(r in n)t.style[r]=n[r];i&&(t.className=i),e=e||{};for(r in e)t.setAttribute(r,""+e[r]);return t}function mt(s){var o=s.getBoundingClientRect(),n=document.body,i=document.documentElement,e=window.pageYOffset||i.scrollTop||n.scrollTop,t=window.pageXOffset||i.scrollLeft||n.scrollLeft,r=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,l=o.top+e-r,u=o.left+t-a;return{x:Math.round(u),y:Math.round(l)}}function Ll(s){return{w:s.offsetWidth,h:s.offsetHeight}}var os={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},Lt="stroke-dasharray",Ei="dashstyle",Rl="fill",Fl="stroke",jl="stroke-width",Hl="strokeWidth",as="svg",Ci="path",ls={svg:"http://www.w3.org/2000/svg"};function ge(s,o){for(var n in o)s.setAttribute(n,""+o[n])}function ye(s,o){return o=o||{},o.version="1.1",o.xmlns=ls.svg,ss(ls.svg,s,null,null,o)}function xi(s){return"position:absolute;left:"+s[0]+"px;top:"+s[1]+"px"}function ki(s,o,n){if(o.setAttribute(Rl,n.fill?n.fill:Re),o.setAttribute(Fl,n.stroke?n.stroke:Re),n.strokeWidth&&o.setAttribute(jl,n.strokeWidth),n[Ei]&&n[Hl]&&!n[Lt]){var i=n[Ei].indexOf(",")===-1?" ":",",e=n[Ei].split(i),t="";D(e,function(a){t+=Math.floor(a*n.strokeWidth)+i}),o.setAttribute(Lt,t)}else n[Lt]&&o.setAttribute(Lt,n[Lt]);for(var r in os)n[r]&&o.setAttribute(os[r],n[r])}function bn(s,o,n){s.childNodes.length>n?s.insertBefore(o,s.childNodes[n]):s.appendChild(o)}function us(s,o,n,i,e){s.style.width=i+"px",s.style.height=e+"px",s.style.left=o+"px",s.style.top=n+"px",s.height=e,s.width=i}function B(s,o,n){var i=[s,o];return n&&i.push(n),i.join(":")}var cs="data-jtk-container",Bl="data-jtk-group-content",Tn="data-jtk-enabled",Si="data-jtk-scope",Ue="endpoint",Et="element",Ye="connection",bi="div",se="click",hs="contextmenu",ve="dblclick",ue="dbltap",Vl="focus",Xe="mousedown",Ti="mouseenter",Pi="mouseexit",Ai="mousemove",$e="mouseup",oe="mouseout",ae="mouseover",ce="tap",Ul="drag:move",Yl="drag:stop",Xl="drag:start",Pn="revert",$l="connection:abort",ds="connection:drag",fs=B(Et,se),Wl=B(Et,ve),vs=B(Et,ue),ql=B(Et,oe),Kl=B(Et,ae),ps=B(Et,ce),Jl=B(Ue,se),Zl=B(Ue,ve);B(Ue,ue);var zl=B(Ue,oe),Ql=B(Ue,ae);B(Ue,ce);var eu=B(Ye,se),tu=B(Ye,ve),nu=B(Ye,ue),iu=B(Ye,oe),ru=B(Ye,ae),su=B(Ye,ce),gs="position",Ae=st(ri),Rt=st(Dt),ou=ni(vr),au=ni(Bl),_e=st(dn);function lu(s,o,n,i,e,t,r){return new Touch({target:s,identifier:X(),pageX:o,pageY:n,screenX:i,screenY:e,clientX:t||i,clientY:r||e})}function uu(){var s=[];return s.push.apply(s,arguments),s.item=function(o){return this[o]},s}function cu(s,o,n,i,e,t,r){return uu(lu(s,o,n,i,e,t,r))}function Ft(s,o,n){n=n||s.parentNode;for(var i=n.querySelectorAll(o),e=0;e<i.length;e++)if(i[e]===s)return!0;return!1}function jt(s){return s.srcElement||s.target}function Di(s,o,n,i){if(i){if(typeof s.path!="undefined"&&s.path.indexOf)return{path:s.path,end:s.path.indexOf(n)};var e={path:[],end:-1},t=function r(a){e.path.push(a),a===n?e.end=e.path.length-1:a.parentNode!=null&&r(a.parentNode)};return t(o),e}else return{path:[o],end:1}}function hu(s,o){var n=0,i;for(n=0,i=s.length;n<i&&s[n][0]!==o;n++);n<s.length&&s.splice(n,1)}var du=1,Ht="ontouchstart"in document.documentElement||navigator.maxTouchPoints!=null&&navigator.maxTouchPoints>0,An="onmousedown"in document.documentElement,me={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},fu="page",vu="screen",pu="client";function Oi(s,o){if(s==null)return{x:0,y:0};var n=ys(s),i=_u(n,0);return{x:i[o+"X"],y:i[o+"Y"]}}function Dn(s){return Oi(s,fu)}function gu(s){return Oi(s,vu)}function yu(s){return Oi(s,pu)}function _u(s,o){return s.item?s.item(o):s[o]}function ys(s){return s.touches&&s.touches.length>0?s.touches:s.changedTouches&&s.changedTouches.length>0?s.changedTouches:s.targetTouches&&s.targetTouches.length>0?s.targetTouches:[s]}function mu(s){return ys(s).length}function On(s,o,n,i,e){if(ms(s,o,n),i.__tauid=n.__tauid,s.addEventListener)s.addEventListener(o,n,!1,e);else if(s.attachEvent){var t=o+n.__tauid;s["e"+t]=n,s[t]=function(){s["e"+t]&&s["e"+t](window.event)},s.attachEvent("on"+o,s[t])}}function Bt(s,o,n){var i=this;n!=null&&_s(s,function(e){if(Eu(e,o,n),n.__tauid!=null){if(e.removeEventListener)e.removeEventListener(o,n,!1),Ht&&me[o]&&e.removeEventListener(me[o],n,!1);else if(i.detachEvent){var t=o+n.__tauid;e[t]&&e.detachEvent("on"+o,e[t]),e[t]=null,e["e"+t]=null}}n.__taTouchProxy&&Bt(s,n.__taTouchProxy[1],n.__taTouchProxy[0])})}function _s(s,o){if(s!=null)for(var n=typeof s=="string"?document.querySelectorAll(s):s.length!=null?s:[s],i=0;i<n.length;i++)o(n[i])}function ms(s,o,n){var i=du++;return s.__ta=s.__ta||{},s.__ta[o]=s.__ta[o]||{},s.__ta[o][i]=n,n.__tauid=i,i}function Eu(s,o,n){if(s.__ta&&s.__ta[o]&&delete s.__ta[o][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)Bt(s,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}function wn(s,o,n,i){if(s==null)return n;var e=s.split(","),t=function r(a){r.__tauid=n.__tauid;var l=jt(a),u=!1,c=l,h=Di(a,l,o,s!=null);if(h.end!=-1)for(var f=0;!u&&f<h.end;f++){c=h.path[f];for(var v=0;!u&&v<e.length;v++)if(Ft(c,e[v],o)){n.apply(c,[a,c]),u=!0;break}}};return Cu(n,i,t),t}function Cu(s,o,n){s.__taExtra=s.__taExtra||[],s.__taExtra.push([o,n])}var In=function(o,n,i,e,t){if(Ht&&me[n]){var r=wn(e,o,i,me[n]);On(o,me[n],r,i,t)}n===Vl&&o.getAttribute(pr)==null&&o.setAttribute(pr,"1"),On(o,n,wn(e,o,i,n),i,t)},wi={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}};function Es(s,o,n,i){for(var e in n.__tamee[s])n.__tamee[s].hasOwnProperty(e)&&n.__tamee[s][e].apply(i,[o])}var xu=function(){function s(){J(this,s)}return Z(s,null,[{key:"generate",value:function(n,i){return function(e,t,r,a){if(t==hs&&An)In(e,t,r,a);else{if(e.__taTapHandler==null){var l=e.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},u=function(g){for(var E=jt(g),y=Di(g,E,e,a!=null),m=!1,C=0;C<y.end;C++){if(m)return;E=y.path[C];for(var k=0;k<l.downSelectors.length;k++)if(l.downSelectors[k]==null||Ft(E,l.downSelectors[k],e)){l.down=!0,setTimeout(h,n),setTimeout(f,i),m=!0;break}}},c=function(g){if(l.down){var E=jt(g),y,m;l.taps++;var C=mu(g);for(var k in wi)if(wi.hasOwnProperty(k)){var b=wi[k];if(b.touches===C&&(b.taps===1||b.taps===l.taps))for(var A=0;A<l[k].length;A++){m=Di(g,E,e,l[k][A][1]!=null);for(var O=0;O<m.end;O++)if(y=m.path[O],l[k][A][1]==null||Ft(y,l[k][A][1],e)){l[k][A][0].apply(y,[g,y]);break}}}}},h=function(){l.down=!1},f=function(){l.taps=0};e.__taTapHandler.downHandler=u,e.__taTapHandler.upHandler=c,In(e,Xe,u),In(e,$e,c)}e.__taTapHandler.downSelectors.push(a),e.__taTapHandler[t].push([r,a]),r.__taUnstore=function(){e.__taTapHandler!=null&&(V(e.__taTapHandler.downSelectors,function(v){return v===a}),hu(e.__taTapHandler[t],r),e.__taTapHandler.downSelectors.length===0&&(Bt(e,Xe,e.__taTapHandler.downHandler),Bt(e,$e,e.__taTapHandler.upHandler),delete e.__taTapHandler))}}}}}]),s}(),ku=function(){function s(){J(this,s)}return Z(s,null,[{key:"generate",value:function(){var n=[];return function(i,e,t,r){if(!i.__tamee){i.__tamee={over:!1,mouseenter:[],mouseexit:[]};var a=function(c){var h=jt(c);(r==null&&h==i&&!i.__tamee.over||Ft(h,r,i)&&(h.__tamee==null||!h.__tamee.over))&&(Es(Ti,c,i,h),h.__tamee=h.__tamee||{},h.__tamee.over=!0,n.push(h))},l=function(c){for(var h=jt(c),f=0;f<n.length;f++)h==n[f]&&!Ft(c.relatedTarget||c.toElement,"*",h)&&(h.__tamee.over=!1,n.splice(f,1),Es(Pi,c,i,h))};On(i,ae,wn(r,i,a,ae),a),On(i,oe,wn(r,i,l,oe),l)}t.__taUnstore=function(){delete i.__tamee[e][t.__tauid]},ms(i,e,t),i.__tamee[e][t.__tauid]=t}}}]),s}(),Cs=function(){function s(o){J(this,s),_(this,"clickThreshold",void 0),_(this,"dblClickThreshold",void 0),_(this,"tapHandler",void 0),_(this,"mouseEnterExitHandler",void 0),o=o||{},this.clickThreshold=o.clickThreshold||250,this.dblClickThreshold=o.dblClickThreshold||450,this.mouseEnterExitHandler=ku.generate(),this.tapHandler=xu.generate(this.clickThreshold,this.dblClickThreshold)}return Z(s,[{key:"_doBind",value:function(n,i,e,t,r){if(e!=null){var a=n;i===ce||i===ue||i===hs?this.tapHandler(a,i,e,t,r):i===Ti||i==Pi?this.mouseEnterExitHandler(a,i,e,t,r):In(a,i,e,t,r)}}},{key:"on",value:function(n,i,e,t,r){var a=t==null?null:e,l=t==null?e:t;return this._doBind(n,i,l,a,r),this}},{key:"off",value:function(n,i,e){return Bt(n,i,e),this}},{key:"trigger",value:function(n,i,e,t,r){var a=An&&(typeof MouseEvent=="undefined"||e==null||e.constructor===MouseEvent),l=Ht&&!An&&me[i]?me[i]:i,u=!(Ht&&!An&&me[i]),c=Dn(e),h=gu(e),f=yu(e);return _s(n,function(v){var g;e=e||{screenX:h.x,screenY:h.y,clientX:f.x,clientY:f.y};var E=function(b){t&&(b.payload=t)},y={TouchEvent:function(b){var A=cu(v,c.x,c.y,h.x,h.y,f.x,f.y),O=b.initTouchEvent||b.initEvent;O(l,!0,!0,window,null,h.x,h.y,f.x,f.y,!1,!1,!1,!1,A,A,A,1,0)},MouseEvents:function(b){b.initMouseEvent(l,!0,!0,window,r==null?1:r,h.x,h.y,f.x,f.y,!1,!1,!1,!1,1,v)}},m=!u&&!a&&Ht&&me[i],C=m?"TouchEvent":"MouseEvents";g=document.createEvent(C),y[C](g),E(g),v.dispatchEvent(g)}),this}}]),s}();function Su(s,o,n){if(Be(o,n,s))return o;for(var i=o.parentNode;i!=null&&i!==s;){if(Be(i,n,s))return i;i=i.parentNode}}function Vt(s){return{x:s.offsetLeft,y:s.offsetTop}}function xs(s){return{w:s.offsetWidth,h:s.offsetHeight}}function ks(s,o){s.style.left=o.x+"px",s.style.top=o.y+"px"}function bu(s){return typeof s=="function"?(s._katavorioId=X(),s._katavorioId):s}function Ss(s,o,n){var i=o.parentNode,e=s.getSize(i),t=s.getSize(o),r=n.x,a=r+t.w,l=n.y,u=l+t.h;return a>0&&r<e.w&&u>0&&l<e.h}function Tu(s,o,n){for(var i=null,e=o.getAttribute("katavorio-draggable"),t=e!=null?"[katavorio-draggable='"+e+"'] ":"",r=0;r<s.length;r++)if(i=Su(o,n,t+s[r].selector),i!=null){if(s[r].filter){var a=Be(n,s[r].filter,i),l=s[r].filterExclude===!0;if(l&&!a||a)return null}return[s[r],i]}return null}var bs="start",Ts="beforeStart",Ps="drag",Pu="drop",Au="over",Du="out",As="stop",Ds="katavorio-draggable",Ou=Ds,wu=10,Iu=10,Ii=function(){return!0},Mu=function(){return!1},Ut={delegatedDraggable:"katavorio-delegated-draggable",draggable:Ou,drag:"katavorio-drag",selected:"katavorio-drag-selected",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},Mi=[As,bs,Ps,Pu,Au,Du,Ts],Gu=function(){},Ct=function(o,n){if(o!=null){o=!R(o)&&o.tagName==null&&o.length!=null?o:[o];for(var i=0;i<o.length;i++)n.apply(o[i],[o[i]])}},Nu=function(o,n,i){var e=o.srcElement||o.target;return!Be(e,i.getInputFilterSelector(),n)},Lu=function(){function s(o,n){J(this,s),this.el=o,this.k=n,_(this,"_class",void 0),_(this,"uuid",X()),_(this,"enabled",!0),_(this,"scopes",[])}return Z(s,[{key:"setEnabled",value:function(n){this.enabled=n}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(n){var i={};Ct(this.scopes,function(t){i[t]=!0}),Ct(n?n.split(/\s+/):[],function(t){i[t]=!0}),this.scopes.length=0;for(var e in i)this.scopes.push(e)}},{key:"removeScope",value:function(n){var i={};Ct(this.scopes,function(t){i[t]=!0}),Ct(n?n.split(/\s+/):[],function(t){delete i[t]}),this.scopes.length=0;for(var e in i)this.scopes.push(e)}},{key:"toggleScope",value:function(n){var i={};Ct(this.scopes,function(t){i[t]=!0}),Ct(n?n.split(/\s+/):[],function(t){i[t]?delete i[t]:i[t]=!0}),this.scopes.length=0;for(var e in i)this.scopes.push(e)}}]),s}();function Ru(s){return{w:s.parentNode.offsetWidth+s.parentNode.scrollLeft,h:s.parentNode.offsetHeight+s.parentNode.scrollTop}}var Yt;(function(s){s.notNegative="notNegative",s.parent="parent",s.parentEnclosed="parentEnclosed"})(Yt||(Yt={}));var Fu=function(s){kn(n,s);var o=Sn(n);function n(i,e,t){var r;if(J(this,n),r=o.call(this,i,t),_(x(r),"_class",void 0),_(x(r),"rightButtonCanDrag",void 0),_(x(r),"consumeStartEvent",void 0),_(x(r),"clone",void 0),_(x(r),"scroll",void 0),_(x(r),"trackScroll",void 0),_(x(r),"_downAt",void 0),_(x(r),"_posAtDown",void 0),_(x(r),"_pagePosAtDown",void 0),_(x(r),"_pageDelta",{x:0,y:0}),_(x(r),"_moving",void 0),_(x(r),"_lastPosition",void 0),_(x(r),"_lastScrollValues",{x:0,y:0}),_(x(r),"_initialScroll",{x:0,y:0}),_(x(r),"_size",void 0),_(x(r),"_currentParentPosition",void 0),_(x(r),"_ghostParentPosition",void 0),_(x(r),"_dragEl",void 0),_(x(r),"_multipleDrop",void 0),_(x(r),"_ghostProxyOffsets",void 0),_(x(r),"_ghostDx",void 0),_(x(r),"_ghostDy",void 0),_(x(r),"_isConstrained",!1),_(x(r),"_ghostProxyParent",void 0),_(x(r),"_useGhostProxy",void 0),_(x(r),"_ghostProxyFunction",void 0),_(x(r),"_activeSelectorParams",void 0),_(x(r),"_availableSelectors",[]),_(x(r),"_canDrag",void 0),_(x(r),"_consumeFilteredEvents",void 0),_(x(r),"_parent",void 0),_(x(r),"_ignoreZoom",void 0),_(x(r),"_filters",{}),_(x(r),"_constrainRect",void 0),_(x(r),"_elementToDrag",void 0),_(x(r),"downListener",void 0),_(x(r),"moveListener",void 0),_(x(r),"upListener",void 0),_(x(r),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),r._class=r.k.css.draggable,Ve(r.el,r._class),r.downListener=r._downListener.bind(x(r)),r.upListener=r._upListener.bind(x(r)),r.moveListener=r._moveListener.bind(x(r)),r.rightButtonCanDrag=e.rightButtonCanDrag===!0,r.consumeStartEvent=e.consumeStartEvent!==!1,r._dragEl=r.el,r.clone=e.clone===!0,r.scroll=e.scroll===!0,r.trackScroll=e.trackScroll!==!1,r._multipleDrop=e.multipleDrop!==!1,r._canDrag=e.canDrag||Ii,r._consumeFilteredEvents=e.consumeFilteredEvents,r._parent=e.parent,r._ignoreZoom=e.ignoreZoom===!0,r._ghostProxyParent=e.ghostProxyParent,r.trackScroll&&document.addEventListener("scroll",function(l){if(r._moving){var u={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},c=u.x-r._lastScrollValues.x,h=u.y-r._lastScrollValues.y,f={x:c+r._lastPosition.x,y:h+r._lastPosition.y},v=f.x-r._downAt.x,g=f.y-r._downAt.y,E=r._ignoreZoom?1:r.k.getZoom();r._dragEl&&r._dragEl.parentNode&&(v+=r._dragEl.parentNode.scrollLeft-r._initialScroll.x,g+=r._dragEl.parentNode.scrollTop-r._initialScroll.y),v/=E,g/=E,r.moveBy(v,g,l),r._lastPosition=f,r._lastScrollValues=u}}),e.ghostProxy===!0?r._useGhostProxy=Ii:e.ghostProxy&&typeof e.ghostProxy=="function"?r._useGhostProxy=e.ghostProxy:r._useGhostProxy=function(l,u){return r._activeSelectorParams&&r._activeSelectorParams.useGhostProxy?r._activeSelectorParams.useGhostProxy(l,u):!1},e.makeGhostProxy?r._ghostProxyFunction=e.makeGhostProxy:r._ghostProxyFunction=function(l){return r._activeSelectorParams&&r._activeSelectorParams.makeGhostProxy?r._activeSelectorParams.makeGhostProxy(l):l.cloneNode(!0)},e.selector){var a=r.el.getAttribute(Ds);a==null&&(a=""+new Date().getTime(),r.el.setAttribute("katavorio-draggable",a)),r._availableSelectors.push(e)}return r.k.eventManager.on(r.el,Xe,r.downListener),r}return Z(n,[{key:"on",value:function(e,t){this.listeners[e]&&this.listeners[e].push(t)}},{key:"off",value:function(e,t){if(this.listeners[e]){for(var r=[],a=0;a<this.listeners[e].length;a++)this.listeners[e][a]!==t&&r.push(this.listeners[e][a]);this.listeners[e]=r}}},{key:"_upListener",value:function(e){this._downAt&&(this._downAt=null,this.k.eventManager.off(document,Ai,this.moveListener),this.k.eventManager.off(document,$e,this.upListener),_i(document.body,Ut.noSelect),this.unmark(e),this.stop(e),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&this._activeSelectorParams.revertFunction(this._dragEl,Vt(this._dragEl))===!0&&(ks(this._dragEl,this._posAtDown),this._dispatch(Pn,this._dragEl)))}},{key:"_downListener",value:function(e){if(!e.defaultPrevented){var t=this.rightButtonCanDrag||e.which!==3&&e.button!==2;if(t&&this.isEnabled()&&this._canDrag()){var r=this._testFilter(e)&&Nu(e,this.el,this.k);if(r){this._activeSelectorParams=null,this._elementToDrag=null,this._availableSelectors.length===0&&console.log("JSPLUMB: no available drag selectors");var a=e.target||e.srcElement,l=Tu(this._availableSelectors,this.el,a);if(l!=null&&(this._activeSelectorParams=l[0],this._elementToDrag=l[1]),this._activeSelectorParams==null||this._elementToDrag==null)return;var u=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag):null;if(u!=null&&(this._elementToDrag=u),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),Ve(this._dragEl,Ut.clonedDrag),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",this._parent!=null){var c=Vt(this.el);this._dragEl.style.left=c.x+"px",this._dragEl.style.top=c.y+"px",this._parent.appendChild(this._dragEl)}else{var h=mt(this._elementToDrag);this._dragEl.style.left=h.x+"px",this._dragEl.style.top=h.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&yt(e),this._downAt=Dn(e),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=Vt(this._dragEl),this._pagePosAtDown=mt(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=xs(this._dragEl),this.k.eventManager.on(document,Ai,this.moveListener),this.k.eventManager.on(document,$e,this.upListener),Ve(document.body,Ut.noSelect),this._dispatch(Ts,{el:this.el,pos:this._posAtDown,e,drag:this,size:this._size})}else this._consumeFilteredEvents&&yt(e)}}}},{key:"_moveListener",value:function(e){if(this._downAt){if(!this._moving){var t=this._dispatch(bs,{el:this.el,pos:this._posAtDown,e,drag:this,size:this._size});if(t!==!1){if(!this._downAt)return;this.mark(t),this._moving=!0}else this.abort()}if(this._downAt){var r=Dn(e),a=r.x-this._downAt.x,l=r.y-this._downAt.y,u=this._ignoreZoom?1:this.k.getZoom();this._lastPosition={x:r.x,y:r.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(a+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,l+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),a/=u,l/=u,this.moveBy(a,l,e)}}}},{key:"mark",value:function(e){this._posAtDown=Vt(this._dragEl),this._pagePosAtDown=mt(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=xs(this._dragEl),Ve(this._dragEl,this.k.css.drag),this._constrainRect=Ru(this._dragEl),this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(e){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,_i(this._dragEl,this.k.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(e,t,r){var a=this.toGrid({x:this._posAtDown.x+e,y:this._posAtDown.y+t}),l=this._doConstrain(a,this._dragEl,this._constrainRect,this._size);if(this._useGhostProxy(this.el,this._dragEl))if(a.x!==l.x||a.y!==l.y){if(!this._isConstrained){var u=this._ghostProxyFunction(this._elementToDrag);Ve(u,Ut.ghostProxy),this._ghostProxyParent?(this._ghostProxyParent.appendChild(u),this._currentParentPosition=mt(this._elementToDrag.parentNode),this._ghostParentPosition=mt(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(u),this._dragEl=u,this._isConstrained=!0}l=a}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);ks(this._dragEl,{x:l.x+this._ghostDx,y:l.y+this._ghostDy}),this._dispatch(Ps,{el:this.el,pos:l,e:r,drag:this,size:this._size,originalPos:this._posAtDown})}},{key:"abort",value:function(){this._downAt!=null&&this._upListener()}},{key:"getDragElement",value:function(e){return e?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(e,t){if(t||this._moving){var r=[],a=Vt(this._dragEl);r.push([this._dragEl,a,this,this._size]),this._dispatch(As,{el:this._dragEl,pos:this._ghostProxyOffsets||a,finalPos:a,e,drag:this,selection:r,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(e,t){var r=null;if(this._activeSelectorParams&&this._activeSelectorParams[e])r=this._activeSelectorParams[e](t);else if(this.listeners[e])for(var a=0;a<this.listeners[e].length;a++)try{var l=this.listeners[e][a](t);l!=null&&(r=l)}catch{}return r}},{key:"resolveGrid",value:function(){var e={grid:null,thresholdX:wu/2,thresholdY:Iu/2};return this._activeSelectorParams!=null&&this._activeSelectorParams.grid!=null&&(e.grid=this._activeSelectorParams.grid,this._activeSelectorParams.snapThreshold!=null&&(e.thresholdX=this._activeSelectorParams.snapThreshold,e.thresholdY=this._activeSelectorParams.snapThreshold)),e}},{key:"toGrid",value:function(e){var t=this.resolveGrid(),r=t.grid,a=t.thresholdX,l=t.thresholdY;if(r==null)return e;var u=r?r.w/2:a,c=r?r.h/2:l;return Oo(e,r,u,c)}},{key:"setUseGhostProxy",value:function(e){this._useGhostProxy=e?Ii:Mu}},{key:"_doConstrain",value:function(e,t,r,a){return this._activeSelectorParams!=null&&this._activeSelectorParams.constrainFunction&&typeof this._activeSelectorParams.constrainFunction=="function"?this._activeSelectorParams.constrainFunction(e,t,r,a):e}},{key:"_testFilter",value:function(e){for(var t in this._filters){var r=this._filters[t],a=r[0](e);if(r[1]&&(a=!a),!a)return!1}return!0}},{key:"addFilter",value:function(e,t){var r=this;if(e){var a=bu(e);this._filters[a]=[function(l){var u=l.srcElement||l.target,c;return R(e)?c=Be(u,e,r.el):typeof e=="function"&&(c=e(l,r.el)),c},t!==!1]}}},{key:"removeFilter",value:function(e){var t=typeof e=="function"?e._katavorioId:e;delete this._filters[t]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(e,t){e.selector&&(t?this._availableSelectors.unshift(e):this._availableSelectors.push(e))}},{key:"destroy",value:function(){this.k.eventManager.off(this.el,Xe,this.downListener),this.k.eventManager.off(document,Ai,this.moveListener),this.k.eventManager.off(document,$e,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null}}]),n}(Lu),ju=["input","textarea","select","button","option"],Hu=ju.join(","),Bu=function(){function s(o){J(this,s),_(this,"eventManager",void 0),_(this,"zoom",1),_(this,"css",{}),_(this,"inputFilterSelector",void 0),o=o||{},this.inputFilterSelector=o.inputFilterSelector||Hu,this.eventManager=new Cs,this.zoom=o.zoom||1;var n=o.css||{};w(this.css,n)}return Z(s,[{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(n){this.zoom=n}},{key:"_prepareParams",value:function(n){n=n||{};var i={events:{}},e;for(e in n)i[e]=n[e];for(e=0;e<Mi.length;e++)i.events[Mi[e]]=n[Mi[e]]||Gu;return i}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(n){return this.inputFilterSelector=n,this}},{key:"draggable",value:function(n,i){if(n._katavorioDrag==null){var e=this._prepareParams(i),t=new Fu(n,e,this);return Ve(n,Ut.delegatedDraggable),n._katavorioDrag=t,t}else return n._katavorioDrag}},{key:"destroyDraggable",value:function(n){n._katavorioDrag&&(n._katavorioDrag.destroy(),delete n._katavorioDrag)}}]),s}(),Mn="jtk-drag-selected",Vu=function(){function s(o){J(this,s),this.instance=o,_(this,"_dragSelection",[]),_(this,"_dragSizes",new Map),_(this,"_dragElements",new Map),_(this,"_dragElementStartPositions",new Map),_(this,"_dragElementPositions",new Map),_(this,"__activeSet",void 0)}return Z(s,[{key:"_activeSet",get:function(){return this.__activeSet==null?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(n){var i=this;this.__activeSet=[],D(this._dragSelection,function(e){n(e)&&i.__activeSet.push(e)})}},{key:"clear",value:function(){var n=this;this.reset(),D(this._dragSelection,function(i){return n.instance.removeClass(i.jel,Mn)}),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var n=this;D(this._activeSet,function(i){var e={x:parseInt(""+i.jel.offsetLeft,10),y:parseInt(""+i.jel.offsetTop,10)};n._dragElementStartPositions.set(i.id,e),n._dragElementPositions.set(i.id,e),n._dragSizes.set(i.id,n.instance.getSize(i.jel))})}},{key:"updatePositions",value:function(n,i,e){var t=this,r=n.x-i.x,a=n.y-i.y;D(this._activeSet,function(l){var u=t._dragElementStartPositions.get(l.id);if(u){var c=u.x+r,h=u.y+a,f=t._dragSizes.get(l.id),v={x:c,y:h,w:f.w,h:f.h};if(l.jel._jsPlumbParentGroup&&l.jel._jsPlumbParentGroup.constrain){var g={w:l.jel.parentNode.offsetWidth+l.jel.parentNode.scrollLeft,h:l.jel.parentNode.offsetHeight+l.jel.parentNode.scrollTop};v.x=Math.max(v.x,0),v.y=Math.max(v.y,0),v.x=Math.min(v.x,g.w-f.w),v.y=Math.min(v.y,g.h-f.h)}t._dragElementPositions.set(l.id,{x:c,y:h}),l.jel.style.left=v.x+"px",l.jel.style.top=v.y+"px",e(l.jel,l.id,f,v)}})}},{key:"each",value:function(n){var i=this;D(this._activeSet,function(e){var t=i._dragSizes.get(e.id),r=i._dragElementPositions.get(e.id),a=i._dragElementStartPositions.get(e.id);n(e.jel,e.id,r,t,a)})}},{key:"add",value:function(n,i){var e=n;i=i||this.instance.getId(e);var t=Ee(this._dragSelection,function(r){return r.id===i});t===-1&&(this.instance.addClass(n,Mn),this._dragSelection.push({id:i,jel:e}))}},{key:"remove",value:function(n){var i=this,e=n;this._dragSelection=this._dragSelection.filter(function(t){var r=t.jel!==e;return r||i.instance.removeClass(t.jel,Mn),r})}},{key:"toggle",value:function(n){var i=n,e=Ee(this._dragSelection,function(t){return t.jel===i});e!==-1?this.remove(i):this.add(n)}}]),s}(),Uu="jtk-delegated-draggable",Yu="jtk-draggable",Xu="jtk-drag",$u="jtk-ghost-proxy",De="jtk-drag-active",Wu="jtk-dragged",Oe="jtk-drag-hover",qu=function(){function s(o,n,i){var e=this;J(this,s),this.instance=o,this.dragSelection=n,_(this,"collicat",void 0),_(this,"drag",void 0),_(this,"_draggables",{}),_(this,"_dlist",[]),_(this,"_elementsWithEndpoints",{}),_(this,"_draggablesForElements",{}),_(this,"handlers",[]),_(this,"_trackScroll",void 0),_(this,"_filtersToAdd",[]),this.collicat=new Bu({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:Uu,draggable:Yu,drag:Xu,selected:Mn,active:De,hover:Oe,ghostProxy:$u}}),this.instance.bind(xr,function(t){e.collicat.setZoom(t)}),i=i||{},this._trackScroll=i.trackScroll!==!1}return Z(s,[{key:"addHandler",value:function(n,i){var e=this,t=w({selector:n.selector},i||{});t.start=tn(t.start,function(l){return n.onStart(l)}),t.drag=tn(t.drag,function(l){return n.onDrag(l)}),t.stop=tn(t.stop,function(l){return n.onStop(l)});var r=(n.onBeforeStart||function(l){}).bind(n);if(t.beforeStart=tn(t.beforeStart,function(l){return r(l)}),t.dragInit=function(l){return n.onDragInit(l)},t.dragAbort=function(l){return n.onDragAbort(l)},n.useGhostProxy&&(t.useGhostProxy=n.useGhostProxy,t.makeGhostProxy=n.makeGhostProxy),t.constrainFunction==null&&t.containment!=null)switch(t.containment){case Yt.notNegative:{t.constrainFunction=function(l,u,c,h){return{x:Math.max(0,Math.min(l.x)),y:Math.max(0,Math.min(l.y))}};break}case Yt.parent:{var a=t.containmentPadding||5;t.constrainFunction=function(l,u,c,h){var f=l.x<0?0:l.x>c.w-a?c.w-a:l.x,v=l.y<0?0:l.y>c.h-a?c.h-a:l.y;return{x:f,y:v}};break}case Yt.parentEnclosed:{t.constrainFunction=function(l,u,c,h){var f=l.x<0?0:l.x+h.w>c.w?c.w-h.w:l.x,v=l.y<0?0:l.y+h.h>c.h?c.h-h.h:l.y;return{x:f,y:v}};break}}this.drag==null?(t.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),t),D(this._filtersToAdd,function(l){return e.drag.addFilter(l[0],l[1])}),this.drag.on(Pn,function(l){e.instance.revalidate(l)})):this.drag.addSelector(t),this.handlers.push({handler:n,options:t}),n.init(this.drag)}},{key:"addFilter",value:function(n,i){this.drag==null?this._filtersToAdd.push([n,i===!0]):this.drag.addFilter(n,i)}},{key:"removeFilter",value:function(n){this.drag!=null&&this.drag.removeFilter(n)}},{key:"setFilters",value:function(n){var i=this;D(n,function(e){i.drag.addFilter(e[0],e[1])})}},{key:"reset",value:function(){var n=[];if(D(this.handlers,function(t){t.handler.reset()}),this.drag!=null){var i=this.drag._filters;for(var e in i)n.push([e,i[e][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,n}},{key:"setOption",value:function(n,i){var e=Xn(this.handlers,function(t){return t.handler===n});e!=null&&w(e.options,i||{})}}]),s}();function Ku(s,o){return R(o)?{id:o,active:!0}:{id:s.getId(o),active:o.active}}function Ju(s,o){var n=$i(s.members,function(i){return i.el===o});return n!==null?n.active===!0:!1}function Zu(s){for(var o=[],n=s._jsPlumbParentGroup;n!=null;)o.push(n.el),n=n.group;return o}var Gi=function(){function s(o,n){J(this,s),this.instance=o,this._dragSelection=n,_(this,"selector","> "+U+":not("+st(dn)+")"),_(this,"_dragOffset",null),_(this,"_groupLocations",[]),_(this,"_intersectingGroups",[]),_(this,"_currentDragParentGroup",null),_(this,"_dragGroupByElementIdMap",{}),_(this,"_dragGroupMap",{}),_(this,"_currentDragGroup",null),_(this,"_currentDragGroupOffsets",new Map),_(this,"_currentDragGroupSizes",new Map),_(this,"_dragPayload",null),_(this,"drag",void 0),_(this,"originalPosition",void 0)}return Z(s,[{key:"onDragInit",value:function(n){return null}},{key:"onDragAbort",value:function(n){return null}},{key:"getDropGroup",value:function(){var n=null;if(this._intersectingGroups.length>0){var i=this._intersectingGroups[0].groupLoc.group,e=this._intersectingGroups[0].intersectingElement,t=e._jsPlumbParentGroup;t!==i&&(t==null||!t.overrideDrop(e,i))&&(n=this._intersectingGroups[0])}return n}},{key:"onStop",value:function(n){var i=this,e=n.drag.getDragElement(),t=this.getDropGroup(),r=[];if(r.push({el:e,id:this.instance.getId(e),pos:n.finalPos,originalGroup:e._jsPlumbParentGroup,redrawResult:null,originalPos:n.originalPos,reverted:!1,dropGroup:t!=null?t.groupLoc.group:null}),this._dragSelection.each(function(f,v,g,E,y){if(f!==n.el){var m={x:g.x,y:g.y},C=m.x,k=m.y;if(f._jsPlumbParentGroup&&f._jsPlumbParentGroup.constrain){var b={w:f.parentNode.offsetWidth+f.parentNode.scrollLeft,h:f.parentNode.offsetHeight+f.parentNode.scrollTop};C=Math.max(C,0),k=Math.max(k,0),C=Math.min(C,b.w-E.w),k=Math.min(k,b.h-E.h),m.x=C,m.y=k}r.push({el:f,id:v,pos:m,originalPos:y,originalGroup:f._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:t!=null?t.groupLoc.group:null})}}),D(r,function(f){var v=f.originalGroup!=null,g=v&&Ss(i.instance,f.el,f.pos),E={x:0,y:0};if(v&&!g){if(t==null){var y=i._pruneOrOrphan(f,!0,!0);y.pos!=null?f.pos=y.pos.pos:!y.pruned&&f.originalGroup.revert&&(f.pos=f.originalPos,f.reverted=!0)}}else v&&g&&(E=i.instance.viewport.getPosition(f.originalGroup.elId));t!=null&&!g?i.instance.groupManager.addToGroup(t.groupLoc.group,!1,f.el):f.dropGroup=null,f.reverted&&i.instance.setPosition(f.el,f.pos),f.redrawResult=i.instance.setElementPosition(f.el,f.pos.x+E.x,f.pos.y+E.y),i.instance.removeClass(f.el,Wu),i.instance.select({source:f.el}).removeClass(i.instance.elementDraggingClass+" "+i.instance.sourceElementDraggingClass,!0),i.instance.select({target:f.el}).removeClass(i.instance.elementDraggingClass+" "+i.instance.targetElementDraggingClass,!0)}),r[0].originalGroup!=null){var a=e._jsPlumbParentGroup;if(a!==r[0].originalGroup){var l=n.drag.getDragElement(!0);if(r[0].originalGroup.ghost){var u=this.instance.getOffset(this.instance.getGroupContentArea(a)),c=this.instance.getOffset(this.instance.getGroupContentArea(r[0].originalGroup)),h={x:c.x+n.pos.x-u.x,y:c.y+n.pos.y-u.y};l.style.left=h.x+"px",l.style.top=h.y+"px",this.instance.revalidate(l)}}}this.instance.fire(Yl,{elements:r,e:n.e,el:e,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var n=this;D(this._groupLocations,function(i){n.instance.removeClass(i.el,De),n.instance.removeClass(i.el,Oe)}),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(n){this.drag=n}},{key:"onDrag",value:function(n){var i=this,e=n.drag.getDragElement(),t=n.pos,r=this.instance.getSize(e),a={x:t.x,y:t.y};this._intersectingGroups.length=0,this._dragOffset!=null&&(a.x+=this._dragOffset.x,a.y+=this._dragOffset.y);var l=function(h,f,v){if(v){var g=new Set;D(i._groupLocations,function(E){!g.has(E.group.id)&&er(f,E.r)?(E.group!==i._currentDragParentGroup&&i.instance.addClass(E.el,Oe),i._intersectingGroups.push({groupLoc:E,intersectingElement:n.drag.getDragElement(!0),d:0}),D(i.instance.groupManager.getAncestors(E.group),function(y){return g.add(y.id)})):i.instance.removeClass(E.el,Oe)})}i.instance.setElementPosition(h,f.x,f.y),i.instance.fire(Ul,{el:h,e:n.e,pos:{x:f.x,y:f.y},originalPosition:i.originalPosition,payload:i._dragPayload})},u={x:a.x,y:a.y,w:r.w,h:r.h};l(e,u,!0),this._dragSelection.updatePositions(t,this.originalPosition,function(c,h,f,v){l(c,v,!1)}),this._currentDragGroupOffsets.forEach(function(c,h){var f=i._currentDragGroupSizes.get(h),v={x:u.x+c[0].x,y:u.y+c[0].y,w:f.w,h:f.h};c[1].style.left=v.x+"px",c[1].style.top=v.y+"px",l(c[1],v,!1)})}},{key:"onStart",value:function(n){var i=this,e=n.drag.getDragElement(),t=this.instance.getOffset(e);this.originalPosition={x:n.pos.x,y:n.pos.y},e._jsPlumbParentGroup&&(this._dragOffset=this.instance.getOffset(e.offsetParent),this._currentDragParentGroup=e._jsPlumbParentGroup);var r=!0,a=e.getAttribute(cn);if((this.instance.elementsDraggable===!1||a!=null&&a!==tt)&&(r=!1),r){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var l=n.drag.getDragElement(!0),u=l.querySelectorAll(U),c=Zu(l),h=[];Array.prototype.push.apply(h,u),Array.prototype.push.apply(h,c),this._dragSelection.filterActiveSet(function(E){return h.indexOf(E.jel)===-1}),this._dragSelection.initialisePositions();var f=function(y){if(!y._isJsPlumbGroup||i.instance.allowNestedGroups){var m=!y._jsPlumbParentGroup,C=m||y._jsPlumbParentGroup.dropOverride!==!0,k=!m&&(y._jsPlumbParentGroup.ghost||y._jsPlumbParentGroup.constrain!==!0);(m||C&&k)&&(D(i.instance.groupManager.getGroups(),function(b){var A=y._jsPlumbGroup;if(b.droppable!==!1&&b.enabled!==!1&&y._jsPlumbGroup!==b&&!i.instance.groupManager.isDescendant(b,A)){var O=b.el,T=i.instance.getSize(O),S=i.instance.getOffset(O),I={x:S.x,y:S.y,w:T.w,h:T.h},M={el:O,r:I,group:b};i._groupLocations.push(M),b!==i._currentDragParentGroup&&i.instance.addClass(O,De)}}),i._groupLocations.sort(function(b,A){return i.instance.groupManager.isDescendant(b.group,A.group)?-1:i.instance.groupManager.isAncestor(A.group,b.group)?1:0}))}return i.instance.select({source:y}).addClass(i.instance.elementDraggingClass+" "+i.instance.sourceElementDraggingClass,!0),i.instance.select({target:y}).addClass(i.instance.elementDraggingClass+" "+i.instance.targetElementDraggingClass,!0),i.instance.fire(Xl,{el:y,e:n.e,originalPosition:i.originalPosition,pos:i.originalPosition})},v=this.instance.getId(e);this._currentDragGroup=this._dragGroupByElementIdMap[v],this._currentDragGroup&&!Ju(this._currentDragGroup,e)&&(this._currentDragGroup=null);var g=f(e);if(g===!1)return this._cleanup(),!1;this._dragPayload=g,this._currentDragGroup!=null&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach(function(E){var y=i.instance.getOffset(E.el);i._currentDragGroupOffsets.set(E.elId,[{x:y.x-t.x,y:y.y-t.y},E.el]),i._currentDragGroupSizes.set(E.elId,i.instance.getSize(E.el)),f(E.el)}))}return r}},{key:"addToDragGroup",value:function(n){var i=this,e=Ku(this.instance,n),t=this._dragGroupMap[e.id];t==null&&(t={id:e.id,members:new Set},this._dragGroupMap[e.id]=t);for(var r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];this.removeFromDragGroup.apply(this,a),D(a,function(u){var c=i.instance.getId(u);t.members.add({elId:c,el:u,active:e.active}),i._dragGroupByElementIdMap[c]=t})}},{key:"removeFromDragGroup",value:function(){for(var n=this,i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];D(e,function(r){var a=n.instance.getId(r),l=n._dragGroupByElementIdMap[a];if(l!=null){var u=new Set;l.members.forEach(function(c){c.el!==r&&u.add(c)}),l.members=u,delete n._dragGroupByElementIdMap[a]}})}},{key:"setDragGroupState",value:function(n){for(var i=this,e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];var a=t.map(function(l){return i.instance.getId(l)});D(a,function(l){var u=i._dragGroupByElementIdMap[l];if(u!=null){var c=$i(u.members,function(h){return h.elId===l});c!=null&&(c.active=n)}})}},{key:"_pruneOrOrphan",value:function(n,i,e){var t=n.el,r={pruned:!1,pos:null};if(e||!Ss(this.instance,t,n.pos)){var a=t._jsPlumbParentGroup;a.prune?(t._isJsPlumbGroup?this.instance.removeGroup(t._jsPlumbGroup):a.remove(n.el,!0),r.pruned=!0):a.orphan&&(r.pos=this.instance.groupManager.orphan(n.el,i),t._isJsPlumbGroup?a.removeGroup(t._jsPlumbGroup):a.remove(n.el))}return r}}]),s}();function zu(s,o,n,i,e,t){var r=qa(e,i),a={paintStyle:s,preparedAnchor:r,element:i,scope:t};o!=null&&(Ji(o,it)?a.existingEndpoint=o:a.endpoint=o);var l=e._internal_newEndpoint(a);return e.paintEndpoint(l,{}),l}function Qu(s,o,n,i,e){for(var t=s.target||s.srcElement,r=!1,a=i.getSelector(o,n),l=0;l<a.length;l++)if(a[l]===t){r=!0;break}return e?!r:r}var ec=st(De,Oe),Os=function(){function s(o){J(this,s),this.instance=o,_(this,"jpc",void 0),_(this,"existingJpc",void 0),_(this,"_originalAnchor",void 0),_(this,"ep",void 0),_(this,"endpointRepresentation",void 0),_(this,"canvasElement",void 0),_(this,"_activeDefinition",void 0),_(this,"placeholderInfo",{id:null,element:null}),_(this,"floatingIndex",void 0),_(this,"floatingId",void 0),_(this,"floatingElement",void 0),_(this,"floatingEndpoint",void 0),_(this,"floatingAnchor",void 0),_(this,"_stopped",void 0),_(this,"inPlaceCopy",void 0),_(this,"endpointDropTargets",[]),_(this,"currentDropTarget",null),_(this,"payload",void 0),_(this,"floatingConnections",{}),_(this,"_forceReattach",void 0),_(this,"_forceDetach",void 0),_(this,"mousedownHandler",void 0),_(this,"mouseupHandler",void 0),_(this,"selector",st(Dt));var n=o.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),o.on(n,Xe,U,this.mousedownHandler),o.on(n,$e,U,this.mouseupHandler)}return Z(s,[{key:"_resolveDragParent",value:function(n,i){var e=this.instance.getContainer(),t=pe(i,U,e,!0);if(n.parentSelector!=null){var r=pe(i,n.parentSelector,e,!0);return r!=null&&(t=pe(r.parentNode,U,e,!1)),r||t}else return t}},{key:"_mousedownHandler",value:function(n){var i,e;if(!(n.which===3||n.button===2)){var t=n.target||n.srcElement;if(e=this._getSourceDefinition(n),!(e!=null&&(i=this._resolveDragParent(e.def,t),i==null||i.getAttribute(Tn)===tt))&&e){var r=n.currentTarget,a;if(t.getAttribute(Tn)!==tt){yt(n),this._activeDefinition=e,a=e.def;var l=this.instance.select({source:i}).length;if(e.maxConnections>=0&&l>=e.maxConnections)return yt(n),a.onMaxConnections&&a.onMaxConnections({element:i,maxConnections:e.maxConnections},n),n.stopImmediatePropagation&&n.stopImmediatePropagation(),!1;var u=rc(n,i,this.instance.currentZoom),c={element:i};if(w(c,a),c.isTemporarySource=!0,a.scope)c.scope=a.scope;else{var h=t.getAttribute(Si);h!=null&&(c.scope=h)}var f=a.parameterExtractor?a.parameterExtractor(i,t):{};c=zt(c,f),this._originalAnchor=c.anchor||this.instance.defaults.anchor,c.anchor=[u.x,u.y,0,0],c.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(c);var v={};if(a.extract){for(var g in a.extract){var E=t.getAttribute(g);E&&(v[a.extract[g]]=E)}this.ep.mergeParameters(v)}a.uniqueEndpoint&&(e.endpoint?this.ep.finalEndpoint=e.endpoint:(e.endpoint=this.ep,this.ep.deleteOnEmpty=!1)),r._jsPlumbOrphanedEndpoints=r._jsPlumbOrphanedEndpoints||[],r._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,Xe,n,v)}}}}},{key:"_mouseupHandler",value:function(n){var i=n.currentTarget||n.srcElement;i._jsPlumbOrphanedEndpoints&&(_o(i._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),i._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(n){var i=this.instance.getOffset(n),e=this.instance.getSize(n);return this._makeDraggablePlaceholder(i,e),this.placeholderInfo.element.jtk=n.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(n){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(n,i){this.placeholderInfo=this.placeholderInfo||{};var e=mi(bi,{position:"absolute"});this.instance._appendElement(e,this.instance.getContainer());var t=this.instance.getId(e);return this.instance.setPosition(e,n),e.style.width=i.w+"px",e.style.height=i.h+"px",this.instance.manage(e),this.placeholderInfo.id=t,this.placeholderInfo.element=e,e}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var n=this.instance.getContainer();this.instance.off(n,$e,this.mouseupHandler),this.instance.off(n,Xe,this.mousedownHandler)}},{key:"init",value:function(n){}},{key:"startNewConnectionDrag",value:function(n,i){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:n,data:i}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.floatingEndpoint.addClass(this.instance.draggingClass),this.instance.fire(ds,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var n=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.floatingEndpoint.addClass(this.instance.draggingClass),this.instance.fire(ds,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[n].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,n),this.jpc.suspendedEndpoint=this.jpc.endpoints[n],this.jpc.suspendedElement=this.jpc.endpoints[n].element,this.jpc.suspendedElementId=this.jpc.endpoints[n].elementId,this.jpc.suspendedElementType=n===0?hr:dr,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[n]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=n}},{key:"_shouldStartDrag",value:function(){var n=!0;this.ep.enabled||(n=!1),this.jpc==null&&!this.ep.isSource&&!this.ep.isTemporarySource&&(n=!1),this.ep.isSource&&this.ep.isFull()&&!(this.jpc!=null&&this.ep.dragAllowedWhenFull)&&(n=!1),this.jpc!=null&&!this.jpc.isDetachable(this.ep)&&(this.ep.isFull()?n=!1:this.jpc=null);var i={},e=this.instance.checkCondition(this.jpc==null?_a:Ea,{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return e===!1?n=!1:gt(e)==="object"?(i=e,w(i,this.payload||{})):i=this.payload||{},[n,i]}},{key:"_createFloatingEndpoint",value:function(n){var i=this.ep.endpoint;if(this.ep.edgeType!=null){var e=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType);i=e.endpoints[1]}this.floatingEndpoint=zu(this.ep.getPaintStyle(),i,n,this.placeholderInfo.element,this.instance,this.ep.scope),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(n){var i=this,e=this.jpc&&this.jpc.endpoints[0]===this.ep,t,r=this.instance.getContainer().querySelectorAll([".",Dt,"[",gr,this.ep.scope,"]"].join(""));if(D(r,function(c){if((i.jpc!=null||c!==n)&&c!==i.floatingElement&&(e&&c.jtk.endpoint.isSource||!e&&c.jtk.endpoint.isTarget)){var h=i.instance.getOffset(c),f=i.instance.getSize(c);t={x:h.x,y:h.y,w:f.w,h:f.h},i.endpointDropTargets.push({el:c,targetEl:c,r:t,endpoint:c.jtk.endpoint,def:null}),i.instance.addClass(c,De)}}),e){var a=Xn(this.instance.sourceSelectors,function(c){return c.isEnabled()&&(c.def.def.scope==null||c.def.def.scope===i.ep.scope)});if(a!=null){var l=this.instance.getContainer().querySelectorAll(a.redrop===hl?U:a.selector);D(l,function(c){if(c.getAttribute(Tn)!==tt){var h=c.getAttribute(Si);if(h!=null&&h!==i.ep.scope)return;var f={r:null,el:c};f.targetEl=pe(c,U,i.instance.getContainer(),!0);var v=i.instance.getOffset(f.el),g=i.instance.getSize(f.el);f.r={x:v.x,y:v.y,w:g.w,h:g.h},a.def.def.rank!=null&&(f.rank=a.def.def.rank),f.def=a,i.endpointDropTargets.push(f),i.instance.addClass(f.targetEl,De)}})}}else{var u=go(this.instance.targetSelectors,function(c){return c.isEnabled()});u.forEach(function(c){var h=i.instance.getContainer().querySelectorAll(c.selector);D(h,function(f){if(f.getAttribute(Tn)!==tt){var v=f.getAttribute(Si);if(v!=null&&v!==i.ep.scope)return;var g={r:null,el:f};if(c.def.def.parentSelector!=null&&(g.targetEl=pe(f,c.def.def.parentSelector,i.instance.getContainer(),!0)),g.targetEl==null&&(g.targetEl=pe(f,U,i.instance.getContainer(),!0)),(c.def.def.allowLoopback===!1||i._activeDefinition&&i._activeDefinition.def.allowLoopback===!1)&&g.targetEl===i.ep.element)return;var E=i.instance.getOffset(f),y=i.instance.getSize(f);g.r={x:E.x,y:E.y,w:y.w,h:y.h},g.def=c.def,c.def.def.rank!=null&&(g.rank=c.def.def.rank),i.endpointDropTargets.push(g),i.instance.addClass(g.targetEl,De)}})})}this.endpointDropTargets.sort(function(c,h){if(c.targetEl._isJsPlumbGroup&&!h.targetEl._isJsPlumbGroup)return 1;if(!c.targetEl._isJsPlumbGroup&&h.targetEl._isJsPlumbGroup)return-1;if(c.targetEl._isJsPlumbGroup&&h.targetEl._isJsPlumbGroup){if(i.instance.groupManager.isAncestor(c.targetEl._jsPlumbGroup,h.targetEl._jsPlumbGroup))return-1;if(i.instance.groupManager.isAncestor(h.targetEl._jsPlumbGroup,c.targetEl._jsPlumbGroup))return 1}else if(c.rank!=null&&h.rank!=null){if(c.rank>h.rank)return-1;if(c.rank<h.rank)return 1}else return 0})}},{key:"onStart",value:function(n){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var i=n.drag.getDragElement();if(this.ep=i.jtk.endpoint,!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var e=this._shouldStartDrag(),t=Pl(e,2),r=t[0],a=t[1];if(r===!1)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement),this.jpc==null?this.startNewConnectionDrag(this.ep.scope,a):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc,this.floatingEndpoint),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(n){this.payload=n.e.payload||{}}},{key:"onDrag",value:function(n){if(this._stopped)return!0;if(this.placeholderInfo.element){var i=this.instance.getSize(this.floatingElement);this.instance.setElementPosition(this.placeholderInfo.element,n.pos.x,n.pos.y);for(var e={x:n.pos.x,y:n.pos.y,w:i.w,h:i.h},t,r,a,l=0;l<this.endpointDropTargets.length;l++)if(er(e,this.endpointDropTargets[l].r)){t=this.endpointDropTargets[l];break}if(t!==this.currentDropTarget&&this.currentDropTarget!=null&&(r=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,Oe),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),t!=null&&(this.instance.addClass(t.el,Oe),r=this._getFloatingAnchorIndex(),t.endpoint!=null))if(a=t.endpoint.isSource&&r===0||t.endpoint.isTarget&&r!==0||this.jpc.suspendedEndpoint&&t.endpoint.referenceEndpoint&&t.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id,a){var u=this.instance.checkCondition(Ko,{sourceEndpoint:this.jpc.endpoints[r],targetEndpoint:t.endpoint.endpoint,connection:this.jpc});u?(t.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),t.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(t.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),t.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(t.endpoint)}else t=null;this.currentDropTarget=t}}},{key:"_maybeCleanup",value:function(n){n._mtNew&&n.connections.length===0?this.instance.deleteEndpoint(n):delete n._mtNew}},{key:"_reattachOrDiscard",value:function(n){var i=this.jpc.suspendedEndpoint!=null,e=this._getFloatingAnchorIndex();return i&&this._shouldReattach(n)?(e===0?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(e),!0):(this._discard(e,n),!1)}},{key:"onStop",value:function(n){var i=this,e=n.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var t=$o(Oe,De),r=this.instance.getContainer().querySelectorAll(ec);if(D(r,function(f){i.instance.removeClass(f,t)}),this.jpc&&this.jpc.endpoints!=null){var a=this.jpc.suspendedEndpoint!=null,l=this._getFloatingAnchorIndex(),u=this.jpc.suspendedEndpoint,c;if(this.currentDropTarget!=null)if(c=this._getDropEndpoint(n,this.jpc),c==null)this._reattachOrDiscard(n.e);else if(u&&u.id===c.id)this._doForceReattach(l);else if(!c.enabled)this._reattachOrDiscard(n.e);else if(c.isFull())c.fire(Cr,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},e),this._reattachOrDiscard(n.e);else{l===0?(this.jpc.source=c.element,this.jpc.sourceId=c.elementId):(this.jpc.target=c.element,this.jpc.targetId=c.elementId);var h=!0;a&&this.jpc.suspendedEndpoint.id!==c.id&&(!this.jpc.isDetachAllowed(this.jpc)||!this.jpc.endpoints[l].isDetachAllowed(this.jpc)||!this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)||!this.instance.checkCondition("beforeDetach",this.jpc))&&(h=!1),h=h&&c.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,c),h?this._drop(c,l,e,h):this._reattachOrDiscard(n.e)}else this._reattachOrDiscard(n.e);this.instance.refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,c!=null&&this._maybeCleanup(c)}}},{key:"_getSourceDefinition",value:function(n){for(var i,e=0;e<this.instance.sourceSelectors.length;e++)if(i=this.instance.sourceSelectors[e],i.isEnabled()){var t=Qu(n,this.instance.getContainer(),i.selector,this.instance,i.exclude);if(t!==!1)return i.def}}},{key:"_getDropEndpoint",value:function(n,i){var e;if(this.currentDropTarget.endpoint==null){var t=this.currentDropTarget.def,r=n.e.target||n.e.srcElement;if(t==null)return null;var a=this.instance._deriveEndpointAndAnchorSpec(i.getType().join(" "),!0),l=a.endpoints?w(n,{endpoint:t.def.endpoint||a.endpoints[1]}):n;a.anchors&&(l=w(l,{anchor:t.def.anchor||a.anchors[1]})),t.def.portId!=null&&(l.portId=t.def.portId);var u=t.def.parameterExtractor?t.def.parameterExtractor(this.currentDropTarget.el,r):{};if(l=zt(l,u),l.element=this.currentDropTarget.targetEl,e=this.instance._internal_newEndpoint(l),e._mtNew=!0,e.deleteOnEmpty=!0,t.def.parameters&&e.mergeParameters(t.def.parameters),t.def.extract){var c={};for(var h in t.def.extract){var f=this.currentDropTarget.el.getAttribute(h);f&&(c[t.def.extract[h]]=f)}e.mergeParameters(c)}}else e=this.currentDropTarget.endpoint;return e&&(e.removeClass(this.instance.endpointDropAllowedClass),e.removeClass(this.instance.endpointDropForbiddenClass)),e}},{key:"_doForceReattach",value:function(n){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[n]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,n),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(n){return this.jpc.isReattach()||this.jpc._forceReattach||!Xi(!0,!1,[[this.jpc.endpoints[0],at,[this.jpc]],[this.jpc.endpoints[1],at,[this.jpc]],[this.jpc,at,[this.jpc]],[this.instance,yr,[kr,this.jpc]]])}},{key:"_discard",value:function(n,i){this.jpc.pending?this.instance.fire($l,this.jpc,i):(n===0?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[n]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:i,force:!0})}},{key:"_drop",value:function(n,i,e,t){if(this.jpc.endpoints[i].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[i]=n,n.addConnection(this.jpc),this.jpc.suspendedEndpoint){var r=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:i,originalSourceId:i===0?r:this.jpc.sourceId,newSourceId:i===0?n.elementId:this.jpc.sourceId,originalTargetId:i===1?r:this.jpc.targetId,newTargetId:i===1?n.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:n},e)}if(i===1?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint){var a=this.jpc.endpoints[0];a.detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc)}Ze(t)&&this.jpc.mergeData(t),this._originalAnchor&&(this.jpc.endpoints[0].setAnchor(this._originalAnchor),this._originalAnchor=null),this.instance._finaliseConnection(this.jpc,null,e),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(n,i,e){this.floatingConnections[n.id]=i,$n(this.instance.endpointsByElement,n.id,e)}},{key:"_getFloatingAnchorIndex",value:function(){return this.floatingIndex==null?1:this.floatingIndex}}]),s}(),ws=function(s){kn(n,s);var o=Sn(n);function n(i,e){var t;return J(this,n),t=o.call(this,i,e),t.instance=i,t.dragSelection=e,_(x(t),"selector",[">",ou,U].join(" ")),_(x(t),"doRevalidate",void 0),t.doRevalidate=t._revalidate.bind(x(t)),t}return Z(n,[{key:"reset",value:function(){this.drag.off(Pn,this.doRevalidate)}},{key:"_revalidate",value:function(e){this.instance.revalidate(e)}},{key:"init",value:function(e){this.drag=e,e.on(Pn,this.doRevalidate)}},{key:"useGhostProxy",value:function(e,t){var r=t._jsPlumbParentGroup;return r==null?!1:r.ghost===!0}},{key:"makeGhostProxy",value:function(e){var t=e,r=t.cloneNode(!0);return r._jsPlumbParentGroup=t._jsPlumbParentGroup,r}}]),n}(Gi),Ni=function(){function s(o,n){J(this,s),this.instance=o,this.overlay=n,_(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=n}return Z(s,null,[{key:"createElement",value:function(n){var i=mi(bi,{},n.instance.overlayClass+" "+(n.cssClass?n.cssClass:""));return n.instance.setAttribute(i,"jtk-overlay-id",n.id),i}},{key:"getElement",value:function(n,i,e){if(n.canvas==null){e&&i?n.canvas=e(i):n.canvas=s.createElement(n),n.canvas.style.position=ot,n.instance._appendElement(n.canvas,n.instance.getContainer()),n.instance.getId(n.canvas);var t="translate(-50%, -50%)";n.canvas.style.webkitTransform=t,n.canvas.style.mozTransform=t,n.canvas.style.msTransform=t,n.canvas.style.oTransform=t,n.canvas.style.transform=t,n.isVisible()||(n.canvas.style.display=Re),n.canvas.jtk={overlay:n}}return n.canvas}},{key:"destroy",value:function(n){n.canvas&&n.canvas.parentNode&&n.canvas.parentNode.removeChild(n.canvas),delete n.canvas,delete n.cachedDimensions}},{key:"_getDimensions",value:function(n,i){return(n.cachedDimensions==null||i)&&(n.cachedDimensions={w:1,h:1}),n.cachedDimensions}}]),s}(),xt=function(s){kn(n,s);var o=Sn(n);function n(){var i;J(this,n);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return i=o.call.apply(o,[this].concat(t)),_(x(i),"path",void 0),i}return Z(n,null,[{key:"ensurePath",value:function(e){if(e.path==null){e.path=ye(Ci,{"jtk-overlay-id":e.id});var t=null;if(e.component instanceof Gt){var r=e.component.connector;t=r!=null?r.canvas:null}else if(e.component instanceof yn){var a=e.component.endpoint;t=a!=null?a.svg:a}t!=null&&bn(t,e.path,1),e.instance.addClass(e.path,e.instance.overlayClass),e.path.jtk={overlay:e}}return e.path}},{key:"paint",value:function(e,t,r,a){this.ensurePath(e);var l=[0,0];a.xmin<0&&(l[0]=-a.xmin),a.ymin<0&&(l[1]=-a.ymin);var u={d:t,stroke:r.stroke?r.stroke:null,fill:r.fill?r.fill:null,transform:"translate("+l[0]+","+l[1]+")","pointer-events":"visibleStroke"};ge(e.path,u)}},{key:"destroy",value:function(e,t){var r=e;r.path!=null&&r.path.parentNode!=null&&r.path.parentNode.removeChild(r.path),r.bgPath!=null&&r.bgPath.parentNode!=null&&r.bgPath.parentNode.removeChild(r.bgPath),delete r.path,delete r.bgPath}}]),n}(fn),Is=function(){function s(){J(this,s)}return Z(s,null,[{key:"paint",value:function(n,i,e,t){if(e!=null){var r=[n.x,n.y],a=[n.w,n.h],l;t!=null&&(t.xmin<0&&(r[0]+=t.xmin),t.ymin<0&&(r[1]+=t.ymin),a[0]=t.xmax+(t.xmin<0?-t.xmin:0),a[1]=t.ymax+(t.ymin<0?-t.ymin:0)),isFinite(a[0])&&isFinite(a[1])&&(i?(us(n.canvas,r[0],r[1],a[0],a[1]),r[0]=0,r[1]=0,l=xi([0,0]),ge(n.svg,{style:l,width:""+(a[0]||0),height:""+(a[1]||0)})):(l=xi([r[0],r[1]]),ge(n.canvas,{style:l,width:""+(a[0]||0),height:""+(a[1]||0)})))}}}]),s}();function tc(s,o,n,i){nc(s,o),Is.paint(o,!1,n,i);var e="",t=[0,0];if(i.xmin<0&&(t[0]=-i.xmin),i.ymin<0&&(t[1]=-i.ymin),o.segments.length>0){e=s.getPathData(o);var r={d:e,transform:"translate("+t[0]+","+t[1]+")","pointer-events":"visibleStroke"},a=null;if(n.outlineStroke){var l=n.outlineWidth||1,u=n.strokeWidth+2*l;a=w({},n),a.stroke=n.outlineStroke,a.strokeWidth=u,o.bgPath==null?(o.bgPath=ye(Ci,r),s.addClass(o.bgPath,s.connectorOutlineClass),bn(o.canvas,o.bgPath,0)):ge(o.bgPath,r),ki(o.canvas,o.bgPath,a)}var c=o;c.path==null?(c.path=ye(Ci,r),bn(c.canvas,c.path,n.outlineStroke?1:0)):(c.path.parentNode!==c.canvas&&bn(c.canvas,c.path,n.outlineStroke?1:0),ge(o.path,r)),ki(o.canvas,o.path,n)}}function nc(s,o){if(o.canvas!=null)return o.canvas;var n=ye(as,{style:"",width:"0",height:"0","pointer-events":Re,position:ot});return o.canvas=n,s._appendElement(o.canvas,s.getContainer()),o.cssClass!=null&&s.addClass(n,o.cssClass),s.addClass(n,s.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=o,n}var ic=function(){function s(){J(this,s)}return Z(s,null,[{key:"getEndpointElement",value:function(n){if(n.canvas!=null)return n.canvas;var i=ye(as,{style:"",width:"0",height:"0","pointer-events":Re,position:ot});n.svg=i;var e=mi(bi,{position:ot});n.canvas=e;var t=n.classes.join(" ");n.instance.addClass(e,t);for(var r=n.endpoint.scope.split(/\s/),a=0;a<r.length;a++)n.instance.setAttribute(e,gr+r[a],rr);return n.instance._suspendDrawing||us(e,0,0,1,1),n.instance._appendElement(e,n.instance.getContainer()),e.appendChild(i),n.cssClass!=null&&n.instance.addClass(e,n.cssClass),n.instance.addClass(e,n.instance.endpointClass),e.jtk=e.jtk||{},e.jtk.endpoint=n.endpoint,e.style.display=n.endpoint.visible!==!1?ii:Re,e}},{key:"paint",value:function(n,i,e){this.getEndpointElement(n),Is.paint(n,!0,e);var t=w({},e);t.outlineStroke&&(t.stroke=t.outlineStroke),n.node==null?(n.node=i.makeNode(n,t),n.svg.appendChild(n.node)):i.updateNode!=null&&i.updateNode(n,n.node),ki(n.canvas,n.node,t)}}]),s}(),Ms={};function Li(s,o){Ms[s]=o}function rc(s,o,n){var i=o,e=gt(o.getBoundingClientRect)!==ir?o.getBoundingClientRect():{left:0,top:0,width:0,height:0},t=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||t.scrollTop,l=window.pageXOffset||r.scrollLeft||t.scrollLeft,u=r.clientTop||t.clientTop||0,c=r.clientLeft||t.clientLeft||0,h=0,f=0,v=e.top+a-u+h*n,g=e.left+l-c+f*n,E=Dn(s),y=e.width||i.offsetWidth*n,m=e.height||i.offsetHeight*n,C=(E.x-g)/y,k=(E.y-v)/m;return{x:C,y:k}}function kt(s){return hi(s)||vi(s)||fi(s)}function Gs(s,o){s.canvas&&(s.canvas.style.display=o?"block":"none")}function Ns(s){s.canvas&&s.canvas.parentNode.removeChild(s.canvas),delete s.canvas,delete s.svg}function Xt(s){return s.canvas}function he(s){return Ni.getElement(s)}function We(s){return Ni.getElement(s,s.component,function(o){var n=s.create(o);return s.instance.addClass(n,s.instance.overlayClass),n})}function sc(s,o,n,i){var e=s.x,t=s.y;return o._jsPlumbParentGroup&&o._jsPlumbParentGroup.constrain&&(e=Math.max(s.x,0),t=Math.max(s.y,0),e=Math.min(e,n.w-i.w),t=Math.min(t,n.h-i.h)),{x:e,y:t}}var oc=function(s){kn(n,s);var o=Sn(n);function n(i,e){var t;J(this,n),t=o.call(this,i,e),t._instanceIndex=i,_(x(t),"dragSelection",void 0),_(x(t),"dragManager",void 0),_(x(t),"_connectorClick",void 0),_(x(t),"_connectorDblClick",void 0),_(x(t),"_connectorTap",void 0),_(x(t),"_connectorDblTap",void 0),_(x(t),"_endpointClick",void 0),_(x(t),"_endpointDblClick",void 0),_(x(t),"_overlayClick",void 0),_(x(t),"_overlayDblClick",void 0),_(x(t),"_overlayTap",void 0),_(x(t),"_overlayDblTap",void 0),_(x(t),"_connectorMouseover",void 0),_(x(t),"_connectorMouseout",void 0),_(x(t),"_endpointMouseover",void 0),_(x(t),"_endpointMouseout",void 0),_(x(t),"_overlayMouseover",void 0),_(x(t),"_overlayMouseout",void 0),_(x(t),"_elementClick",void 0),_(x(t),"_elementTap",void 0),_(x(t),"_elementDblTap",void 0),_(x(t),"_elementMouseenter",void 0),_(x(t),"_elementMouseexit",void 0),_(x(t),"eventManager",void 0),_(x(t),"draggingClass","jtk-dragging"),_(x(t),"elementDraggingClass","jtk-element-dragging"),_(x(t),"hoverClass","jtk-hover"),_(x(t),"sourceElementDraggingClass","jtk-source-element-dragging"),_(x(t),"targetElementDraggingClass","jtk-target-element-dragging"),_(x(t),"hoverSourceClass","jtk-source-hover"),_(x(t),"hoverTargetClass","jtk-target-hover"),_(x(t),"dragSelectClass","jtk-drag-select"),_(x(t),"managedElementsSelector",void 0),_(x(t),"elementsDraggable",void 0),_(x(t),"elementDragHandler",void 0),_(x(t),"groupDragOptions",void 0),_(x(t),"elementDragOptions",void 0),_(x(t),"svg",{node:function(m,C){return ye(m,C)},attr:function(m,C){return ge(m,C)},pos:function(m){return xi(m)}}),t.elementsDraggable=e&&e.elementsDraggable!==!1,t.managedElementsSelector=e&&e.managedElementsSelector||U,t.eventManager=new Cs,t.dragSelection=new Vu(x(t)),t.dragManager=new qu(x(t),t.dragSelection,e&&e.dragOptions?e.dragOptions:null),t.dragManager.addHandler(new Os(x(t))),t.groupDragOptions={constrainFunction:sc},t.dragManager.addHandler(new ws(x(t),t.dragSelection),t.groupDragOptions),t.elementDragHandler=new Gi(x(t),t.dragSelection),t.elementDragOptions=e&&e.dragOptions||{},t.dragManager.addHandler(t.elementDragHandler,t.elementDragOptions);var r=function(m,C){if(!C.defaultPrevented){var k=pe(_t(C),Ae,this.getContainer(),!0);this.fire(m,k.jtk.connector.connection,C)}};t._connectorClick=r.bind(x(t),eu),t._connectorDblClick=r.bind(x(t),tu),t._connectorTap=r.bind(x(t),su),t._connectorDblTap=r.bind(x(t),nu);var a=function(m,C){var k=_t(C).parentNode;k.jtk&&k.jtk.connector&&(this.setConnectorHover(k.jtk.connector,m),this.fire(m?ru:iu,k.jtk.connector.connection,C))};t._connectorMouseover=a.bind(x(t),!0),t._connectorMouseout=a.bind(x(t),!1);var l=function(m,C,k){C.defaultPrevented||this.fire(m,k.jtk.endpoint,C)};t._endpointClick=l.bind(x(t),Jl),t._endpointDblClick=l.bind(x(t),Zl);var u=function(m,C){var k=_t(C);k.jtk&&k.jtk.endpoint&&(this.setEndpointHover(k.jtk.endpoint,m),this.fire(m?Ql:zl,k.jtk.endpoint,C))};t._endpointMouseover=u.bind(x(t),!0),t._endpointMouseout=u.bind(x(t),!1);var c=function(y,m){yt(m);var C=pe(_t(m),_e,this.getContainer(),!0),k=C.jtk.overlay;k&&this.fireOverlayMethod(k,y,m)}.bind(x(t));t._overlayClick=c.bind(x(t),se),t._overlayDblClick=c.bind(x(t),ve),t._overlayTap=c.bind(x(t),ce),t._overlayDblTap=c.bind(x(t),ue);var h=function(m,C){var k=pe(_t(C),_e,this.getContainer(),!0),b=k.jtk.overlay;b&&this.setOverlayHover(b,m)};t._overlayMouseover=h.bind(x(t),!0),t._overlayMouseout=h.bind(x(t),!1);var f=function(m,C,k){C.defaultPrevented||this.fire(C.detail===1?fs:Wl,k,C)};t._elementClick=f.bind(x(t),fs);var v=function(m,C,k){C.defaultPrevented||this.fire(ps,k,C)};t._elementTap=v.bind(x(t),ps);var g=function(m,C,k){C.defaultPrevented||this.fire(vs,k,C)};t._elementDblTap=g.bind(x(t),vs);var E=function(m,C){this.fire(m?Kl:ql,_t(C),C)};return t._elementMouseenter=E.bind(x(t),!0),t._elementMouseexit=E.bind(x(t),!1),t._attachEventDelegates(),t}return Z(n,[{key:"fireOverlayMethod",value:function(e,t,r){var a=e.component instanceof Gt?Ye:Ue,l=B(a,t);e.fire(t,{e:r,overlay:e}),this.fire(l,e.component,r)}},{key:"addDragFilter",value:function(e,t){this.dragManager.addFilter(e,t)}},{key:"removeDragFilter",value:function(e){this.dragManager.removeFilter(e)}},{key:"setDragGrid",value:function(e){this.dragManager.setOption(this.elementDragHandler,{grid:e})}},{key:"_removeElement",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"_appendElement",value:function(e,t){t&&t.appendChild(e)}},{key:"_getAssociatedElements",value:function(e){var t=[];if(e.nodeType!==3&&e.nodeType!==8){var r=e.querySelectorAll(U);Array.prototype.push.apply(t,r)}return t.filter(function(a){return a.nodeType!==3&&a.nodeType!==8})}},{key:"shouldFireEvent",value:function(e,t,r){return!0}},{key:"getClass",value:function(e){return Ml(e)}},{key:"addClass",value:function(e,t){Ve(e,t)}},{key:"hasClass",value:function(e,t){return Gl(e,t)}},{key:"removeClass",value:function(e,t){_i(e,t)}},{key:"toggleClass",value:function(e,t){Nl(e,t)}},{key:"setAttribute",value:function(e,t,r){e.setAttribute(t,r)}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"setAttributes",value:function(e,t){for(var r in t)e.setAttribute(r,t[r])}},{key:"removeAttribute",value:function(e,t){e.removeAttribute&&e.removeAttribute(t)}},{key:"on",value:function(e,t,r,a){var l=this,u=function(h){a==null?l.eventManager.on(h,t,r):l.eventManager.on(h,t,r,a)};return Nt(e)?D(e,function(c){return u(c)}):u(e),this}},{key:"off",value:function(e,t,r){var a=this;return Nt(e)?D(e,function(l){return a.eventManager.off(l,t,r)}):this.eventManager.off(e,t,r),this}},{key:"trigger",value:function(e,t,r,a,l){this.eventManager.trigger(e,t,r,a,l)}},{key:"getOffsetRelativeToRoot",value:function(e){return mt(e)}},{key:"getOffset",value:function(e){for(var t=e,r=this.getContainer(),a={x:t.offsetLeft,y:t.offsetTop},l=e!==r&&t.offsetParent!==r?t.offsetParent:null,u=function(v){v!=null&&v!==document.body&&(v.scrollTop>0||v.scrollLeft>0)&&(a.x-=v.scrollLeft,a.y-=v.scrollTop)};l!=null;)a.x+=l.offsetLeft,a.y+=l.offsetTop,u(l),l=l.offsetParent===r?null:l.offsetParent;if(r!=null&&(r.scrollTop>0||r.scrollLeft>0)){var c=t.offsetParent!=null?this.getStyle(t.offsetParent,gs):Wo,h=this.getStyle(t,gs);h!==ot&&h!==fr&&c!==ot&&c!==fr&&(a.x-=r.scrollLeft,a.y-=r.scrollTop)}return a}},{key:"getSize",value:function(e){return Ll(e)}},{key:"getStyle",value:function(e,t){return gt(window.getComputedStyle)!==ir?getComputedStyle(e,null).getPropertyValue(t):e.currentStyle[t]}},{key:"getGroupContentArea",value:function(e){var t=this.getSelector(e.el,au);return t&&t.length>0?t[0]:e.el}},{key:"getSelector",value:function(e,t){var r=null;if(arguments.length===1){if(!R(e)){var a=document.createDocumentFragment();return a.appendChild(e),Qt(a.childNodes)}r=Qt(document.querySelectorAll(e))}else r=Qt(e.querySelectorAll(t));return r}},{key:"setPosition",value:function(e,t){var r=e;r.style.left=t.x+"px",r.style.top=t.y+"px"}},{key:"setDraggable",value:function(e,t){t?this.removeAttribute(e,cn):this.setAttribute(e,cn,rr)}},{key:"isDraggable",value:function(e){var t=this.getAttribute(e,cn);return t==null||t===tt}},{key:"toggleDraggable",value:function(e){var t=this.isDraggable(e);return this.setDraggable(e,!t),!t}},{key:"_attachEventDelegates",value:function(){var e=this.getContainer();this.eventManager.on(e,se,_e,this._overlayClick),this.eventManager.on(e,ve,_e,this._overlayDblClick),this.eventManager.on(e,ce,_e,this._overlayTap),this.eventManager.on(e,ue,_e,this._overlayDblTap),this.eventManager.on(e,se,Ae,this._connectorClick),this.eventManager.on(e,ve,Ae,this._connectorDblClick),this.eventManager.on(e,ce,Ae,this._connectorTap),this.eventManager.on(e,ue,Ae,this._connectorDblTap),this.eventManager.on(e,se,Rt,this._endpointClick),this.eventManager.on(e,ve,Rt,this._endpointDblClick),this.eventManager.on(e,se,this.managedElementsSelector,this._elementClick),this.eventManager.on(e,ce,this.managedElementsSelector,this._elementTap),this.eventManager.on(e,ue,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(e,ae,Ae,this._connectorMouseover),this.eventManager.on(e,oe,Ae,this._connectorMouseout),this.eventManager.on(e,ae,Rt,this._endpointMouseover),this.eventManager.on(e,oe,Rt,this._endpointMouseout),this.eventManager.on(e,ae,_e,this._overlayMouseover),this.eventManager.on(e,oe,_e,this._overlayMouseout),this.eventManager.on(e,ae,U,this._elementMouseenter),this.eventManager.on(e,oe,U,this._elementMouseexit)}},{key:"_detachEventDelegates",value:function(){var e=this.getContainer();e&&(this.eventManager.off(e,se,this._connectorClick),this.eventManager.off(e,ve,this._connectorDblClick),this.eventManager.off(e,ce,this._connectorTap),this.eventManager.off(e,ue,this._connectorDblTap),this.eventManager.off(e,se,this._endpointClick),this.eventManager.off(e,ve,this._endpointDblClick),this.eventManager.off(e,se,this._overlayClick),this.eventManager.off(e,ve,this._overlayDblClick),this.eventManager.off(e,ce,this._overlayTap),this.eventManager.off(e,ue,this._overlayDblTap),this.eventManager.off(e,se,this._elementClick),this.eventManager.off(e,ce,this._elementTap),this.eventManager.off(e,ue,this._elementDblTap),this.eventManager.off(e,ae,this._connectorMouseover),this.eventManager.off(e,oe,this._connectorMouseout),this.eventManager.off(e,ae,this._endpointMouseover),this.eventManager.off(e,oe,this._endpointMouseout),this.eventManager.off(e,ae,this._overlayMouseover),this.eventManager.off(e,oe,this._overlayMouseout),this.eventManager.off(e,Ti,this._elementMouseenter),this.eventManager.off(e,Pi,this._elementMouseexit))}},{key:"setContainer",value:function(e){var t=this;if(e===document||e===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates();var r;this.dragManager!=null&&(r=this.dragManager.reset()),this.setAttribute(e,cs,X().replace("-",""));var a=this.getContainer();if(a!=null){a.removeAttribute(cs);var l=Qt(a.childNodes).filter(function(u){return u!=null&&(t.hasClass(u,ri)||t.hasClass(u,Dt)||t.hasClass(u,dn)||u.getAttribute&&u.getAttribute(Fe)!=null)});D(l,function(u){e.appendChild(u)})}le(ne(n.prototype),"setContainer",this).call(this,e),this.eventManager!=null&&this._attachEventDelegates(),this.dragManager!=null&&(this.dragManager.addHandler(new Os(this)),this.dragManager.addHandler(new ws(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new Gi(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),r!=null&&this.dragManager.setFilters(r))}},{key:"reset",value:function(){le(ne(n.prototype),"reset",this).call(this);var e=this.getContainer(),t=e.querySelectorAll([U,Rt,Ae,_e].join(","));D(t,function(r){return r.parentNode&&r.parentNode.removeChild(r)})}},{key:"destroy",value:function(){this._detachEventDelegates(),this.dragManager!=null&&this.dragManager.reset(),this.clearDragSelection(),le(ne(n.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(e,t){this.removeFromDragSelection(e),le(ne(n.prototype),"unmanage",this).call(this,e,t)}},{key:"addToDragSelection",value:function(){for(var e=this,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];D(r,function(l){return e.dragSelection.add(l)})}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var e=this,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];D(r,function(l){return e.dragSelection.remove(l)})}},{key:"toggleDragSelection",value:function(){for(var e=this,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];D(r,function(l){return e.dragSelection.toggle(l)})}},{key:"addToDragGroup",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];(t=this.elementDragHandler).addToDragGroup.apply(t,[e].concat(a))}},{key:"removeFromDragGroup",value:function(){var e;(e=this.elementDragHandler).removeFromDragGroup.apply(e,arguments)}},{key:"setDragGroupState",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];(t=this.elementDragHandler).setDragGroupState.apply(t,[e].concat(a))}},{key:"consume",value:function(e,t){yt(e,t)}},{key:"rotate",value:function(e,t,r){var a=this.getId(e);return this._managedElements[a]?(this._managedElements[a].el.style.transform="rotate("+t+"deg)",this._managedElements[a].el.style.transformOrigin="center center",le(ne(n.prototype),"rotate",this).call(this,e,t,r)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(e,t){if(ke(e))e.instance.addClass(he(e),t);else if(kt(e))e.instance.addClass(xt.ensurePath(e),t);else if(Pe(e))e.instance.addClass(We(e),t);else throw"Could not add class to overlay of type ["+e.type+"]"}},{key:"removeOverlayClass",value:function(e,t){if(ke(e))e.instance.removeClass(he(e),t);else if(kt(e))e.instance.removeClass(xt.ensurePath(e),t);else if(Pe(e))e.instance.removeClass(We(e),t);else throw"Could not remove class from overlay of type ["+e.type+"]"}},{key:"paintOverlay",value:function(e,t,r){if(ke(e)){he(e);var a=e.component.getXY();e.canvas.style.left=a.x+t.d.minx+"px",e.canvas.style.top=a.y+t.d.miny+"px"}else if(kt(e)){var l=isNaN(t.d.cxy.x)||isNaN(t.d.cxy.y)?"M 0 0":"M"+t.d.hxy.x+","+t.d.hxy.y+" L"+t.d.tail[0].x+","+t.d.tail[0].y+" L"+t.d.cxy.x+","+t.d.cxy.y+" L"+t.d.tail[1].x+","+t.d.tail[1].y+" L"+t.d.hxy.x+","+t.d.hxy.y;xt.paint(e,l,t,r)}else if(Pe(e)){We(e);var u=e.component.getXY();e.canvas.style.left=u.x+t.d.minx+"px",e.canvas.style.top=u.y+t.d.miny+"px"}else throw"Could not paint overlay of type ["+e.type+"]"}},{key:"setOverlayVisible",value:function(e,t){var r=t?"block":"none";function a(l){l!=null&&(l.style.display=r)}ke(e)?a(he(e)):Pe(e)?a(We(e)):kt(e)&&a(e.path)}},{key:"reattachOverlay",value:function(e,t){ke(e)?e.instance._appendElement(he(e),this.getContainer()):Pe(e)?e.instance._appendElement(We(e),this.getContainer()):kt(e)&&this._appendElement(xt.ensurePath(e),t.connector.canvas)}},{key:"setOverlayHover",value:function(e,t){var r=t?"addClass":"removeClass",a;ke(e)?a=he(e):Pe(e)?a=We(e):kt(e)&&(a=xt.ensurePath(e)),a!=null&&(this.hoverClass!=null&&this[r](a,this.hoverClass),this.setHover(e.component,t))}},{key:"destroyOverlay",value:function(e){if(ke(e)){var t=he(e);t.parentNode.removeChild(t),delete e.canvas,delete e.cachedDimensions}else if(hi(e)||vi(e)||fi(e))xt.destroy(e);else if(Pe(e)){var r=We(e);r.parentNode.removeChild(r),delete e.canvas,delete e.cachedDimensions}}},{key:"drawOverlay",value:function(e,t,r,a){if(ke(e)||Pe(e)){var l=Ni._getDimensions(e);if(l!=null&&l.w!=null&&l.h!=null){var u={x:0,y:0};if(a)u={x:a.x,y:a.y};else if(t instanceof it){var c=Array.isArray(e.location)?e.location:[e.location,e.location];u={x:c[0]*t.w,y:c[1]*t.h}}else{var h=e.location,f=!1;(R(e.location)||e.location<0||e.location>1)&&(h=parseInt(""+e.location,10),f=!0),u=t.pointOnPath(h,f)}var v=u.x-l.w/2,g=u.y-l.h/2;return{component:e,d:{minx:v,miny:g,td:l,cxy:u},xmin:v,xmax:v+l.w,ymin:g,ymax:g+l.h}}else return{xmin:0,xmax:0,ymin:0,ymax:0}}else{if(hi(e)||vi(e)||fi(e))return e.draw(t,r,a);throw"Could not draw overlay of type ["+e.type+"]"}}},{key:"updateLabel",value:function(e){if(Me(e.label)){var t=e.label(this);t!=null?he(e).innerText=t:he(e).innerText=""}else e.labelText==null&&(e.labelText=e.label,e.labelText!=null?he(e).innerText=e.labelText:he(e).innerText="")}},{key:"setHover",value:function(e,t){e._hover=t,e instanceof yn&&e.endpoint!=null?this.setEndpointHover(e,t):e instanceof Gt&&e.connector!=null&&this.setConnectorHover(e.connector,t)}},{key:"paintConnector",value:function(e,t,r){tc(this,e,t,r)}},{key:"setConnectorHover",value:function(e,t,r){if(t===!1||!this.currentlyDragging&&!this.isHoverSuspended()){var a=t?"addClass":"removeClass",l=e.canvas;l!=null&&(e.hoverClass!=null&&this[a](l,e.hoverClass),this[a](l,this.hoverClass)),e.connection.hoverPaintStyle!=null&&(e.connection.paintStyleInUse=t?e.connection.hoverPaintStyle:e.connection.paintStyle,this._suspendDrawing||this.paintConnection(e.connection)),r||(this.setEndpointHover(e.connection.endpoints[0],t,!0),this.setEndpointHover(e.connection.endpoints[1],t,!0))}}},{key:"destroyConnector",value:function(e){e.connector!=null&&Ns(e.connector)}},{key:"addConnectorClass",value:function(e,t){e.canvas&&this.addClass(e.canvas,t)}},{key:"removeConnectorClass",value:function(e,t){e.canvas&&this.removeClass(e.canvas,t)}},{key:"getConnectorClass",value:function(e){return e.canvas?e.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(e,t){Gs(e,t)}},{key:"applyConnectorType",value:function(e,t){if(e.canvas&&t.cssClass){var r=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(e.canvas,r.join(" "))}}},{key:"addEndpointClass",value:function(e,t){var r=Xt(e.endpoint);r!=null&&this.addClass(r,t)}},{key:"applyEndpointType",value:function(e,t){if(t.cssClass){var r=Xt(e.endpoint);if(r){var a=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(r,a.join(" "))}}}},{key:"destroyEndpoint",value:function(e){var t=this.endpointAnchorClassPrefix+(e.currentAnchorClass?"-"+e.currentAnchorClass:"");this.removeClass(e.element,t),Ns(e.endpoint)}},{key:"renderEndpoint",value:function(e,t){var r=Ms[e.endpoint.type];r!=null?ic.paint(e.endpoint,r,t):ee("jsPlumb: no endpoint renderer found for type ["+e.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(e,t){var r=Xt(e.endpoint);r!=null&&this.removeClass(r,t)}},{key:"getEndpointClass",value:function(e){var t=Xt(e.endpoint);return t!=null?t.className:""}},{key:"setEndpointHover",value:function(e,t,r){if(e!=null&&(t===!1||!this.currentlyDragging&&!this.isHoverSuspended())){var a=t?"addClass":"removeClass",l=Xt(e.endpoint);if(l!=null&&e.hoverClass!=null&&this[a](l,e.hoverClass),e.hoverPaintStyle!=null&&(e.paintStyleInUse=t?e.hoverPaintStyle:e.paintStyle,this._suspendDrawing||this.renderEndpoint(e,e.paintStyleInUse)),!r)for(var u=0;u<e.connections.length;u++)this.setConnectorHover(e.connections[u].connector,t,!0)}}},{key:"setEndpointVisible",value:function(e,t){Gs(e.endpoint,t)}},{key:"setGroupVisible",value:function(e,t){for(var r=e.el.querySelectorAll(U),a=0;a<r.length;a++)t?this.show(r[a],!0):this.hide(r[a],!0)}},{key:"deleteConnection",value:function(e,t){return e!=null&&e.deleted!==!0?(this.setEndpointHover(e.endpoints[0],!1,!0),this.setEndpointHover(e.endpoints[1],!1,!0),le(ne(n.prototype),"deleteConnection",this).call(this,e,t)):!1}},{key:"addSourceSelector",value:function(e,t,r){return this.addDragFilter(e),le(ne(n.prototype),"addSourceSelector",this).call(this,e,t,r)}},{key:"removeSourceSelector",value:function(e){this.removeDragFilter(e.selector),le(ne(n.prototype),"removeSourceSelector",this).call(this,e)}}]),n}(Cl),ac="circle",lc=function(){Li(rt.type,{makeNode:function(n,i){return ye(ac,{cx:n.w/2,cy:n.h/2,r:n.radius})},updateNode:function(n,i){ge(i,{cx:""+n.w/2,cy:""+n.h/2,r:""+n.radius})}})},uc="rect",cc=function(){Li(ln.type,{makeNode:function(n,i){return ye(uc,{width:n.w,height:n.h})},updateNode:function(n,i){ge(i,{width:n.w,height:n.h})}})},Ls={width:10,height:0,fill:"transparent",stroke:"transparent"},hc=function(){Li(an.type,{makeNode:function(n,i){return ye("rect",Ls)},updateNode:function(n,i){ge(i,Ls)}})};lc();hc();cc();var Rs=0;function dc(){var s=Rs+1;return Rs++,s}function fc(s){return new oc(dc(),s)}function vc(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function Fs(s,o){for(var n=0;n<o.length;n++){var i=o[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,i.key,i)}}function pc(s,o,n){return o&&Fs(s.prototype,o),n&&Fs(s,n),s}function de(s,o,n){return o in s?Object.defineProperty(s,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[o]=n,s}function gc(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),o&&Ri(s,o)}function Gn(s){return Gn=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},Gn(s)}function Ri(s,o){return Ri=Object.setPrototypeOf||function(i,e){return i.__proto__=e,i},Ri(s,o)}function yc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function fe(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function _c(s,o){return o&&(typeof o=="object"||typeof o=="function")?o:fe(s)}function mc(s){var o=yc();return function(){var i=Gn(s),e;if(o){var t=Gn(this).constructor;e=Reflect.construct(i,arguments,t)}else e=i.apply(this,arguments);return _c(this,e)}}function js(s){return s<0?-1:s===0?0:1}function Hs(s){return[js(s[2]-s[0]),js(s[3]-s[1])]}function Bs(s){return Math.sqrt(Math.pow(s[0]-s[2],2)+Math.pow(s[1]-s[3],2))}function Vs(s){var o=[];return o.push.apply(o,s),o}var Nn=function(s){gc(n,s);var o=mc(n);function n(i,e){var t;return vc(this,n),t=o.call(this,i,e),t.connection=i,de(fe(t),"type",n.type),de(fe(t),"internalSegments",[]),de(fe(t),"midpoint",void 0),de(fe(t),"alwaysRespectStubs",void 0),de(fe(t),"cornerRadius",void 0),de(fe(t),"lastx",void 0),de(fe(t),"lasty",void 0),de(fe(t),"lastOrientation",void 0),de(fe(t),"loopbackRadius",void 0),de(fe(t),"isLoopbackCurrently",void 0),t.midpoint=e.midpoint==null||isNaN(e.midpoint)?.5:e.midpoint,t.cornerRadius=e.cornerRadius!=null?e.cornerRadius:0,t.alwaysRespectStubs=e.alwaysRespectStubs===!0,t.lastx=null,t.lasty=null,t.lastOrientation=null,t.loopbackRadius=e.loopbackRadius||25,t.isLoopbackCurrently=!1,t}return pc(n,[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(e,t,r){if(!(this.lastx===e&&this.lasty===t)){var a=this.lastx==null?r.sx:this.lastx,l=this.lasty==null?r.sy:this.lasty,u=a===e?"v":"h";this.lastx=e,this.lasty=t,this.internalSegments.push([a,l,e,t,u])}}},{key:"writeSegments",value:function(e){for(var t=null,r,a,l,u=0;u<this.internalSegments.length-1;u++){if(t=t||Vs(this.internalSegments[u]),r=Vs(this.internalSegments[u+1]),a=Hs(t),l=Hs(r),this.cornerRadius>0&&t[4]!==r[4]){var c=Math.min(Bs(t),Bs(r)),h=Math.min(this.cornerRadius,c/2);t[2]-=a[0]*h,t[3]-=a[1]*h,r[0]+=l[0]*h,r[1]+=l[1]*h;var f=a[1]===l[0]&&l[0]===1||a[1]===l[0]&&l[0]===0&&a[0]!==l[1]||a[1]===l[0]&&l[0]===-1,v=r[1]>t[3]?1:-1,g=r[0]>t[2]?1:-1,E=v===g,y=E&&f||!E&&!f?r[0]:t[2],m=E&&f||!E&&!f?t[3]:r[1];this._addSegment(Le,{x1:t[0],y1:t[1],x2:t[2],y2:t[3]}),this._addSegment(ts,{r:h,x1:t[2],y1:t[3],x2:r[0],y2:r[1],cx:y,cy:m,ac:f})}else this._addSegment(Le,{x1:t[0],y1:t[1],x2:t[2],y2:t[3]});t=r}r!=null&&this._addSegment(Le,{x1:r[0],y1:r[1],x2:r[2],y2:r[3]})}},{key:"_compute",value:function(e,t){var r=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var a=function(T){return[e.startStubX,e.startStubY,e.endStubX,e.endStubY]},l={perpendicular:a,orthogonal:a,opposite:function(T){var S=e,I=T==="x"?0:1,M={x:function(){return S.so[I]===1&&(S.startStubX>S.endStubX&&S.tx>S.startStubX||S.sx>S.endStubX&&S.tx>S.sx)||S.so[I]===-1&&(S.startStubX<S.endStubX&&S.tx<S.startStubX||S.sx<S.endStubX&&S.tx<S.sx)},y:function(){return S.so[I]===1&&(S.startStubY>S.endStubY&&S.ty>S.startStubY||S.sy>S.endStubY&&S.ty>S.sy)||S.so[I]===-1&&(S.startStubY<S.endStubY&&S.ty<S.startStubY||S.sy<S.endStubY&&S.ty<S.sy)}};return!r.alwaysRespectStubs&&M[T]()?{x:[(e.sx+e.tx)/2,e.startStubY,(e.sx+e.tx)/2,e.endStubY],y:[e.startStubX,(e.sy+e.ty)/2,e.endStubX,(e.sy+e.ty)/2]}[T]:[e.startStubX,e.startStubY,e.endStubX,e.endStubY]}},u=l[e.anchorOrientation](e.sourceAxis),c=e.sourceAxis==="x"?0:1,h=e.sourceAxis==="x"?1:0,f=u[c],v=u[h],g=u[c+2],E=u[h+2];this.addASegment(u[0],u[1],e);var y=e.startStubX+(e.endStubX-e.startStubX)*this.midpoint,m=e.startStubY+(e.endStubY-e.startStubY)*this.midpoint,C={x:[0,1],y:[1,0]},k={perpendicular:function(T,S,I,M,N){var P=e,W={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]},ie={x:[[P.startStubX,P.endStubX],null,[P.endStubX,P.startStubX]],y:[[P.startStubY,P.endStubY],null,[P.endStubY,P.startStubY]]},St={x:[[y,P.startStubY],[y,P.endStubY]],y:[[P.startStubX,m],[P.endStubX,m]]},qe={x:[[P.endStubX,P.startStubY]],y:[[P.startStubX,P.endStubY]]},Js={x:[[P.startStubX,P.endStubY],[P.endStubX,P.endStubY]],y:[[P.endStubX,P.startStubY],[P.endStubX,P.endStubY]]},Zs={x:[[P.startStubX,m],[P.endStubX,m],[P.endStubX,P.endStubY]],y:[[y,P.startStubY],[y,P.endStubY],[P.endStubX,P.endStubY]]},$t={x:[P.startStubY,P.endStubY],y:[P.startStubX,P.endStubX]},zs=C[T][0],Ln=C[T][1],Rn=P.so[zs]+1,Qs=P.to[Ln]+1,Fn=P.to[Ln]===-1&&$t[T][1]<$t[T][0]||P.to[Ln]===1&&$t[T][1]>$t[T][0],ji=ie[T][Rn][0],Hi=ie[T][Rn][1],we=W[T][Rn][Qs];if(P.segment===we[3]||P.segment===we[2]&&Fn)return St[T];if(P.segment===we[2]&&Hi<ji)return qe[T];if(P.segment===we[2]&&Hi>=ji||P.segment===we[1]&&!Fn)return Zs[T];if(P.segment===we[0]||P.segment===we[1]&&Fn)return Js[T]},orthogonal:function(T,S,I,M,N){var P=e,W={x:P.so[0]===-1?Math.min(S,M):Math.max(S,M),y:P.so[1]===-1?Math.min(S,M):Math.max(S,M)}[T];return{x:[[W,I],[W,N],[M,N]],y:[[I,W],[N,W],[N,M]]}[T]},opposite:function(T,S,I,M,N){var P=e,W={x:"y",y:"x"}[T],ie={x:"h",y:"w"}[T],St=P["is"+T.toUpperCase()+"GreaterThanStubTimes2"];if(t.sourceEndpoint.elementId===t.targetEndpoint.elementId){var qe=I+(1-t.sourceEndpoint._anchor[W])*t.sourceInfo[ie]+r.maxStub;return{x:[[S,qe],[M,qe]],y:[[qe,S],[qe,M]]}[T]}else{if(!St||P.so[c]===1&&S>M||P.so[c]===-1&&S<M)return{x:[[S,m],[M,m]],y:[[y,S],[y,M]]}[T];if(P.so[c]===1&&S<M||P.so[c]===-1&&S>M)return{x:[[y,P.sy],[y,P.ty]],y:[[P.sx,m],[P.tx,m]]}[T]}}},b=k[e.anchorOrientation](e.sourceAxis,f,v,g,E);if(b)for(var A=0;A<b.length;A++)this.addASegment(b[A][0],b[A][1],e);this.addASegment(u[2],u[3],e),this.addASegment(e.tx,e.ty,e),this.writeSegments(e)}}]),n}(ei);de(Nn,"type","Flowchart");ti.register(Nn.type,Nn);const Us=200,Ys={WIDTH:280,HEIGHT:140},Xs={WIDTH:200,HEIGHT:80},Fi=qt(null),Ec=s=>{Fi.value||(Fi.value=fc({container:s,endpoint:"Blank",connector:{type:Nn.type,options:{gap:4,cornerRadius:2}},paintStyle:{strokeWidth:1,stroke:"black",outlineWidth:1}}))},$s=s=>document.getElementById(s),Ws=(s,o)=>{if(o==="yes"){const n=`arrow_yes_${s}`;return{id:n,selector:`div[jtk-overlay-id="${n}"]`}}else{const n=`arrow_no_${s}`;return{id:n,selector:`div[jtk-overlay-id="${n}"]`}}},qs=(s,o)=>{var a,l;const n=Ws(s,"yes"),i=Ws(s,"no"),e=((a=o.links)==null?void 0:a.length)||0,t=o.type==="decision"&&e>1,r=[{type:"Arrow",options:{location:1,width:8,length:8}}];o.when===!0&&!document.querySelector(n.selector)&&!t&&r.push({type:"Label",options:{label:"\u0414\u0430",location:40,id:n.id,cssClass:"label"}}),o.when===!1&&!document.querySelector(i.selector)&&!t&&r.push({type:"Label",options:{label:"\u041D\u0435\u0442",location:40,id:i.id,cssClass:"label"}}),(l=Fi.value)==null||l.connect({source:$s(s),target:$s(o.id),anchor:"Continuous",scope:s,endpointStyle:{draggable:!1},anchors:o.anchors,overlays:r})},Cc=s=>{const o=n=>{var i,e;((i=n.links)==null?void 0:i.length)&&n.links.forEach(t=>qs(t,n)),(e=n.childrens)==null||e.forEach(t=>{var r;t.type==="decision"?o(t):(r=t.links)==null||r.forEach(a=>qs(a,t))})};s.forEach(n=>o(n))},xc=(s,o)=>{let n=-1;function i(t){var u,c,h,f,v,g,E;const[,r]=t.position;if((u=t.childrens)==null?void 0:u.every(y=>!y.childrens)){n+=1;const y=(c=t.childrens)==null?void 0:c.filter(C=>C.when===!0),m=(h=t.childrens)==null?void 0:h.filter(C=>C.when===!1);y.forEach((C,k)=>{const b=r-200,A=k*o.spacingX,O=k*200,T=n*o.layerHeight,S=b-A-O;C.position=[T,S]}),m.forEach((C,k)=>{const b=r+280,A=k*o.spacingX,O=k*200,T=n*o.layerHeight,S=b-A-O;C.position=[T,S]});return}(f=t.childrens)==null||f.filter(y=>y.type==="decision").forEach(y=>{e(y,!0)});const a=(v=t.childrens)==null?void 0:v.filter(y=>y.type==="decision").reverse()[0];let l;a&&a.childrens&&(l=Math.max(...(g=a.childrens)==null?void 0:g.map(y=>y.position[1]))),(E=t.childrens)==null||E.filter(y=>y.type==="process").forEach((y,m)=>{if(l){const C=200+o.spacingX+60;y.position=[n*o.layerHeight,m*200+m*o.spacingX+l+C]}else y.position=[n*o.layerHeight,m*200+r+m*o.spacingX]})}function e(t,r){if(t.type==="decision"){n+=1;const a=l=>r?l.when?o.innerLayerBaselineLeft:o.innerLayerBaselineRight:o.layerBaseline;t.position=[n*o.layerHeight,a(t)],t.childrens&&i(t)}}s.forEach(t=>e(t,!1))},kc=s=>{const o=e=>({option:"process",node:"decision"})[e],n=e=>e===!0?["Left","Top"]:e===!1?["Right","Top"]:["Bottom","Top"],i=(e,t)=>{const r=o(e.type),a={id:e._id,text:e.title,type:r,anchors:n(e.when),position:[0,0],when:e.when,parent:t};return e.options&&(a.childrens=e.options.map(l=>i(l,{id:a.id,when:a.when}))),a};return s.nodes.map(e=>i(e))},Sc=s=>{const n=(t=>{const r=[],a=l=>{var c;r.push(l);const u=["process","decision"];(c=l.childrens)==null||c.sort((h,f)=>u.indexOf(f.type)-u.indexOf(h.type)).forEach(h=>{h.type==="decision"?a(h):r.push(h)})};return t.forEach(l=>a(l)),r})(s);let i=null,e=[];return n.forEach(t=>{var r;t.type==="decision"?i===null?i=t.id:i!==t.id&&(e.length?(t.links=e,e=[],i=t.id,t.anchors=["Bottom","Top"]):(t.links=[i],i=t.id)):t.type==="process"&&(e.push(t.id),t.links=[(r=t.parent)==null?void 0:r.id])}),s},bc=Wt({props:{node:{required:!1,type:Object,default:()=>({})}},setup(s){return(o,n)=>{const i=ho,e=io("ec-flowchart-node",!0),t=oo;return s.node.type==="decision"?(q(),re(Je,{key:0},[Vi(i,{id:s.node.id,top:s.node.position[0],left:s.node.position[1]+Ke(Us),width:Ke(Ys).WIDTH,height:Ke(Ys).HEIGHT},{default:Bn(()=>[Kt(Vn(s.node.text),1)]),_:1},8,["id","top","left","width","height"]),(q(!0),re(Je,null,Ui(s.node.childrens,r=>(q(),re(Je,{key:r.id},[r.type==="decision"?(q(),Jt(e,{key:0,node:r},null,8,["node"])):r.type==="process"?(q(),Jt(t,{key:1,id:r.id,top:r.position[0],left:r.position[1]+Ke(Us),width:Ke(Xs).WIDTH,height:Ke(Xs).HEIGHT},{default:Bn(()=>[Kt(Vn(r.text),1)]),_:2},1032,["id","top","left","width","height"])):Un("",!0)],64))),128))],64)):Un("",!0)}}});var Ks={};const Tc={key:0,class:"ec-flowchart"},Pc={key:1,class:"w-[980px] mx-auto px-6 py-8"},Ac=Kt("\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0445\u0435\u043C\u0443"),Dc=Wt({setup(s){const o=qt([]),n=qt(""),i=qt("nofile"),e=ro(),t=async({file:r})=>{const a=await eo(r);a.parsedFile&&(o.value=Sc(kc(a.parsedFile)),xc(o.value,{layerHeight:180,layerBaseline:500,innerLayerBaselineLeft:240,innerLayerBaselineRight:760,spacingX:10}),so(()=>{Ec(document.querySelector(".ec-flowchart")),Cc(o.value)})),e.success(a.message.value),i.value=a.fileState.value};return(r,a)=>{const l=bc,u=to,c=no;return o.value.length?(q(),re("div",Tc,[(q(!0),re(Je,null,Ui(o.value,h=>(q(),Jt(l,{key:h.id,node:h},null,8,["node"]))),128))])):(q(),re("div",Pc,[Vi(u,{class:"mb-4"},{default:Bn(()=>[n.value?(q(),re(Je,{key:0},[Kt(Vn(n.value),1)],64)):(q(),re(Je,{key:1},[Ac],64))]),_:1}),i.value==="nofile"?(q(),Jt(c,{key:0,big:"",onFileChange:t})):Un("",!0)]))}}});typeof Ks=="function"&&Ks(Dc);export{Dc as default};
